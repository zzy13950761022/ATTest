=== Run Tests ===
........F.F...F..                                                        [100%]
=================================== FAILURES ===================================
____________________ test_instance_norm_invalid_parameters _____________________

    def test_instance_norm_invalid_parameters():
        """Test invalid parameter validation."""
        # Note: InstanceNorm constructors don't validate num_features in __init__
        # They only validate during forward pass or when parameters are used
        # So we should test that invalid parameters cause issues during usage
    
        # Test invalid num_features - should work in constructor but may fail later
        # InstanceNorm1d with num_features=0 should be constructible
        norm_zero = InstanceNorm1d(num_features=0)
        assert norm_zero.num_features == 0, f"num_features should be 0, got {norm_zero.num_features}"
    
        # InstanceNorm1d with num_features=-1 should also be constructible
        norm_negative = InstanceNorm1d(num_features=-1)
        assert norm_negative.num_features == -1, f"num_features should be -1, got {norm_negative.num_features}"
    
        # Test invalid eps - should raise ValueError
>       with pytest.raises(ValueError, match="eps"):
E       Failed: DID NOT RAISE <class 'ValueError'>

tests/test_torch_nn_modules_instancenorm_g1.py:553: Failed
_____________________ test_instance_norm_channel_mismatch ______________________

    def test_instance_norm_channel_mismatch():
        """Test channel dimension mismatch error."""
        norm = InstanceNorm2d(num_features=3)
    
        # Input with wrong channel dimension
        wrong_input = torch.randn(2, 4, 5, 5)  # 4 channels, expected 3
    
        # InstanceNorm doesn't validate channel dimension in constructor
        # It will fail during forward pass with a RuntimeError
        # The error message may vary, so we'll catch RuntimeError
>       with pytest.raises(RuntimeError):
E       Failed: DID NOT RAISE <class 'RuntimeError'>

tests/test_torch_nn_modules_instancenorm_g1.py:618: Failed
_________________ test_lazy_instance_norm_parameter_validation _________________

    def test_lazy_instance_norm_parameter_validation():
        """Test parameter validation for lazy instance norm."""
        # Test that lazy instance norm doesn't require num_features parameter
        # This is the main difference from regular instance norm
        lazy_norm = LazyInstanceNorm2d(affine=False, track_running_stats=False)
        assert lazy_norm.num_features == 0, \
            "LazyInstanceNorm2d should have num_features=0 initially"
    
        # Note: LazyInstanceNorm2d may not validate eps in constructor
        # but in forward pass. We'll test that invalid eps causes issues during forward.
        # For now, we'll test that constructor accepts valid eps values.
    
        # Test valid eps values are accepted
        lazy_norm_eps_small = LazyInstanceNorm2d(eps=1e-8, affine=False, track_running_stats=False)
        assert lazy_norm_eps_small.eps == 1e-8, f"eps should be 1e-8, got {lazy_norm_eps_small.eps}"
    
        lazy_norm_eps_large = LazyInstanceNorm2d(eps=1e-3, affine=False, track_running_stats=False)
        assert lazy_norm_eps_large.eps == 1e-3, f"eps should be 1e-3, got {lazy_norm_eps_large.eps}"
    
        # Test invalid momentum
>       with pytest.raises(ValueError, match="momentum"):
E       Failed: DID NOT RAISE <class 'ValueError'>

tests/test_torch_nn_modules_instancenorm_g2.py:376: Failed
=============================== warnings summary ===============================
exam/torch_group/nn.modules.instancenorm/tests/test_torch_nn_modules_instancenorm_g1.py::test_lazy_instance_norm_inference[test_params0]
exam/torch_group/nn.modules.instancenorm/tests/test_torch_nn_modules_instancenorm_g2.py::test_lazy_instance_norm_inference[test_params0]
exam/torch_group/nn.modules.instancenorm/tests/test_torch_nn_modules_instancenorm_g2.py::test_lazy_instance_norm_parameter_validation
exam/torch_group/nn.modules.instancenorm/tests/test_torch_nn_modules_instancenorm_g2.py::test_lazy_instance_norm_dimension_validation
exam/torch_group/nn.modules.instancenorm/tests/test_torch_nn_modules_instancenorm_g2.py::test_lazy_instance_norm_affine_parameters
  /opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/nn/modules/lazy.py:180: UserWarning: Lazy modules are a new feature under heavy development so changes to the API or functionality can happen at any moment.
    warnings.warn('Lazy modules are a new feature under heavy development '

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.10.19-final-0 _______________

Name                                             Stmts   Miss Branch BrPart  Cover   Missing
--------------------------------------------------------------------------------------------
tests/test_torch_nn_modules_instancenorm_g1.py     205     25     46     18    80%   21-33, 94, 118->125, 125->exit, 181, 232->exit, 269, 314->328, 317->322, 320, 322->328, 324, 328->341, 330->335, 333, 335->341, 337, 413, 511->exit, 556-573
tests/test_torch_nn_modules_instancenorm_g2.py     162     28     38     13    74%   21-33, 37-56, 89, 133->147, 136->141, 139, 141->147, 143, 147->160, 149->154, 152, 154->160, 156, 232, 330->exit, 379-390
--------------------------------------------------------------------------------------------
TOTAL                                              367     53     84     31    77%
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED tests/test_torch_nn_modules_instancenorm_g1.py::test_instance_norm_invalid_parameters
FAILED tests/test_torch_nn_modules_instancenorm_g1.py::test_instance_norm_channel_mismatch
FAILED tests/test_torch_nn_modules_instancenorm_g2.py::test_lazy_instance_norm_parameter_validation
3 failed, 14 passed, 5 warnings in 0.86s

Error: exit 1