# torch.hub 测试计划

## 1. 测试策略
- 单元测试框架：pytest
- 隔离策略：mock网络请求、文件系统操作、用户输入、环境变量
- 随机性处理：固定随机种子，使用临时目录隔离测试环境
- 测试分组：按功能分为2个group（G1:核心加载，G2:信任缓存）

## 2. 生成规格摘要（来自 test_plan.json）
- **SMOKE_SET**: CASE_01 (GitHub加载), CASE_02 (本地加载), CASE_03 (信任机制)
- **DEFERRED_SET**: CASE_04 (参数传递), CASE_05 (强制重载)
- **group列表**: G1(核心加载功能), G2(信任与缓存管理)
- **active_group_order**: G1 → G2
- **断言分级策略**: 首轮仅使用weak断言（对象返回、可调用性、基本属性）
- **预算策略**: 每个CASE限制80-100行，最多10个参数，中等规模

## 3. 数据与边界
- **正常数据集**: 标准GitHub仓库格式、有效本地路径、简单hubconf.py
- **随机生成策略**: 使用临时目录和mock对象模拟真实环境
- **边界值测试**:
  - 空字符串repo_or_dir和model
  - 特殊字符路径
  - 超长仓库名称
  - 无效ref格式（"owner/repo:"）
- **负例与异常场景**:
  - 无效GitHub仓库格式
  - 不存在的本地路径
  - 缺失hubconf.py文件
  - 不存在的入口点名称
  - 错误的source参数值
  - 无效的trust_repo值
  - 网络连接失败
  - 权限不足的本地路径

## 4. 覆盖映射
| TC ID | 需求覆盖 | 约束覆盖 | 风险点 |
|-------|----------|----------|--------|
| TC-01 | GitHub标准加载流程 | 仓库格式验证、网络依赖 | 网络稳定性、API限流 |
| TC-02 | 本地路径加载流程 | 文件系统访问、路径验证 | 跨平台路径兼容性 |
| TC-03 | 信任机制处理 | trust_repo参数行为 | 用户交互模拟、安全验证 |
| TC-04 | 参数传递验证 | *args/**kwargs传递 | 类型转换、错误处理 |
| TC-05 | 缓存管理行为 | force_reload参数 | 缓存一致性、并发访问 |

**尚未覆盖的关键风险点**:
- 返回值类型未在签名中明确
- 信任机制的详细交互行为
- 缓存清理和过期策略
- 网络重试和错误恢复机制
- 内存使用和资源释放

## 5. 迭代计划
- **首轮**: 仅生成SMOKE_SET（3个核心用例），使用weak断言
- **后续**: 修复失败用例，逐步添加DEFERRED_SET，扩展参数维度
- **最终**: 启用strong断言，可选覆盖度提升，参数矩阵完整验证