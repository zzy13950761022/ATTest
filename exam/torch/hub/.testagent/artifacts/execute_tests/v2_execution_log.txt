=== Run Tests ===
E..EFF..                                                                 [100%]
==================================== ERRORS ====================================
____________________ ERROR at setup of test_trust_mechanism ____________________

    @pytest.fixture
    def mock_github_download():
        """Mock GitHub download operations."""
>       with patch('torch.hub._download_url_to_file') as mock_download, \
             patch('torch.hub._git_archive') as mock_git_archive, \
             patch('torch.hub.urlparse') as mock_urlparse:

tests/test_torch_hub_trust.py:56: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/unittest/mock.py:1447: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1347c46d0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'torch.hub' from '/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/hub.py'> does not have the attribute '_download_url_to_file'

/opt/anaconda3/envs/testagent-experiment/lib/python3.10/unittest/mock.py:1420: AttributeError
________________ ERROR at setup of test_force_reload_with_trust ________________

    @pytest.fixture
    def mock_github_download():
        """Mock GitHub download operations."""
>       with patch('torch.hub._download_url_to_file') as mock_download, \
             patch('torch.hub._git_archive') as mock_git_archive, \
             patch('torch.hub.urlparse') as mock_urlparse:

tests/test_torch_hub_trust.py:56: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/unittest/mock.py:1447: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x13491cee0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'torch.hub' from '/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/hub.py'> does not have the attribute '_download_url_to_file'

/opt/anaconda3/envs/testagent-experiment/lib/python3.10/unittest/mock.py:1420: AttributeError
=================================== FAILURES ===================================
________________________ test_invalid_trust_repo_value _________________________

    def test_invalid_trust_repo_value():
        """Test that invalid trust_repo value raises appropriate error."""
        with pytest.raises((ValueError, TypeError)):
            # trust_repo should be bool, "check", or None
>           torch.hub.load(
                repo_or_dir='test/repo',
                model='test_model',
                source='github',
                trust_repo='invalid_value'  # Not a valid value
            )

tests/test_torch_hub_trust.py:262: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/hub.py:539: in load
    repo_or_dir = _get_cache_or_reload(repo_or_dir, force_reload, trust_repo, "load",
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/hub.py:203: in _get_cache_or_reload
    _validate_not_a_forked_repo(repo_owner, repo_name, ref)
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/hub.py:162: in _validate_not_a_forked_repo
    response = json.loads(_read_url(Request(url, headers=headers)))
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/hub.py:145: in _read_url
    with urlopen(url) as r:
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/urllib/request.py:216: in urlopen
    return opener.open(url, data, timeout)
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/urllib/request.py:525: in open
    response = meth(req, response)
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/urllib/request.py:634: in http_response
    response = self.parent.error(
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/urllib/request.py:563: in error
    return self._call_chain(*args)
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/urllib/request.py:496: in _call_chain
    result = func(*args)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <urllib.request.HTTPDefaultErrorHandler object at 0x1347ab9d0>
req = <urllib.request.Request object at 0x1347c6b00>
fp = <http.client.HTTPResponse object at 0x1347c6980>, code = 404
msg = 'Not Found', hdrs = <http.client.HTTPMessage object at 0x1347c6bc0>

    def http_error_default(self, req, fp, code, msg, hdrs):
>       raise HTTPError(req.full_url, code, msg, hdrs, fp)
E       urllib.error.HTTPError: HTTP Error 404: Not Found

/opt/anaconda3/envs/testagent-experiment/lib/python3.10/urllib/request.py:643: HTTPError
________________________ test_network_failure_handling _________________________

    def test_network_failure_handling():
        """Test handling of network failures during download."""
>       with patch('torch.hub._download_url_to_file') as mock_download:

tests/test_torch_hub_trust.py:272: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/unittest/mock.py:1447: in __enter__
    original, local = self.get_original()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x1053fa7a0>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'torch.hub' from '/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/hub.py'> does not have the attribute '_download_url_to_file'

/opt/anaconda3/envs/testagent-experiment/lib/python3.10/unittest/mock.py:1420: AttributeError
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.10.19-final-0 _______________

Name                            Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------
tests/test_torch_hub_trust.py     130     66      4      1    49%   43-48, 60-69, 79-84, 90-91, 97-107, 138-221, 253, 273-276, 315-316
---------------------------------------------------------------------------
TOTAL                             130     66      4      1    49%
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED tests/test_torch_hub_trust.py::test_invalid_trust_repo_value - urllib....
FAILED tests/test_torch_hub_trust.py::test_network_failure_handling - Attribu...
ERROR tests/test_torch_hub_trust.py::test_trust_mechanism - AttributeError: <...
ERROR tests/test_torch_hub_trust.py::test_force_reload_with_trust - Attribute...
2 failed, 4 passed, 2 errors in 3.97s

Error: exit 1