=== Run Tests ===
..s.F..........................                                          [100%]
=================================== FAILURES ===================================
______ test_bform_bilinear[dtype0-cpu-shape_X0-shape_A0-shape_Y0-flags0] _______

dtype = torch.float32, device = 'cpu', shape_X = [3, 2], shape_A = [3, 4]
shape_Y = [4, 2], flags = [], random_seed = 42

    @pytest.mark.parametrize("dtype,device,shape_X,shape_A,shape_Y,flags", [
        # Base case from test plan
        (torch.float32, "cpu", [3, 2], [3, 4], [4, 2], []),
    ])
    def test_bform_bilinear(dtype, device, shape_X, shape_A, shape_Y, flags, random_seed):
        """Test bilinear form function bform(X, A, Y) = X^T A Y"""
        # Skip CUDA tests if device not available
        if device == "cuda" and not torch.cuda.is_available():
            pytest.skip("CUDA device not available")
    
        # Create test matrices
        X = create_dense_matrix(shape_X, dtype=dtype, device=device)
        A = create_dense_matrix(shape_A, dtype=dtype, device=device)
        Y = create_dense_matrix(shape_Y, dtype=dtype, device=device)
    
        # Call bform function
        result = bform(X, A, Y)
    
        # Weak assertions (epoch 2)
        # 1. Shape assertion
        # bform(X, A, Y) = X^T A Y, where X: m×k, A: m×n, Y: n×l
        # X^T: k×m, A: m×n, Y: n×l
        # Result shape should be: k×l
        expected_shape = (shape_X[1], shape_Y[1])
        assert result.shape == expected_shape, f"Expected shape {expected_shape}, got {result.shape}"
    
        # 2. Dtype assertion
        assert result.dtype == dtype, f"Expected dtype {dtype}, got {result.dtype}"
    
        # 3. Finite values assertion
        assert torch.isfinite(result).all(), "Result contains non-finite values"
    
        # 4. Manual calculation verification (basic property)
        # Compute X^T A Y manually using torch operations
        X_T = torch.transpose(X, 0, 1)
        AY = torch.matmul(A, Y)
        expected = torch.matmul(X_T, AY)
    
        # Check that result matches manual calculation
        assert torch.allclose(result, expected, rtol=1e-6, atol=1e-6), \
            "bform result should match manual calculation X^T A Y"
    
        # Test with A = None (should return X^T Y according to implementation)
>       result_none = bform(X, None, Y)

tests/test_torch_linalg_utils_g1.py:204: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/_linalg_utils.py:69: in bform
    return matmul(transpose(X), matmul(A, Y))
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

A = tensor([[ 0.3367,  0.2345, -1.1229],
        [ 0.1288,  0.2303, -0.1863]])
B = tensor([[-0.7658, -0.7506],
        [ 1.3525,  0.6863],
        [-0.3278,  0.7950],
        [ 0.2815,  0.0562]])

    def matmul(A: Optional[Tensor], B: Tensor) -> Tensor:
        """Multiply two matrices.
    
        If A is None, return B. A can be sparse or dense. B is always
        dense.
        """
        if A is None:
            return B
        if is_sparse(A):
            return torch.sparse.mm(A, B)
>       return torch.matmul(A, B)
E       RuntimeError: mat1 and mat2 shapes cannot be multiplied (2x3 and 4x2)

/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/_linalg_utils.py:43: RuntimeError
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.10.19-final-0 _______________

Name                                  Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------------
tests/test_torch_linalg_utils_g1.py     144     14     16      7    87%   17, 30, 58, 80, 99->exit, 120, 169, 207-217, 233
tests/test_torch_linalg_utils_g2.py     142     15     26      6    86%   17, 30, 36, 56->62, 67-69, 74, 80-83, 99, 135-136, 169
tests/test_torch_linalg_utils_g3.py     202      8     44      7    94%   17, 30, 48-50, 55, 102, 198, 218->225, 234->237, 246->249
---------------------------------------------------------------------------------
TOTAL                                   488     37     86     20    90%
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED tests/test_torch_linalg_utils_g1.py::test_bform_bilinear[dtype0-cpu-shape_X0-shape_A0-shape_Y0-flags0]
1 failed, 29 passed, 1 skipped in 0.71s

Error: exit 1