=== Run Tests ===
......F.....sFF.............F                                            [100%]
=================================== FAILURES ===================================
______________ test_upsampling_bilinear2d_basic[input_shape2-1.5] ______________

input_shape = (2, 3, 5, 5), scale_factor = 1.5, device = device(type='cpu')

    @pytest.mark.parametrize("input_shape, scale_factor", [
        ((1, 1, 3, 3), 2.0),  # Original from spec
        ((1, 3, 7, 7), 2.0),  # Param extension: multi-channel input
        ((2, 3, 5, 5), 1.5),  # Additional: batch and channels
        ((1, 2, 4, 4), 2.5),  # Additional: non-integer scale
    ])
    def test_upsampling_bilinear2d_basic(input_shape, scale_factor, device):
        """
        Test basic functionality of UpsamplingBilinear2d.
    
        Verifies that:
        1. Output shape matches expected dimensions
        2. Output dtype matches input dtype
        3. No NaN values in output
        4. Bilinear interpolation works correctly
        """
        # Create input tensor
        x = create_test_tensor(input_shape, dtype=torch.float32, device=device)
    
        # Create UpsamplingBilinear2d module
        upsample = nn.UpsamplingBilinear2d(scale_factor=scale_factor)
        upsample.to(device)
    
        # Forward pass
        output = upsample(x)
    
        # Calculate expected output shape
        batch_size, channels, height, width = input_shape
        expected_height = int(height * scale_factor)
        expected_width = int(width * scale_factor)
        expected_shape = (batch_size, channels, expected_height, expected_width)
    
        # Weak assertions
        # 1. Shape match
        assert output.shape == expected_shape, (
            f"Output shape mismatch: {output.shape} != {expected_shape}"
        )
    
        # 2. Dtype match
        assert output.dtype == x.dtype, (
            f"Output dtype mismatch: {output.dtype} != {x.dtype}"
        )
    
        # 3. No NaN
        assert not torch.any(torch.isnan(output)), "Output contains NaN values"
    
        # 4. Bilinear interpolation check
        # Oracle comparison with torch.nn.functional.interpolate
        # Note: UpsamplingBilinear2d uses align_corners=True by default
        expected = F.interpolate(
            x,
            scale_factor=scale_factor,
            mode='bilinear',
            align_corners=True,
            recompute_scale_factor=True
        )
    
        # Check if output matches oracle
        # Bilinear interpolation might have small numerical differences
        close = torch.allclose(output, expected, rtol=1e-5, atol=1e-8)
        if not close:
            max_diff = torch.max(torch.abs(output - expected)).item()
            mean_diff = torch.mean(torch.abs(output - expected)).item()
    
            # For bilinear interpolation with align_corners=True,
            # differences should be very small
            if max_diff < 1e-7:  # Acceptable numerical error
                return
    
            raise AssertionError(
                f"Output does not match F.interpolate oracle for bilinear interpolation\n"
                f"Max diff: {max_diff:.6e}, Mean diff: {mean_diff:.6e}"
            )
    
        # Additional check: verify align_corners=True behavior
        # With align_corners=True, corner pixels should be preserved
        if scale_factor == 2.0 and input_shape == (1, 1, 3, 3):
            # Check that corner pixels are preserved
            input_corners = [
                x[0, 0, 0, 0],      # top-left
                x[0, 0, 0, -1],     # top-right
                x[0, 0, -1, 0],     # bottom-left
                x[0, 0, -1, -1],    # bottom-right
            ]
    
            output_corners = [
                output[0, 0, 0, 0],           # top-left
                output[0, 0, 0, -1],          # top-right
                output[0, 0, -1, 0],          # bottom-left
                output[0, 0, -1, -1],         # bottom-right
            ]
    
            for i, (in_corner, out_corner) in enumerate(zip(input_corners, output_corners)):
                assert torch.allclose(in_corner, out_corner, rtol=1e-5, atol=1e-8), (
                    f"Corner {i} not preserved with align_corners=True"
                )
    
        # Check that scaling is correct
        actual_scale_h = output.shape[2] / height
        actual_scale_w = output.shape[3] / width
>       assert abs(actual_scale_h - scale_factor) < 0.01, (
            f"Height scaling incorrect: {actual_scale_h} != {scale_factor}"
        )
E       AssertionError: Height scaling incorrect: 1.4 != 1.5
E       assert 0.10000000000000009 < 0.01
E        +  where 0.10000000000000009 = abs((1.4 - 1.5))

tests/test_torch_nn_modules_upsampling_g2.py:265: AssertionError
________________________ test_upsampling_nearest2d_repr ________________________

    def test_upsampling_nearest2d_repr():
        """Test string representation of UpsamplingNearest2d."""
        module = nn.UpsamplingNearest2d(scale_factor=2.0)
        repr_str = repr(module)
        assert "UpsamplingNearest2d" in repr_str
        assert "scale_factor=2.0" in repr_str
>       assert "size=None" in repr_str or "size" in repr_str
E       AssertionError: assert ('size=None' in 'UpsamplingNearest2d(scale_factor=2.0, mode=nearest)' or 'size' in 'UpsamplingNearest2d(scale_factor=2.0, mode=nearest)')

tests/test_torch_nn_modules_upsampling_g2.py:488: AssertionError
_______________________ test_upsampling_bilinear2d_repr ________________________

    def test_upsampling_bilinear2d_repr():
        """Test string representation of UpsamplingBilinear2d."""
        module = nn.UpsamplingBilinear2d(scale_factor=1.5)
        repr_str = repr(module)
        assert "UpsamplingBilinear2d" in repr_str
        assert "scale_factor=1.5" in repr_str
>       assert "size=None" in repr_str or "size" in repr_str
E       AssertionError: assert ('size=None' in 'UpsamplingBilinear2d(scale_factor=1.5, mode=bilinear)' or 'size' in 'UpsamplingBilinear2d(scale_factor=1.5, mode=bilinear)')

tests/test_torch_nn_modules_upsampling_g2.py:496: AssertionError
______________________ test_upsampling_deprecated_warning ______________________

    def test_upsampling_deprecated_warning():
        """Test that Upsampling modules emit deprecation warning."""
>       with pytest.warns(UserWarning, match="deprecated"):
E       Failed: DID NOT WARN. No warnings of type (<class 'UserWarning'>,) were emitted.
E        Emitted warnings: [].

tests/test_torch_nn_modules_upsampling_g2.py:589: Failed
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.10.19-final-0 _______________

Name                                           Stmts   Miss Branch BrPart  Cover   Missing
------------------------------------------------------------------------------------------
tests/test_torch_nn_modules_upsampling_g2.py     221     28     34      5    83%   44-58, 226-234, 422->428, 441-444, 449-457, 592-593, 596
------------------------------------------------------------------------------------------
TOTAL                                            221     28     34      5    83%
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED tests/test_torch_nn_modules_upsampling_g2.py::test_upsampling_bilinear2d_basic[input_shape2-1.5]
FAILED tests/test_torch_nn_modules_upsampling_g2.py::test_upsampling_nearest2d_repr
FAILED tests/test_torch_nn_modules_upsampling_g2.py::test_upsampling_bilinear2d_repr
FAILED tests/test_torch_nn_modules_upsampling_g2.py::test_upsampling_deprecated_warning
4 failed, 24 passed, 1 skipped in 0.59s

Error: exit 1