# torch.nn.init 测试需求

## 1. 目标与范围
- 验证PyTorch神经网络权重初始化函数的正确性
- 测试原地修改张量的初始化操作
- 验证不同分布参数下的统计特性
- 不包含：自定义初始化函数、第三方扩展、训练过程验证

## 2. 输入与约束
- 参数：tensor (Tensor, 至少2维), 分布参数(a,b,mean,std,gain), 模式参数(mode, nonlinearity)
- 有效范围：张量维度≥2，fan计算要求有效形状
- 特殊约束：eye_(2D), dirac_(3-5D), sparse_(2D)
- 必需组合：tensor必选，其他参数有默认值
- 随机性：使用torch随机数生成器，需控制随机种子

## 3. 输出与判定
- 返回结构：原地修改后的输入张量
- 容差：浮点误差<1e-6，统计分布误差<5%
- 状态检查：张量值改变，梯度计算禁用，随机状态变化

## 4. 错误与异常场景
- 非法输入：维度<2，None输入，非张量类型
- 边界值：空张量，零元素张量（警告），极端形状(1×1)
- 参数越界：sparsity∈[0,1]，gain>0，std>0
- 维度不匹配：eye_非2D，dirac_非3-5D，sparse_非2D

## 5. 依赖与环境
- 依赖：torch库，CUDA设备（可选）
- 需要mock：随机数生成器，梯度计算上下文
- 环境要求：Python 3.8+，PyTorch 1.9+

## 6. 覆盖与优先级
- 必测路径：
  1. 主要初始化函数（uniform_, normal_, xavier_, kaiming_）
  2. 特殊初始化函数（eye_, dirac_, sparse_）
  3. 不同dtype兼容性（float32, float64）
  4. 统计分布验证（均值、方差、边界）
  5. 原地操作和梯度禁用验证

- 可选路径：
  - 所有20+个函数的参数组合
  - 不同非线性函数参数
  - 极端形状张量（超大/超小）
  - 稀疏度边界测试
  - 多设备测试（CPU/GPU）

- 已知风险：
  - 缺少__all__定义，API边界模糊
  - 部分维度限制文档不明确
  - 零维/一维张量处理未定义
  - 随机性测试的统计稳定性