=== Run Tests ===
...........F........                                                     [100%]
=================================== FAILURES ===================================
_____________________________ test_invalid_inputs ______________________________

    def test_invalid_inputs() -> None:
        """测试非法输入场景"""
    
        # 测试 xavier_uniform_ 的非法输入
        # 注意：传入None会抛出AttributeError而不是RuntimeError
        # 因为None没有dim属性
        with pytest.raises(AttributeError):
            # 非张量输入
            init.xavier_uniform_(None)
    
        # 测试 kaiming_uniform_ 的非法模式
        tensor = torch.empty(2, 3)
        with pytest.raises(ValueError, match="Mode .* not supported, please use one of"):
            init.kaiming_uniform_(tensor, mode="invalid_mode")
    
        # 测试非法非线性函数
        with pytest.raises(ValueError, match="nonlinearity not found"):
>           init.kaiming_uniform_(tensor, nonlinearity="invalid_nonlinearity")

tests/test_torch_nn_init_g2.py:275: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/nn/init.py:408: in kaiming_uniform_
    gain = calculate_gain(nonlinearity, a)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

nonlinearity = 'invalid_nonlinearity', param = 0

    def calculate_gain(nonlinearity, param=None):
        r"""Return the recommended gain value for the given nonlinearity function.
        The values are as follows:
    
        ================= ====================================================
        nonlinearity      gain
        ================= ====================================================
        Linear / Identity :math:`1`
        Conv{1,2,3}D      :math:`1`
        Sigmoid           :math:`1`
        Tanh              :math:`\frac{5}{3}`
        ReLU              :math:`\sqrt{2}`
        Leaky Relu        :math:`\sqrt{\frac{2}{1 + \text{negative\_slope}^2}}`
        SELU              :math:`\frac{3}{4}`
        ================= ====================================================
    
        .. warning::
            In order to implement `Self-Normalizing Neural Networks`_ ,
            you should use ``nonlinearity='linear'`` instead of ``nonlinearity='selu'``.
            This gives the initial weights a variance of ``1 / N``,
            which is necessary to induce a stable fixed point in the forward pass.
            In contrast, the default gain for ``SELU`` sacrifices the normalisation
            effect for more stable gradient flow in rectangular layers.
    
        Args:
            nonlinearity: the non-linear function (`nn.functional` name)
            param: optional parameter for the non-linear function
    
        Examples:
            >>> gain = nn.init.calculate_gain('leaky_relu', 0.2)  # leaky_relu with negative_slope=0.2
    
        .. _Self-Normalizing Neural Networks: https://papers.nips.cc/paper/2017/hash/5d44ee6f2c3f71b73125876103c8f6c4-Abstract.html
        """
        linear_fns = ['linear', 'conv1d', 'conv2d', 'conv3d', 'conv_transpose1d', 'conv_transpose2d', 'conv_transpose3d']
        if nonlinearity in linear_fns or nonlinearity == 'sigmoid':
            return 1
        elif nonlinearity == 'tanh':
            return 5.0 / 3
        elif nonlinearity == 'relu':
            return math.sqrt(2.0)
        elif nonlinearity == 'leaky_relu':
            if param is None:
                negative_slope = 0.01
            elif not isinstance(param, bool) and isinstance(param, int) or isinstance(param, float):
                # True/False are instances of int, hence check above
                negative_slope = param
            else:
                raise ValueError("negative_slope {} not a valid number".format(param))
            return math.sqrt(2.0 / (1 + negative_slope ** 2))
        elif nonlinearity == 'selu':
            return 3.0 / 4  # Value found empirically (https://github.com/pytorch/pytorch/pull/50664)
        else:
>           raise ValueError("Unsupported nonlinearity {}".format(nonlinearity))
E           ValueError: Unsupported nonlinearity invalid_nonlinearity

/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/nn/init.py:119: ValueError

During handling of the above exception, another exception occurred:

    def test_invalid_inputs() -> None:
        """测试非法输入场景"""
    
        # 测试 xavier_uniform_ 的非法输入
        # 注意：传入None会抛出AttributeError而不是RuntimeError
        # 因为None没有dim属性
        with pytest.raises(AttributeError):
            # 非张量输入
            init.xavier_uniform_(None)
    
        # 测试 kaiming_uniform_ 的非法模式
        tensor = torch.empty(2, 3)
        with pytest.raises(ValueError, match="Mode .* not supported, please use one of"):
            init.kaiming_uniform_(tensor, mode="invalid_mode")
    
        # 测试非法非线性函数
>       with pytest.raises(ValueError, match="nonlinearity not found"):
E       AssertionError: Regex pattern did not match.
E         Expected regex: 'nonlinearity not found'
E         Actual message: 'Unsupported nonlinearity invalid_nonlinearity'

tests/test_torch_nn_init_g2.py:274: AssertionError
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.10.19-final-0 _______________

Name                             Stmts   Miss Branch BrPart  Cover   Missing
----------------------------------------------------------------------------
test_sparse_behavior.py             53     53      0      0     0%   1-61
tests/test_torch_nn_init_g1.py     118     19     16      6    81%   20, 58, 110->114, 129->exit, 176->180, 207->exit, 296-323
tests/test_torch_nn_init_g2.py     132     20     24      7    81%   20, 58, 67, 158-159, 223->229, 235->240, 241, 327-349
tests/test_torch_nn_init_g3.py     275     83     84     21    67%   20, 38, 59->exit, 90->141, 141->exit, 158->exit, 188->237, 216->228, 237->310, 252->292, 274-288, 292->302, 302->310, 310->exit, 349-366, 389-426, 429->471, 452->455, 460-468, 473-480, 485-492, 532-534, 578-600
----------------------------------------------------------------------------
TOTAL                              578    175    124     34    68%
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED tests/test_torch_nn_init_g2.py::test_invalid_inputs - AssertionError: ...
1 failed, 19 passed in 0.86s

Error: exit 1