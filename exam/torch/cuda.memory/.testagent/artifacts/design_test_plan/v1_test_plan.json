{
  "plan_version": 2,
  "target": "torch.cuda.memory",
  "block_rules": {
    "header_block": "HEADER",
    "footer_block": "FOOTER",
    "case_prefix": "CASE_",
    "case_format": "CASE_01"
  },
  "iteration_strategy": {
    "round1": {"include": "SMOKE_SET", "assert_level": "weak", "max_blocks": 5},
    "roundN": {"only_fix_failed_blocks": true, "block_limit": 3, "promote_deferred": true},
    "final": {"enable_strong_asserts": true, "coverage_optional": true}
  },
  "test_files": {
    "default": "tests/test_torch_cuda_memory.py",
    "all_pattern": "tests/test_torch_cuda_memory_*.py",
    "groups": {
      "G1": "tests/test_torch_cuda_memory_basic.py",
      "G2": "tests/test_torch_cuda_memory_stats.py",
      "G3": "tests/test_torch_cuda_memory_advanced.py"
    }
  },
  "active_group_order": ["G1", "G2", "G3"],
  "groups": [
    {
      "group_id": "G1",
      "title": "基础内存操作",
      "entrypoints": ["memory_allocated", "max_memory_allocated", "empty_cache", "memory_reserved", "max_memory_reserved"],
      "smoke_set": ["CASE_01", "CASE_02"],
      "deferred_set": ["CASE_03", "CASE_04"],
      "note": "测试基础内存分配、释放和缓存管理功能"
    },
    {
      "group_id": "G2",
      "title": "内存统计与监控",
      "entrypoints": ["memory_stats", "memory_stats_as_nested_dict", "memory_summary", "memory_snapshot"],
      "smoke_set": ["CASE_05", "CASE_06"],
      "deferred_set": ["CASE_07", "CASE_08"],
      "note": "测试内存统计查询和监控功能"
    },
    {
      "group_id": "G3",
      "title": "高级功能与异常处理",
      "entrypoints": ["caching_allocator_alloc", "caching_allocator_delete", "list_gpu_processes", "set_per_process_memory_fraction"],
      "smoke_set": ["CASE_09"],
      "deferred_set": ["CASE_10", "CASE_11", "CASE_12"],
      "note": "测试高级内存操作和异常场景处理"
    }
  ],
  "cases": [
    {
      "tc_id": "TC-01",
      "block_id": "CASE_01",
      "group_id": "G1",
      "name": "基础内存分配与释放统计",
      "priority": "High",
      "param_matrix": [
        {"device": 0, "size": 1024, "dtype": "float32", "shape": [2, 2]}
      ],
      "asserts": {
        "weak": ["memory_allocated_increases", "memory_allocated_decreases", "basic_property"],
        "strong": ["exact_memory_count", "peak_memory_correct", "no_memory_leak"]
      },
      "oracle": "torch.cuda.memory_allocated",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 70,
      "max_params": 5,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-02",
      "block_id": "CASE_02",
      "group_id": "G1",
      "name": "empty_cache 缓存清理功能",
      "priority": "High",
      "param_matrix": [
        {"device": 0, "cache_size": 2048, "iterations": 3}
      ],
      "asserts": {
        "weak": ["cache_reduced_after_empty", "memory_consistent", "basic_property"],
        "strong": ["cache_fully_cleared", "performance_improvement", "no_side_effects"]
      },
      "oracle": "torch.cuda.empty_cache",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 65,
      "max_params": 4,
      "is_parametrized": false,
      "requires_mock": false
    },
    {
      "tc_id": "TC-03",
      "block_id": "CASE_03",
      "group_id": "G1",
      "name": "多设备内存操作隔离性",
      "priority": "Medium",
      "param_matrix": [
        {"devices": [0, 1], "size": 512, "dtype": "float32"}
      ],
      "asserts": {
        "weak": ["device_isolation", "memory_independent", "basic_property"],
        "strong": ["exact_device_mapping", "no_cross_device_leak", "concurrent_safe"]
      },
      "oracle": "torch.cuda.memory_allocated",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 85,
      "max_params": 4,
      "is_parametrized": true,
      "requires_mock": true
    },
    {
      "tc_id": "TC-04",
      "block_id": "CASE_04",
      "group_id": "G1",
      "name": "内存保留与分配关系验证",
      "priority": "Medium",
      "param_matrix": [
        {"device": 0, "size": 1024, "dtype": "float32"}
      ],
      "asserts": {
        "weak": ["reserved_greater_equal_allocated", "basic_property", "consistency"],
        "strong": ["exact_reserved_ratio", "cache_behavior", "fragmentation_analysis"]
      },
      "oracle": "torch.cuda.memory_reserved",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 70,
      "max_params": 4,
      "is_parametrized": false,
      "requires_mock": false
    },
    {
      "tc_id": "TC-05",
      "block_id": "CASE_05",
      "group_id": "G2",
      "name": "内存统计字典结构完整性",
      "priority": "High",
      "param_matrix": [
        {"device": 0, "abbreviated": false}
      ],
      "asserts": {
        "weak": ["dict_structure", "required_keys", "basic_property"],
        "strong": ["nested_dict_correct", "all_statistics_present", "value_ranges_valid"]
      },
      "oracle": "torch.cuda.memory_stats_as_nested_dict",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 75,
      "max_params": 3,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-06",
      "block_id": "CASE_06",
      "group_id": "G2",
      "name": "memory_summary 格式化输出",
      "priority": "High",
      "param_matrix": [
        {"device": 0, "abbreviated": true}
      ],
      "asserts": {
        "weak": ["output_is_string", "contains_key_info", "basic_property"],
        "strong": ["format_correct", "abbreviated_vs_full", "all_sections_present"]
      },
      "oracle": "torch.cuda.memory_summary",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 70,
      "max_params": 3,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-07",
      "block_id": "CASE_07",
      "group_id": "G2",
      "name": "内存快照功能验证",
      "priority": "Medium",
      "param_matrix": [
        {"device": 0, "snapshot_count": 2}
      ],
      "asserts": {
        "weak": ["snapshot_structure", "comparison_possible", "basic_property"],
        "strong": ["delta_calculation", "trend_analysis", "performance_impact"]
      },
      "oracle": "torch.cuda.memory_snapshot",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 80,
      "max_params": 3,
      "is_parametrized": false,
      "requires_mock": false
    },
    {
      "tc_id": "TC-08",
      "block_id": "CASE_08",
      "group_id": "G2",
      "name": "大池小池分别统计准确性",
      "priority": "Medium",
      "param_matrix": [
        {"device": 0, "small_size": 512, "large_size": 2048}
      ],
      "asserts": {
        "weak": ["pool_categories", "size_threshold", "basic_property"],
        "strong": ["exact_pool_allocation", "fragmentation_metrics", "optimization_effects"]
      },
      "oracle": "torch.cuda.memory_stats",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 85,
      "max_params": 4,
      "is_parametrized": false,
      "requires_mock": false
    },
    {
      "tc_id": "TC-09",
      "block_id": "CASE_09",
      "group_id": "G3",
      "name": "内存分配器直接操作",
      "priority": "High",
      "param_matrix": [
        {"device": 0, "size": 1024}
      ],
      "asserts": {
        "weak": ["allocator_works", "pointer_valid", "basic_property"],
        "strong": ["memory_alignment", "fragmentation_impact", "performance_comparison"]
      },
      "oracle": "torch.cuda.caching_allocator_alloc",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 75,
      "max_params": 3,
      "is_parametrized": false,
      "requires_mock": true
    },
    {
      "tc_id": "TC-10",
      "block_id": "CASE_10",
      "group_id": "G3",
      "name": "进程内存限制设置",
      "priority": "Medium",
      "param_matrix": [
        {"device": 0, "fraction": 0.5}
      ],
      "asserts": {
        "weak": ["fraction_applied", "memory_limited", "basic_property"],
        "strong": ["exact_limit_enforcement", "dynamic_adjustment", "recovery_after_reset"]
      },
      "oracle": "torch.cuda.set_per_process_memory_fraction",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 80,
      "max_params": 3,
      "is_parametrized": true,
      "requires_mock": true
    },
    {
      "tc_id": "TC-11",
      "block_id": "CASE_11",
      "group_id": "G3",
      "name": "GPU进程列表查询",
      "priority": "Low",
      "param_matrix": [
        {"device": 0}
      ],
      "asserts": {
        "weak": ["returns_list", "contains_pid", "basic_property"],
        "strong": ["process_details", "memory_usage_correct", "real_time_update"]
      },
      "oracle": "torch.cuda.list_gpu_processes",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 85,
      "max_params": 2,
      "is_parametrized": false,
      "requires_mock": true
    },
    {
      "tc_id": "TC-12",
      "block_id": "CASE_12",
      "group_id": "G3",
      "name": "异常参数错误处理",
      "priority": "Medium",
      "param_matrix": [
        {"device": "invalid", "size": -1, "fraction": 1.5}
      ],
      "asserts": {
        "weak": ["raises_exception", "exception_type", "basic_property"],
        "strong": ["error_message_format", "state_preservation", "recovery_mechanism"]
      },
      "oracle": "torch.cuda.memory_allocated",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 75,
      "max_params": 4,
      "is_parametrized": true,
      "requires_mock": true
    }
  ],
  "param_extensions": [
    {
      "base_block_id": "CASE_01",
      "priority": "Medium",
      "params": {"device": 0, "size": 4096, "dtype": "float64", "shape": [4, 4]},
      "note": "作为参数扩展：更大内存分配和双精度测试"
    },
    {
      "base_block_id": "CASE_01",
      "priority": "Low",
      "params": {"device": 0, "size": 128, "dtype": "int8", "shape": [16, 8]},
      "note": "作为参数扩展：小内存分配和整数类型测试"
    },
    {
      "base_block_id": "CASE_05",
      "priority": "Medium",
      "params": {"device": 0, "abbreviated": true},
      "note": "作为参数扩展：简略统计模式测试"
    },
    {
      "base_block_id": "CASE_10",
      "priority": "Low",
      "params": {"device": 0, "fraction": 0.25},
      "note": "作为参数扩展：不同内存限制比例测试"
    },
    {
      "base_block_id": "CASE_10",
      "priority": "Low",
      "params": {"device": 0, "fraction": 0.75},
      "note": "作为参数扩展：高内存限制比例测试"
    }
  ],
  "smoke_set": ["CASE_01", "CASE_02", "CASE_05", "CASE_06", "CASE_09"],
  "deferred_set": ["CASE_03", "CASE_04", "CASE_07", "CASE_08", "CASE_10", "CASE_11", "CASE_12"]
}