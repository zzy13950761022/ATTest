# torch.jit._serialization 测试计划

## 1. 测试策略
- 单元测试框架：pytest
- 隔离策略：使用临时文件目录、mock文件系统操作、fixtures管理测试资源
- 随机性处理：固定随机种子确保可重现性，使用标准测试数据生成器
- 设备管理：CPU为默认设备，GPU测试条件化执行

## 2. 生成规格摘要（来自 test_plan.json）
- **SMOKE_SET**: CASE_01（基本文件序列化）、CASE_02（缓冲区序列化）、CASE_03（设备映射测试）、CASE_04（文件对象接口）
- **DEFERRED_SET**: CASE_05（复杂模块序列化）、CASE_06-CASE_09（待定义）
- **group列表**: G1（核心序列化功能）、G2（设备与参数扩展）、G3（边界与异常处理）
- **active_group_order**: G1 → G2 → G3
- **断言分级策略**: 首轮使用weak断言（文件创建、模块加载、结构保持），后续启用strong断言（精确参数值、梯度保持）
- **预算策略**: 
  - size: S（70-90行）、M（>90行）
  - max_lines: 65-90行
  - max_params: 5-6个参数
  - 参数化测试优先

## 3. 数据与边界
- **正常数据集**: 简单ScriptModule（线性层+激活函数）、嵌套ScriptModule（多层结构）
- **随机生成策略**: 固定种子生成随机权重，标准正态分布初始化
- **边界值**: 
  - 空ScriptModule（无参数）
  - 超大参数张量（内存边界）
  - 特殊数据类型（bfloat16, complex64）
  - 零尺寸张量
- **极端形状**: 高维张量（4D+）、不规则形状
- **空输入**: 空额外文件字典、None参数处理
- **负例与异常场景**:
  - 文件不存在/权限不足
  - 无效map_location参数
  - 不支持的文件对象接口
  - 包含原生Python函数的模块
  - 磁盘空间不足模拟

## 4. 覆盖映射
| TC ID | 需求覆盖 | 约束验证 |
|-------|----------|----------|
| TC-01 | 基本save/load循环 | ScriptModule要求、文件操作 |
| TC-02 | 缓冲区序列化 | 内存缓冲区接口 |
| TC-03 | 设备映射功能 | 设备迁移逻辑 |
| TC-04 | 文件对象接口 | 文件方法要求 |
| TC-05 | 复杂模块处理 | 嵌套结构保持 |

**尚未覆盖的风险点**:
- flatbuffer格式支持（依赖torch._C_flatbuffer）
- 跨版本兼容性细节
- 额外文件处理的具体限制
- 并发文件访问场景
- 超大模块序列化性能边界