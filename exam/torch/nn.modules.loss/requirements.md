# torch.nn.modules.loss 测试需求

## 1. 目标与范围
- 主要功能与期望行为：验证 PyTorch 损失函数模块中 20+ 个损失类的正确性，包括前向计算、参数处理、形状兼容性、数值稳定性
- 不在范围内的内容：反向传播梯度计算、优化器集成、分布式训练、自定义损失函数扩展

## 2. 输入与约束
- 参数列表（名称、类型/shape、默认值）：
  - `reduction` (str): 'none'|'mean'|'sum'，默认 'mean'
  - `weight` (Tensor/None): 形状 `(C,)`，仅加权损失类使用
  - `size_average` (bool/None): 已弃用，向后兼容
  - `reduce` (bool/None): 已弃用，向后兼容
- 有效取值范围/维度/设备要求：
  - 输入/目标张量：任意维度（* 表示任意维度）
  - 数值范围：因损失函数而异（如 BCELoss 输入需在 0-1）
  - 设备：CPU/GPU 张量兼容
- 必需与可选组合：
  - `reduction` 为必需参数（有默认值）
  - `weight` 仅对 `_WeightedLoss` 子类有效
- 随机性/全局状态要求：无随机性，无全局状态依赖

## 3. 输出与判定
- 期望返回结构及关键字段：Tensor 类型
- 容差/误差界（如浮点）：浮点误差容差 1e-5，极端值场景特殊处理
- 状态变化或副作用检查点：无副作用，不修改输入张量

## 4. 错误与异常场景
- 非法输入/维度/类型触发的异常或警告：
  - 无效 `reduction` 值触发 ValueError
  - 形状不匹配触发 RuntimeError
  - 类型错误触发 TypeError
  - 弃用参数 `size_average`/`reduce` 触发警告
- 边界值（空、None、0 长度、极端形状/数值）：
  - 空张量输入
  - 零长度维度
  - 极端数值（inf, nan, 极大/极小值）
  - 形状极端（超大维度，单元素张量）

## 5. 依赖与环境
- 外部资源/设备/网络/文件依赖：仅依赖 PyTorch 库，无外部资源
- 需要 mock/monkeypatch 的部分：无需 mock，纯计算函数

## 6. 覆盖与优先级
- 必测路径（高优先级，最多 5 条，短句）：
  1. 主要损失类（L1Loss, MSELoss, CrossEntropyLoss）基础功能
  2. `reduction` 三种模式正确性验证
  3. 形状兼容性：任意维度输入输出
  4. 数值稳定性：极端值处理（如 log(0)）
  5. 向后兼容：弃用参数 `size_average`/`reduce`
- 可选路径（中/低优先级合并为一组列表）：
  - 加权损失类权重参数验证
  - 复数输入支持（仅 L1Loss）
  - 设备兼容性（CPU/GPU）
  - 所有 20+ 损失类的完整覆盖
  - 批量维度特殊处理
  - 概率分布输入验证
- 已知风险/缺失信息（仅列条目，不展开）：
  - 类型注解不完整
  - 形状约束描述模糊
  - 复数支持范围不明确
  - 性能约束缺失
  - KLDivLoss 特殊 reduction 模式