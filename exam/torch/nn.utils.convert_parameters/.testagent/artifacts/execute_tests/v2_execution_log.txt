=== Run Tests ===
.F..                                                                     [100%]
=================================== FAILURES ===================================
___________ test_vector_to_parameters_length_mismatch[shapes0-True] ____________

shapes = [[2, 2], [3]], vec_length_mismatch = True

    @pytest.mark.parametrize("shapes,vec_length_mismatch", [
        ([[2, 2], [3]], True),  # Original test case with vector length mismatch
    ])
    def test_vector_to_parameters_length_mismatch(shapes, vec_length_mismatch):
        """Test case: 向量长度不匹配异常
        TC-04: 向量长度不匹配异常
        Priority: High
        Group: G2
        Assertion level: weak
        """
        # Skip if not testing mismatch
        if not vec_length_mismatch:
            return
    
        # Create parameters
        parameters = []
        total_elements = 0
    
        for i, shape in enumerate(shapes):
            tensor = torch.randn(shape, dtype=torch.float32)
            parameters.append(tensor)
            total_elements += tensor.numel()
    
        # Create a vector with wrong length (one element shorter)
        wrong_length = total_elements - 1
        vec = torch.randn(wrong_length, dtype=torch.float32)
    
        # Create target parameters
        target_parameters = [torch.empty_like(p) for p in parameters]
    
        # Weak assertions: should raise RuntimeError for length mismatch
        with pytest.raises(RuntimeError) as exc_info:
            convert_parameters.vector_to_parameters(vec, target_parameters)
    
        # Check exception message contains expected keywords
        error_msg = str(exc_info.value).lower()
    
        # The actual error message from PyTorch is:
        # "vector length invalid: got X but sum of param sizes is Y"
        assert "length" in error_msg or "size" in error_msg or "invalid" in error_msg, \
            f"Expected length-related error, got: {error_msg}"
    
        # Additional check: verify the error mentions the mismatch
        # The error typically contains the actual and expected lengths
>       assert str(wrong_length) in error_msg or str(total_elements) in error_msg, \
            f"Error message should mention lengths, got: {error_msg}"
E       AssertionError: Error message should mention lengths, got: shape '[3]' is invalid for input of size 2
E       assert ('6' in "shape '[3]' is invalid for input of size 2" or '7' in "shape '[3]' is invalid for input of size 2")
E        +  where '6' = str(6)
E        +  and   '7' = str(7)

tests/test_torch_nn_utils_convert_parameters_g2.py:143: AssertionError
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.10.19-final-0 _______________

Name                                                 Stmts   Miss Branch BrPart  Cover   Missing
------------------------------------------------------------------------------------------------
tests/test_torch_nn_utils_convert_parameters_g2.py      89     24     22      1    70%   111, 147-153, 179, 187-190, 197-205, 210-223
------------------------------------------------------------------------------------------------
TOTAL                                                   89     24     22      1    70%
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED tests/test_torch_nn_utils_convert_parameters_g2.py::test_vector_to_parameters_length_mismatch[shapes0-True]
1 failed, 3 passed in 0.74s

Error: exit 1