=== Run Tests ===
.s.sF....s..F...                                                         [100%]
=================================== FAILURES ===================================
___________________ test_parameters_to_vector_empty_iterable ___________________

    def test_parameters_to_vector_empty_iterable():
        """Test case: 空迭代器处理
        TC-05: 空迭代器处理
        Priority: Medium
        Group: G1
        Assertion level: weak (with strong assertions for final epoch)
        """
        # Test 1: Empty list
        print("Test 1: Empty list")
        empty_list = []
    
        # According to PyTorch implementation, empty iterable should work
        # It returns an empty tensor
>       vec = convert_parameters.parameters_to_vector(empty_list)

tests/test_torch_nn_utils_convert_parameters_g1.py:194: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

parameters = []

    def parameters_to_vector(parameters: Iterable[torch.Tensor]) -> torch.Tensor:
        r"""Convert parameters to one vector
    
        Args:
            parameters (Iterable[Tensor]): an iterator of Tensors that are the
                parameters of a model.
    
        Returns:
            The parameters represented by a single vector
        """
        # Flag for the device where the parameter is located
        param_device = None
    
        vec = []
        for param in parameters:
            # Ensure the parameters are located in the same device
            param_device = _check_param_device(param, param_device)
    
            vec.append(param.view(-1))
>       return torch.cat(vec)
E       RuntimeError: torch.cat(): expected a non-empty list of Tensors

/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/nn/utils/convert_parameters.py:24: RuntimeError
----------------------------- Captured stdout call -----------------------------
Test 1: Empty list
__________________ test_vector_to_parameters_non_tensor_input __________________

    def test_vector_to_parameters_non_tensor_input():
        """Test case: 非张量参数异常
        TC-07: 非张量参数异常
        Priority: Medium
        Group: G2
        Assertion level: weak (final epoch should use strong, but keeping weak for consistency)
        """
        # Test 1: Non-tensor vector input
        print("Test 1: Non-tensor vector input")
        vec_not_tensor = [1.0, 2.0, 3.0]  # List instead of tensor
        parameters = [torch.empty(3, dtype=torch.float32)]
    
        with pytest.raises(TypeError) as exc_info:
            convert_parameters.vector_to_parameters(vec_not_tensor, parameters)
    
        error_msg = str(exc_info.value).lower()
        assert "expected torch.tensor" in error_msg or "torch.tensor" in error_msg, \
            f"Expected TypeError about torch.Tensor, got: {error_msg}"
    
        # Test 2: Non-tensor in parameters list
        print("Test 2: Non-tensor in parameters list")
        vec = torch.randn(5, dtype=torch.float32)
        mixed_parameters = [torch.empty(3, dtype=torch.float32), "not a tensor", torch.empty(2, dtype=torch.float32)]
    
        # vector_to_parameters will iterate through parameters and check each one
        # The first parameter (tensor) will work, but when it tries to process the string,
        # it will call torch.typename() which returns 'str', and then raise TypeError
        with pytest.raises(TypeError) as exc_info2:
>           convert_parameters.vector_to_parameters(vec, mixed_parameters)

tests/test_torch_nn_utils_convert_parameters_g2.py:258: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/nn/utils/convert_parameters.py:46: in vector_to_parameters
    param_device = _check_param_device(param, param_device)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

param = 'not a tensor', old_param_device = -1

    def _check_param_device(param: torch.Tensor, old_param_device: Optional[int]) -> int:
        r"""This helper function is to check if the parameters are located
        in the same device. Currently, the conversion between model parameters
        and single vector form is not supported for multiple allocations,
        e.g. parameters in different GPUs, or mixture of CPU/GPU.
    
        Args:
            param ([Tensor]): a Tensor of a parameter of a model
            old_param_device (int): the device where the first parameter of a
                                    model is allocated.
    
        Returns:
            old_param_device (int): report device for the first time
        """
    
        # Meet the first parameter
        if old_param_device is None:
            old_param_device = param.get_device() if param.is_cuda else -1
        else:
            warn = False
>           if param.is_cuda:  # Check if in same GPU
E           AttributeError: 'str' object has no attribute 'is_cuda'

/opt/anaconda3/envs/testagent-experiment/lib/python3.10/site-packages/torch/nn/utils/convert_parameters.py:77: AttributeError
----------------------------- Captured stdout call -----------------------------
Test 1: Non-tensor vector input
Test 2: Non-tensor in parameters list
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.10.19-final-0 _______________

Name                                                 Stmts   Miss Branch BrPart  Cover   Missing
------------------------------------------------------------------------------------------------
cleanup.py                                               6      6      4      0     0%   1-8
cleanup_temp.py                                          6      6      4      0     0%   1-15
direct_run.py                                            9      9      2      0     0%   1-12
quick_test.py                                           31     31      0      0     0%   1-42
run_test2.py                                             8      8      0      0     0%   1-10
run_test.py                                              8      8      0      0     0%   1-10
test_error_behavior.py                                  44     44      4      0     0%   1-61
test_vector_length_behavior.py                          34     34      0      0     0%   1-47
test_vector_length_mismatch.py                          20     20      0      0     0%   1-32
tests/test_torch_nn_utils_convert_parameters_g1.py     258    120     86     15    53%   73, 77, 132, 153-176, 197-291, 307, 320, 325-333, 337, 355-356, 361-362, 368-385, 408->410, 434, 450, 466-474, 490, 499-502, 510-523, 528-545
tests/test_torch_nn_utils_convert_parameters_g2.py     246     68     94     19    70%   69, 75, 79, 91, 96, 139-141, 159, 260-311, 331, 345-350, 356, 360, 379, 384, 414, 430->444, 439-441, 456-458, 474->exit, 479, 491, 500, 508-511, 518-526, 531-544
------------------------------------------------------------------------------------------------
TOTAL                                                  670    354    194     34    48%
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED tests/test_torch_nn_utils_convert_parameters_g1.py::test_parameters_to_vector_empty_iterable
FAILED tests/test_torch_nn_utils_convert_parameters_g2.py::test_vector_to_parameters_non_tensor_input
2 failed, 11 passed, 3 skipped in 0.72s

Error: exit 1