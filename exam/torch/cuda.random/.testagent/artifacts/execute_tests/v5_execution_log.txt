=== Run Tests ===
.................................sssss..s......F.........ssssss.......   [100%]
=================================== FAILURES ===================================
_ TestTorchCudaRandomG2CudaUnavailable.test_multi_device_batch_management_cuda_unavailable _

self = <test_torch_cuda_random_g2_cuda_unavailable.TestTorchCudaRandomG2CudaUnavailable object at 0x132318280>

    def test_multi_device_batch_management_cuda_unavailable(self):
        """Test multi-device batch management when CUDA is not available."""
        with patch('torch.cuda.is_available', return_value=False):
            # Test all G2 functions in CUDA unavailable scenario
    
            # get_rng_state_all should return empty list (not raise exception)
            all_states = torch.cuda.get_rng_state_all()
            assert isinstance(all_states, list), "get_rng_state_all should return a list"
            assert len(all_states) == 0, "get_rng_state_all should return empty list when CUDA not available"
    
            # set_rng_state_all should NOT raise exception
            test_states = [torch.ByteTensor(100).random_(0, 256) for _ in range(2)]
            torch.cuda.set_rng_state_all(test_states)  # No exception expected
    
            # manual_seed_all should be silently ignored
            torch.cuda.manual_seed_all(42)
    
            # seed_all should be silently ignored
            torch.cuda.seed_all()
    
            # Test with mocked device_count
            with patch('torch.cuda.device_count', return_value=2):
                # With mocked device_count, get_rng_state_all will try to call get_rng_state()
                # for each device, which will raise AssertionError
>               with pytest.raises(AssertionError):
E               Failed: DID NOT RAISE <class 'AssertionError'>

tests/test_torch_cuda_random_g2_cuda_unavailable.py:117: Failed
================================ tests coverage ================================
______________ coverage: platform darwin, python 3.10.19-final-0 _______________

Name                                                  Stmts   Miss Branch BrPart  Cover   Missing
-------------------------------------------------------------------------------------------------
tests/test_torch_cuda_random_cuda_unavailable.py         83      0      2      0   100%
tests/test_torch_cuda_random_g1.py                      181    100     28      5    43%   38, 42, 47-48, 53-54, 59-60, 89-144, 172-251, 277, 302, 329-367, 494-497, 508, 519-529, 540-548, 580-586
tests/test_torch_cuda_random_g1_cuda_unavailable.py      81      0      2      0   100%
tests/test_torch_cuda_random_g2.py                      239    170     62      8    27%   34, 38, 47-48, 53-60, 96-188, 226-281, 311-313, 317-386, 416-418, 422-493, 528-530, 533-551, 561->exit, 566-567
tests/test_torch_cuda_random_g2_cuda_unavailable.py      75      1      2      0    99%   121
tests/test_torch_cuda_random_g2_temp.py                 149    123     40      0    14%   31-36, 45-46, 51-58, 81-177, 202-261, 278, 286-299, 305-323, 333-364
-------------------------------------------------------------------------------------------------
TOTAL                                                   808    394    136     13    47%
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED tests/test_torch_cuda_random_g2_cuda_unavailable.py::TestTorchCudaRandomG2CudaUnavailable::test_multi_device_batch_management_cuda_unavailable
1 failed, 57 passed, 12 skipped in 0.73s

Error: exit 1