# torch.cuda.random 测试计划

## 1. 测试策略
- 单元测试框架：pytest
- 隔离策略：使用 mock 模拟 CUDA 可用性、device_count 和 current_device
- 随机性处理：固定随机种子确保测试可重复性
- 设备管理：支持单 GPU 和多 GPU 环境测试

## 2. 生成规格摘要（来自 test_plan.json）
- **SMOKE_SET**: CASE_01, CASE_02, CASE_03, CASE_04（4个核心用例）
- **DEFERRED_SET**: CASE_05, CASE_06, CASE_07, CASE_08（4个扩展用例）
- **group 列表**: 
  - G1: 单设备状态管理（5个函数）
  - G2: 多设备状态管理（4个函数）
- **active_group_order**: G1, G2（优先测试单设备功能）
- **断言分级策略**: 首轮使用 weak 断言，最终轮启用 strong 断言
- **预算策略**: 
  - size: S（小型测试，50-80行）
  - max_lines: 45-80行
  - max_params: 2-4个参数

## 3. 数据与边界
- **正常数据集**: 有效 ByteTensor 状态、标准整数种子、有效设备索引
- **随机生成策略**: 使用固定种子生成可重复的随机状态张量
- **边界值测试**:
  - 设备索引边界（0, device_count-1）
  - 种子值边界（0, -1, 2^31-1）
  - 空状态列表和 None 输入
- **极端形状**: 不适用（状态张量形状由内部定义）
- **负例与异常场景**:
  - 无效设备索引（-1, 999）
  - 非 ByteTensor 状态类型
  - CUDA 不可用场景
  - 空状态列表输入

## 4. 覆盖映射
| TC ID | 需求覆盖 | 约束覆盖 | 优先级 |
|-------|----------|----------|--------|
| TC-01 | 单设备状态获取与设置 | 状态张量类型、设备参数 | High |
| TC-02 | 种子设置与查询 | 种子值范围、CUDA初始化 | High |
| TC-03 | 多设备状态批量管理 | 多GPU支持、状态列表格式 | High |
| TC-04 | 无效设备索引异常 | 错误处理、设备索引验证 | High |
| TC-05 | 非ByteTensor类型检查 | 类型约束、异常消息 | Medium |
| TC-06 | CUDA不可用场景 | 降级处理、无CUDA环境 | Medium |
| TC-07 | 空状态列表处理 | 输入验证、列表长度检查 | Medium |
| TC-08 | 极端种子值边界 | 种子值边界、整数范围 | Low |

## 5. 尚未覆盖的风险点
- 多线程并发访问安全性
- 不同 PyTorch 版本状态兼容性
- 内存格式连续性验证（contiguous_format）
- 设备字符串标识符的完整支持
- 状态张量形状的内部约束

## 6. 迭代策略
- **首轮**: 仅生成 SMOKE_SET（4个用例），使用 weak 断言
- **后续轮**: 修复失败用例，逐步启用 DEFERRED_SET
- **最终轮**: 启用 strong 断言，可选覆盖率检查