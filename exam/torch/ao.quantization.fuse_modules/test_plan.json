{
  "plan_version": 2,
  "target": "torch.ao.quantization.fuse_modules",
  "block_rules": {
    "header_block": "HEADER",
    "footer_block": "FOOTER",
    "case_prefix": "CASE_",
    "case_format": "CASE_01"
  },
  "iteration_strategy": {
    "round1": {
      "include": "SMOKE_SET",
      "assert_level": "weak",
      "max_blocks": 5
    },
    "roundN": {
      "only_fix_failed_blocks": true,
      "block_limit": 3,
      "promote_deferred": true
    },
    "final": {
      "enable_strong_asserts": true,
      "coverage_optional": true
    }
  },
  "test_files": {
    "default": "tests/test_torch_ao_quantization_fuse_modules.py",
    "all_pattern": "tests/test_torch_ao_quantization_fuse_modules_*.py",
    "groups": {
      "G1": "tests/test_torch_ao_quantization_fuse_modules_g1.py",
      "G2": "tests/test_torch_ao_quantization_fuse_modules_g2.py"
    }
  },
  "active_group_order": ["G1", "G2"],
  "groups": [
    {
      "group_id": "G1",
      "title": "核心融合功能",
      "entrypoints": ["fuse_modules"],
      "smoke_set": ["CASE_01", "CASE_02", "CASE_03"],
      "deferred_set": ["CASE_04", "CASE_05"],
      "note": "验证基本融合功能与参数行为"
    },
    {
      "group_id": "G2",
      "title": "边界与异常处理",
      "entrypoints": ["fuse_modules"],
      "smoke_set": ["CASE_06"],
      "deferred_set": ["CASE_07", "CASE_08", "CASE_09"],
      "note": "验证错误处理与边界情况"
    }
  ],
  "cases": [
    {
      "tc_id": "TC-01",
      "block_id": "CASE_01",
      "group_id": "G1",
      "name": "单组conv-bn-relu融合",
      "priority": "High",
      "param_matrix": [
        {
          "model_type": "SimpleConvBNReLU",
          "modules_to_fuse": ["conv", "bn", "relu"],
          "inplace": false,
          "fuser_func": "default",
          "fuse_custom_config_dict": null
        }
      ],
      "asserts": {
        "weak": ["model_type", "module_structure", "output_shape", "finite_output"],
        "strong": ["output_approx_equal", "fused_module_type", "identity_module_replacement"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 70,
      "max_params": 5,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-02",
      "block_id": "CASE_02",
      "group_id": "G1",
      "name": "多组模块融合",
      "priority": "High",
      "param_matrix": [
        {
          "model_type": "MultiLayerModel",
          "modules_to_fuse": [["conv1", "bn1", "relu1"], ["linear", "relu"]],
          "inplace": false,
          "fuser_func": "default",
          "fuse_custom_config_dict": null
        }
      ],
      "asserts": {
        "weak": ["model_type", "module_count", "output_shape", "finite_output"],
        "strong": ["output_approx_equal", "all_fused_modules", "correct_group_fusion"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 80,
      "max_params": 5,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-03",
      "block_id": "CASE_03",
      "group_id": "G1",
      "name": "inplace参数行为",
      "priority": "High",
      "param_matrix": [
        {
          "model_type": "SimpleConvBN",
          "modules_to_fuse": ["conv", "bn"],
          "inplace": true,
          "fuser_func": "default",
          "fuse_custom_config_dict": null
        },
        {
          "model_type": "SimpleConvBN",
          "modules_to_fuse": ["conv", "bn"],
          "inplace": false,
          "fuser_func": "default",
          "fuse_custom_config_dict": null
        }
      ],
      "asserts": {
        "weak": ["model_id_different", "module_structure", "output_shape"],
        "strong": ["output_approx_equal", "inplace_behavior", "original_model_preserved"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 75,
      "max_params": 5,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-04",
      "block_id": "CASE_04",
      "group_id": "G1",
      "name": "嵌套子模块融合",
      "priority": "Medium",
      "param_matrix": [
        {
          "model_type": "NestedModel",
          "modules_to_fuse": ["submodule.conv", "submodule.bn", "submodule.relu"],
          "inplace": false,
          "fuser_func": "default",
          "fuse_custom_config_dict": null
        }
      ],
      "asserts": {
        "weak": ["model_type", "nested_structure", "output_shape"],
        "strong": ["output_approx_equal", "nested_fusion_correct", "parent_structure_preserved"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 85,
      "max_params": 5,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-05",
      "block_id": "CASE_05",
      "group_id": "G1",
      "name": "不支持序列保持不变",
      "priority": "Medium",
      "param_matrix": [
        {
          "model_type": "UnsupportedSequence",
          "modules_to_fuse": ["conv", "relu", "conv"],
          "inplace": false,
          "fuser_func": "default",
          "fuse_custom_config_dict": null
        }
      ],
      "asserts": {
        "weak": ["model_type", "module_structure", "output_shape"],
        "strong": ["output_approx_equal", "modules_unchanged", "no_exception"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 70,
      "max_params": 5,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-06",
      "block_id": "CASE_06",
      "group_id": "G2",
      "name": "无效模块名称异常",
      "priority": "High",
      "param_matrix": [
        {
          "model_type": "SimpleModel",
          "modules_to_fuse": ["nonexistent_module"],
          "inplace": false,
          "fuser_func": "default",
          "fuse_custom_config_dict": null
        }
      ],
      "asserts": {
        "weak": ["exception_raised", "exception_type"],
        "strong": ["exception_message", "error_context"]
      },
      "oracle": "exception_pattern",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 60,
      "max_params": 4,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-07",
      "block_id": "CASE_07",
      "group_id": "G2",
      "name": "非Module类型输入",
      "priority": "Medium",
      "param_matrix": [
        {
          "model_type": "invalid",
          "modules_to_fuse": ["conv", "bn"],
          "inplace": false,
          "fuser_func": "default",
          "fuse_custom_config_dict": null
        }
      ],
      "asserts": {
        "weak": ["exception_raised", "exception_type"],
        "strong": ["exception_message", "type_check"]
      },
      "oracle": "exception_pattern",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 60,
      "max_params": 4,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-08",
      "block_id": "CASE_08",
      "group_id": "G2",
      "name": "空列表输入",
      "priority": "Low",
      "param_matrix": [
        {
          "model_type": "SimpleModel",
          "modules_to_fuse": [],
          "inplace": false,
          "fuser_func": "default",
          "fuse_custom_config_dict": null
        }
      ],
      "asserts": {
        "weak": ["no_exception", "model_type", "output_shape"],
        "strong": ["output_approx_equal", "no_changes"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 60,
      "max_params": 4,
      "is_parametrized": true,
      "requires_mock": false
    },
    {
      "tc_id": "TC-09",
      "block_id": "CASE_09",
      "group_id": "G2",
      "name": "自定义fuser_func",
      "priority": "Medium",
      "param_matrix": [
        {
          "model_type": "SimpleModel",
          "modules_to_fuse": ["conv", "bn"],
          "inplace": false,
          "fuser_func": "custom",
          "fuse_custom_config_dict": null
        }
      ],
      "asserts": {
        "weak": ["no_exception", "model_type", "output_shape"],
        "strong": ["custom_fuser_called", "output_approx_equal", "fuser_args_correct"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 80,
      "max_params": 5,
      "is_parametrized": true,
      "requires_mock": true
    }
  ],
  "param_extensions": [
    {
      "base_block_id": "CASE_01",
      "priority": "Medium",
      "params": {
        "model_type": "SimpleConvBNReLU",
        "modules_to_fuse": ["conv", "bn", "relu"],
        "inplace": true,
        "fuser_func": "default",
        "fuse_custom_config_dict": null
      },
      "note": "inplace=True参数扩展"
    },
    {
      "base_block_id": "CASE_01",
      "priority": "Low",
      "params": {
        "model_type": "SimpleConvBNReLU",
        "modules_to_fuse": ["conv", "bn", "relu"],
        "inplace": false,
        "fuser_func": "default",
        "fuse_custom_config_dict": {"preserve_attributes": ["training"]}
      },
      "note": "自定义配置扩展"
    },
    {
      "base_block_id": "CASE_02",
      "priority": "Medium",
      "params": {
        "model_type": "MultiLayerModel",
        "modules_to_fuse": [["conv1", "bn1"], ["linear", "relu"], ["conv2", "relu"]],
        "inplace": false,
        "fuser_func": "default",
        "fuse_custom_config_dict": null
      },
      "note": "三组融合扩展"
    },
    {
      "base_block_id": "CASE_06",
      "priority": "Low",
      "params": {
        "model_type": "SimpleModel",
        "modules_to_fuse": ["conv", "nonexistent", "relu"],
        "inplace": false,
        "fuser_func": "default",
        "fuse_custom_config_dict": null
      },
      "note": "混合有效无效模块名"
    }
  ],
  "smoke_set": ["CASE_01", "CASE_02", "CASE_03", "CASE_06"],
  "deferred_set": ["CASE_04", "CASE_05", "CASE_07", "CASE_08", "CASE_09"]
}