{
  "plan_version": 2,
  "target": "torch.nn.utils.weight_norm",
  "block_rules": {
    "header_block": "HEADER",
    "footer_block": "FOOTER",
    "case_prefix": "CASE_",
    "case_format": "CASE_01"
  },
  "iteration_strategy": {
    "round1": {"include": "SMOKE_SET", "assert_level": "weak", "max_blocks": 5},
    "roundN": {"only_fix_failed_blocks": true, "block_limit": 3, "promote_deferred": true},
    "final": {"enable_strong_asserts": true, "coverage_optional": true}
  },
  "test_files": {
    "default": "tests/test_torch_nn_utils_weight_norm.py",
    "all_pattern": "tests/test_torch_nn_utils_weight_norm_*.py",
    "groups": {
      "G1": "tests/test_torch_nn_utils_weight_norm_g1.py",
      "G2": "tests/test_torch_nn_utils_weight_norm_g2.py"
    }
  },
  "active_group_order": ["G1", "G2"],
  "groups": [
    {
      "group_id": "G1",
      "title": "核心功能验证",
      "entrypoints": ["weight_norm"],
      "smoke_set": ["CASE_01", "CASE_02", "CASE_03"],
      "deferred_set": ["CASE_04", "CASE_05"],
      "note": "验证权重归一化的基本功能、参数分解和钩子机制"
    },
    {
      "group_id": "G2",
      "title": "边界与异常处理",
      "entrypoints": ["weight_norm"],
      "smoke_set": ["CASE_06"],
      "deferred_set": ["CASE_07", "CASE_08", "CASE_09"],
      "note": "测试错误输入、边界情况和异常场景"
    }
  ],
  "cases": [
    {
      "tc_id": "TC-01",
      "block_id": "CASE_01",
      "group_id": "G1",
      "name": "Linear层默认参数权重归一化",
      "priority": "High",
      "param_matrix": [
        {
          "module_type": "Linear",
          "in_features": 20,
          "out_features": 40,
          "name": "weight",
          "dim": 0,
          "device": "cpu",
          "dtype": "float32"
        }
      ],
      "asserts": {
        "weak": ["returns_module", "has_g_param", "has_v_param", "no_original_param"],
        "strong": ["weight_reconstruction", "forward_hook_registered", "param_shapes_correct"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 70,
      "max_params": 6,
      "is_parametrized": false,
      "requires_mock": false,
      "mock_targets": []
    },
    {
      "tc_id": "TC-02",
      "block_id": "CASE_02",
      "group_id": "G1",
      "name": "权重分解正确性验证",
      "priority": "High",
      "param_matrix": [
        {
          "module_type": "Linear",
          "in_features": 10,
          "out_features": 20,
          "name": "weight",
          "dim": 0,
          "device": "cpu",
          "dtype": "float32"
        }
      ],
      "asserts": {
        "weak": ["g_param_exists", "v_param_exists", "weight_reconstructed"],
        "strong": ["reconstruction_error_lt_1e-6", "norm_calculation_correct", "dim_handling_correct"]
      },
      "oracle": "mathematical_verification",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 80,
      "max_params": 6,
      "is_parametrized": false,
      "requires_mock": false,
      "mock_targets": []
    },
    {
      "tc_id": "TC-03",
      "block_id": "CASE_03",
      "group_id": "G1",
      "name": "dim=None全局范数计算",
      "priority": "High",
      "param_matrix": [
        {
          "module_type": "Linear",
          "in_features": 15,
          "out_features": 25,
          "name": "weight",
          "dim": null,
          "device": "cpu",
          "dtype": "float32"
        }
      ],
      "asserts": {
        "weak": ["returns_module", "has_g_param", "has_v_param", "global_norm_applied"],
        "strong": ["global_norm_calculation", "reconstruction_global", "hook_registered"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 70,
      "max_params": 6,
      "is_parametrized": false,
      "requires_mock": false,
      "mock_targets": []
    },
    {
      "tc_id": "TC-04",
      "block_id": "CASE_04",
      "group_id": "G1",
      "name": "不同参数名称归一化",
      "priority": "High",
      "param_matrix": [
        {
          "module_type": "Linear",
          "in_features": 10,
          "out_features": 10,
          "name": "bias",
          "dim": 0,
          "device": "cpu",
          "dtype": "float32"
        }
      ],
      "asserts": {
        "weak": ["returns_module", "has_bias_g_param", "has_bias_v_param", "no_original_bias"],
        "strong": ["bias_reconstruction", "param_naming_correct", "hook_registered"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 70,
      "max_params": 6,
      "is_parametrized": false,
      "requires_mock": false,
      "mock_targets": []
    },
    {
      "tc_id": "TC-05",
      "block_id": "CASE_05",
      "group_id": "G1",
      "name": "前向传播钩子触发验证",
      "priority": "High",
      "param_matrix": [
        {
          "module_type": "Linear",
          "in_features": 5,
          "out_features": 8,
          "name": "weight",
          "dim": 0,
          "device": "cpu",
          "dtype": "float32"
        }
      ],
      "asserts": {
        "weak": ["hook_registered", "weight_recomputed_on_forward", "output_shape_correct"],
        "strong": ["hook_called_before_forward", "weight_update_correct", "multiple_forward_consistent"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 85,
      "max_params": 6,
      "is_parametrized": false,
      "requires_mock": true,
      "mock_targets": ["torch.nn.utils.weight_norm.WeightNorm.apply"]
    },
    {
      "tc_id": "TC-06",
      "block_id": "CASE_06",
      "group_id": "G2",
      "name": "无效模块类型错误处理",
      "priority": "High",
      "param_matrix": [
        {
          "module_type": "invalid",
          "name": "weight",
          "dim": 0,
          "device": "cpu",
          "dtype": "float32"
        }
      ],
      "asserts": {
        "weak": ["raises_type_error", "error_message_contains"],
        "strong": ["specific_error_type", "error_message_matches"]
      },
      "oracle": "exception_verification",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 60,
      "max_params": 5,
      "is_parametrized": false,
      "requires_mock": false,
      "mock_targets": []
    },
    {
      "tc_id": "TC-07",
      "block_id": "CASE_07",
      "group_id": "G2",
      "name": "不存在的参数名称错误",
      "priority": "Medium",
      "param_matrix": [
        {
          "module_type": "Linear",
          "in_features": 10,
          "out_features": 20,
          "name": "nonexistent",
          "dim": 0,
          "device": "cpu",
          "dtype": "float32"
        }
      ],
      "asserts": {
        "weak": ["raises_attribute_error", "error_message_contains"],
        "strong": ["specific_attribute_error", "parameter_name_in_message"]
      },
      "oracle": "exception_verification",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 60,
      "max_params": 6,
      "is_parametrized": false,
      "requires_mock": false,
      "mock_targets": []
    },
    {
      "tc_id": "TC-08",
      "block_id": "CASE_08",
      "group_id": "G2",
      "name": "无效dim参数类型错误",
      "priority": "Medium",
      "param_matrix": [
        {
          "module_type": "Linear",
          "in_features": 10,
          "out_features": 20,
          "name": "weight",
          "dim": "invalid",
          "device": "cpu",
          "dtype": "float32"
        }
      ],
      "asserts": {
        "weak": ["raises_type_error", "error_message_contains"],
        "strong": ["specific_type_error", "dim_in_error_message"]
      },
      "oracle": "exception_verification",
      "assertion_level": "weak",
      "size": "S",
      "max_lines": 60,
      "max_params": 6,
      "is_parametrized": false,
      "requires_mock": false,
      "mock_targets": []
    },
    {
      "tc_id": "TC-09",
      "block_id": "CASE_09",
      "group_id": "G2",
      "name": "Conv2d层权重归一化",
      "priority": "Medium",
      "param_matrix": [
        {
          "module_type": "Conv2d",
          "in_channels": 3,
          "out_channels": 16,
          "kernel_size": 3,
          "name": "weight",
          "dim": 0,
          "device": "cpu",
          "dtype": "float32"
        }
      ],
      "asserts": {
        "weak": ["returns_module", "has_g_param", "has_v_param", "conv_weight_reconstructed"],
        "strong": ["conv_shape_preserved", "reconstruction_error_small", "hook_registered"]
      },
      "oracle": "manual_verification",
      "assertion_level": "weak",
      "size": "M",
      "max_lines": 75,
      "max_params": 8,
      "is_parametrized": false,
      "requires_mock": false,
      "mock_targets": []
    }
  ],
  "param_extensions": [
    {
      "base_block_id": "CASE_01",
      "priority": "Medium",
      "params": {
        "module_type": "Linear",
        "in_features": 30,
        "out_features": 50,
        "name": "weight",
        "dim": 0,
        "device": "cuda",
        "dtype": "float64"
      },
      "note": "扩展测试：不同设备、数据类型和大小的Linear层"
    },
    {
      "base_block_id": "CASE_02",
      "priority": "Medium",
      "params": {
        "module_type": "Linear",
        "in_features": 1,
        "out_features": 1,
        "name": "weight",
        "dim": 0,
        "device": "cpu",
        "dtype": "float32"
      },
      "note": "扩展测试：最小形状权重张量"
    },
    {
      "base_block_id": "CASE_03",
      "priority": "Medium",
      "params": {
        "module_type": "Linear",
        "in_features": 100,
        "out_features": 200,
        "name": "weight",
        "dim": null,
        "device": "cpu",
        "dtype": "float32"
      },
      "note": "扩展测试：大尺寸张量的全局范数计算"
    },
    {
      "base_block_id": "CASE_09",
      "priority": "Low",
      "params": {
        "module_type": "Conv1d",
        "in_channels": 1,
        "out_channels": 8,
        "kernel_size": 5,
        "name": "weight",
        "dim": 0,
        "device": "cpu",
        "dtype": "float32"
      },
      "note": "扩展测试：Conv1d层权重归一化"
    }
  ],
  "smoke_set": ["CASE_01", "CASE_02", "CASE_03", "CASE_06"],
  "deferred_set": ["CASE_04", "CASE_05", "CASE_07", "CASE_08", "CASE_09"]
}