=== Run Tests ===
FFFFF..                                                                  [100%]
================================== FAILURES ===================================
______ test_group_by_window_basic_functionality_and_deprecation_warning _______

capture_warnings = []

    def test_group_by_window_basic_functionality_and_deprecation_warning(capture_warnings):
        """Test basic group_by_window functionality and deprecation warning.
    
        TC-09: group_by_window 基本功能与弃用警告
        Priority: High
        Assertion level: weak
        """
        # Test parameters
        dataset_size = 12
        window_size = 3
    
        # Create dataset
        dataset = create_simple_dataset(dataset_size)
    
        # Apply group_by_window transformation
        transform_fn = group_by_window(
            key_func=simple_mod_key_func,
            reduce_func=take_first_reduce_func,
            window_size=window_size
        )
    
        # Verify deprecation warning was issued
>       assert len(capture_warnings) > 0, "Expected deprecation warning"
E       AssertionError: Expected deprecation warning
E       assert 0 > 0
E        +  where 0 = len([])

tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py:110: AssertionError
---------------------------- Captured stderr call -----------------------------
2026-01-18 17:01:25.906208: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX AVX2
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
------------------------------ Captured log call ------------------------------
WARNING  tensorflow:deprecation.py:337 From D:\Project\TestAgent-CLI-main\exam\tensorflow\python.data.experimental.ops.grouping\tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py:103: group_by_window (from tensorflow.python.data.experimental.ops.grouping) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.group_by_window(...)`.
_____________ test_group_by_window_mutually_exclusive_parameters ______________

    def test_group_by_window_mutually_exclusive_parameters():
        """Test that group_by_window raises ValueError when both window_size and window_size_func are provided.
    
        TC-10: group_by_window 参数互斥验证
        Priority: Medium
        Assertion level: weak
        """
        # Test with both window_size and window_size_func (should raise ValueError)
        with pytest.raises(ValueError) as exc_info:
>           group_by_window(
                key_func=simple_mod_key_func,
                reduce_func=take_first_reduce_func,
                window_size=3,
                window_size_func=dynamic_window_size_func
            )
E           Failed: DID NOT RAISE <class 'ValueError'>

tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py:155: Failed
_______ test_invalid_dataset_input[group_by_reducer-non_dataset_object] _______

function_name = 'group_by_reducer', invalid_dataset = 'non_dataset_object'

    @pytest.mark.parametrize("function_name,invalid_dataset", [
        ("group_by_reducer", "non_dataset_object"),
        ("bucket_by_sequence_length", "non_dataset_object"),
    ])
    def test_invalid_dataset_input(function_name, invalid_dataset):
        """Test that grouping functions raise appropriate errors with invalid dataset inputs.
    
        TC-11: 通用异常 - 无效数据集输入
        Priority: Medium
        Assertion level: weak
        """
        # Get the function to test
        if function_name == "group_by_reducer":
            # Create a simple reducer for testing
            class SimpleReducer(Reducer):
                def __init__(self):
                    super().__init__(
                        init_func=lambda: tf.constant(0, dtype=tf.int64),
                        reduce_func=lambda state, value: state + tf.cast(value, tf.int64),
                        finalize_func=lambda state: state
                    )
    
            grouping_func = group_by_reducer(
                key_func=simple_mod_key_func,
                reducer=SimpleReducer()
            )
        elif function_name == "bucket_by_sequence_length":
            grouping_func = bucket_by_sequence_length(
                element_length_func=lambda x: tf.shape(x)[0],
                bucket_boundaries=[5, 10, 15],
                bucket_batch_sizes=[2, 2, 2, 2]
            )
        else:
            pytest.fail(f"Unknown function: {function_name}")
    
        # Verify the function is callable
        assert callable(grouping_func), f"{function_name} should return a callable"
    
        # Test with invalid dataset (string instead of dataset)
        with pytest.raises((TypeError, AttributeError, ValueError)) as exc_info:
            grouping_func(invalid_dataset)
    
        # Verify error message is meaningful
        error_msg = str(exc_info.value).lower()
        # Check for common error indicators
>       assert any(keyword in error_msg for keyword in [
            "dataset", "tensor", "argument", "parameter", "input",
            "type", "expected", "got", "must be"
        ]), f"Error message should be meaningful, got: {error_msg}"
E       AssertionError: Error message should be meaningful, got: 'str' object has no attribute 'element_spec'
E       assert False
E        +  where False = any(<generator object test_invalid_dataset_input.<locals>.<genexpr> at 0x0000026F10C64EB0>)

tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py:247: AssertionError
__ test_invalid_dataset_input[bucket_by_sequence_length-non_dataset_object] ___

function_name = 'bucket_by_sequence_length'
invalid_dataset = 'non_dataset_object'

    @pytest.mark.parametrize("function_name,invalid_dataset", [
        ("group_by_reducer", "non_dataset_object"),
        ("bucket_by_sequence_length", "non_dataset_object"),
    ])
    def test_invalid_dataset_input(function_name, invalid_dataset):
        """Test that grouping functions raise appropriate errors with invalid dataset inputs.
    
        TC-11: 通用异常 - 无效数据集输入
        Priority: Medium
        Assertion level: weak
        """
        # Get the function to test
        if function_name == "group_by_reducer":
            # Create a simple reducer for testing
            class SimpleReducer(Reducer):
                def __init__(self):
                    super().__init__(
                        init_func=lambda: tf.constant(0, dtype=tf.int64),
                        reduce_func=lambda state, value: state + tf.cast(value, tf.int64),
                        finalize_func=lambda state: state
                    )
    
            grouping_func = group_by_reducer(
                key_func=simple_mod_key_func,
                reducer=SimpleReducer()
            )
        elif function_name == "bucket_by_sequence_length":
            grouping_func = bucket_by_sequence_length(
                element_length_func=lambda x: tf.shape(x)[0],
                bucket_boundaries=[5, 10, 15],
                bucket_batch_sizes=[2, 2, 2, 2]
            )
        else:
            pytest.fail(f"Unknown function: {function_name}")
    
        # Verify the function is callable
        assert callable(grouping_func), f"{function_name} should return a callable"
    
        # Test with invalid dataset (string instead of dataset)
        with pytest.raises((TypeError, AttributeError, ValueError)) as exc_info:
            grouping_func(invalid_dataset)
    
        # Verify error message is meaningful
        error_msg = str(exc_info.value).lower()
        # Check for common error indicators
>       assert any(keyword in error_msg for keyword in [
            "dataset", "tensor", "argument", "parameter", "input",
            "type", "expected", "got", "must be"
        ]), f"Error message should be meaningful, got: {error_msg}"
E       AssertionError: Error message should be meaningful, got: 'str' object has no attribute 'bucket_by_sequence_length'
E       assert False
E        +  where False = any(<generator object test_invalid_dataset_input.<locals>.<genexpr> at 0x0000026F11EE6200>)

tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py:247: AssertionError
------------------------------ Captured log call ------------------------------
WARNING  tensorflow:deprecation.py:337 From D:\Project\TestAgent-CLI-main\exam\tensorflow\python.data.experimental.ops.grouping\tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py:229: bucket_by_sequence_length (from tensorflow.python.data.experimental.ops.grouping) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.bucket_by_sequence_length(...)`.
___________________ test_function_wrapper_error_propagation ___________________

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1226: AttributeError

During handling of the above exception, another exception occurred:

args = (), keywargs = {}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1333: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\contextlib.py:119: in __enter__
    return next(self.gen)
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1315: in decoration_helper
    arg = exit_stack.enter_context(patching)
D:\Coding\Anaconda\envs\testagent-experiment\lib\contextlib.py:448: in enter_context
    result = _cm_type.__enter__(cm)
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1388: in __enter__
    self.target = self.getter()
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1563: in <lambda>
    getter = lambda: _importer(target)
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1239: in _importer
    thing = _dot_lookup(thing, comp, import_path)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
            return getattr(thing, comp)
        except AttributeError:
            __import__(import_path)
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1229: AttributeError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                                                Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------------------------------------------
tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py     151     76     20      2    46%   37-40, 48, 53, 58, 63, 71, 76, 111-142, 163-198, 235, 253-267, 280-344, 401
---------------------------------------------------------------------------------------------------------------
TOTAL                                                                 151     76     20      2    46%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py::test_group_by_window_basic_functionality_and_deprecation_warning
FAILED tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py::test_group_by_window_mutually_exclusive_parameters
FAILED tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py::test_invalid_dataset_input[group_by_reducer-non_dataset_object]
FAILED tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py::test_invalid_dataset_input[bucket_by_sequence_length-non_dataset_object]
FAILED tests\test_tensorflow_python_data_experimental_ops_grouping_g3.py::test_function_wrapper_error_propagation
5 failed, 2 passed in 1.70s

Error: exit 1