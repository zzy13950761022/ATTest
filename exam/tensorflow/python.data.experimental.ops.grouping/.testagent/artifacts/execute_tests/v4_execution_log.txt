=== Run Tests ===
..FF                                                                     [100%]
================================== FAILURES ===================================
___ test_group_by_reducer_parameter_validation[non_scalar_return-TypeError] ___

invalid_key_func_type = 'non_scalar_return'
expected_exception = <class 'TypeError'>

    @pytest.mark.parametrize("invalid_key_func_type, expected_exception", [
        ("wrong_return_type", ValueError),  # Returns wrong dtype - actually raises ValueError
        ("non_scalar_return", TypeError),   # Returns non-scalar tensor - actually raises TypeError
    ])
    def test_group_by_reducer_parameter_validation(invalid_key_func_type, expected_exception):
        """Test parameter validation and exception handling for group_by_reducer."""
    
        # Create a simple dataset
        dataset = create_simple_dataset(5)
        reducer = create_sum_reducer()
    
        if invalid_key_func_type == "wrong_return_type":
            # Key function returns wrong type (float32 instead of int64)
            def wrong_type_key_func(x):
                return tf.cast(x % 3, tf.float32)  # Wrong dtype
    
            # Weak assertion 1: exception_raised
            with pytest.raises(expected_exception) as exc_info:
                transform_fn = group_by_reducer(wrong_type_key_func, reducer)
                _ = transform_fn(dataset)
    
            # Weak assertion 2: exception_type
            assert exc_info.type == expected_exception, f"Expected {expected_exception}, got {exc_info.type}"
    
            # Weak assertion 3: error_message_contains
            error_msg = str(exc_info.value).lower()
            # Check for relevant error indicators
            assert any(keyword in error_msg for keyword in ['type', 'dtype', 'int64', 'scalar']), \
                f"Error message should mention type/dtype/int64/scalar, got: {error_msg}"
    
        elif invalid_key_func_type == "non_scalar_return":
            # Key function returns non-scalar tensor
            # Need to fix the implementation to avoid TypeError during graph construction
            def non_scalar_key_func(x):
                # Create a non-scalar tensor (vector of length 2)
                # Use tf.stack to create a proper tensor from scalars
                return tf.stack([tf.cast(x % 3, tf.int64), tf.cast(x % 2, tf.int64)])
    
            # Weak assertion 1: exception_raised
            with pytest.raises(expected_exception) as exc_info:
                transform_fn = group_by_reducer(non_scalar_key_func, reducer)
>               _ = transform_fn(dataset)

tests\test_tensorflow_python_data_experimental_ops_grouping_g1.py:177: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\experimental\ops\grouping.py:53: in _apply_fn
    return _GroupByReducerDataset(dataset, key_func, reducer)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\experimental\ops\grouping.py:266: in __init__
    self._make_key_func(key_func, input_dataset)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <[AttributeError("'_GroupByReducerDataset' object has no attribute '_finalize_func'") raised in repr()] _GroupByReducerDataset object at 0x1d48db17ca0>
key_func = <function test_group_by_reducer_parameter_validation.<locals>.non_scalar_key_func at 0x000001D48DADCDC0>
input_dataset = <RangeDataset element_spec=TensorSpec(shape=(), dtype=tf.int64, name=None)>

    def _make_key_func(self, key_func, input_dataset):
      """Make wrapping defun for key_func."""
      self._key_func = structured_function.StructuredFunctionWrapper(
          key_func, self._transformation_name(), dataset=input_dataset)
      if not self._key_func.output_structure.is_compatible_with(
          tensor_spec.TensorSpec([], dtypes.int64)):
>       raise ValueError(
            f"Invalid `key_func`. Expected `key_func` to return a scalar "
            f"tf.int64 tensor, but instead `key_func` has output "
            f"types={self._key_func.output_types} "
            f"and shapes={self._key_func.output_shapes}."
        )
E       ValueError: Invalid `key_func`. Expected `key_func` to return a scalar tf.int64 tensor, but instead `key_func` has output types=<dtype: 'int64'> and shapes=(2,).

D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\experimental\ops\grouping.py:289: ValueError
______ test_group_by_window_basic_functionality_with_deprecation_warning ______

    def test_group_by_window_basic_functionality_with_deprecation_warning():
        """Test basic functionality of group_by_window with deprecation warning."""
    
        # Create dataset
        dataset_size = 12
        dataset = create_simple_dataset(dataset_size)
    
        # Define key function
        def key_func(x):
            return simple_mod_key_func(x, 3)  # Group by mod 3
    
        # Define reduce function - take first element from each window
        def reduce_func(key, window_dataset):
            # Take first element from the window
            return window_dataset.take(1)
    
        window_size = 3
    
        # Weak assertion 1: deprecation_warning
        # Capture warnings during the actual call to group_by_window
        with warnings.catch_warnings(record=True) as w:
            warnings.simplefilter("always")
    
            # Apply group_by_window transformation - this is where the warning is emitted
            transform_fn = group_by_window(key_func, reduce_func, window_size=window_size)
    
            # Check that deprecation warning was raised
>           assert len(w) > 0, "Deprecation warning should be raised for group_by_window"
E           AssertionError: Deprecation warning should be raised for group_by_window
E           assert 0 > 0
E            +  where 0 = len([])

tests\test_tensorflow_python_data_experimental_ops_grouping_g1.py:263: AssertionError
------------------------------ Captured log call ------------------------------
WARNING  tensorflow:deprecation.py:337 From D:\Project\TestAgent-CLI-main\exam\tensorflow\python.data.experimental.ops.grouping\tests\test_tensorflow_python_data_experimental_ops_grouping_g1.py:260: group_by_window (from tensorflow.python.data.experimental.ops.grouping) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.group_by_window(...)`.

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                                                Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------------------------------------------
tests\test_tensorflow_python_data_experimental_ops_grouping_g1.py     104     30     16      2    70%   31, 35, 39, 43, 47, 59-62, 83, 150, 172, 180-189, 245, 250, 268-286, 315-316
---------------------------------------------------------------------------------------------------------------
TOTAL                                                                 104     30     16      2    70%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_data_experimental_ops_grouping_g1.py::test_group_by_reducer_parameter_validation[non_scalar_return-TypeError]
FAILED tests\test_tensorflow_python_data_experimental_ops_grouping_g1.py::test_group_by_window_basic_functionality_with_deprecation_warning
2 failed, 2 passed in 1.72s

Error: exit 1