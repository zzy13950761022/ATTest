=== Run Tests ===
........F...                                                             [100%]
================================== FAILURES ===================================
________________________ test_broadcast_functionality _________________________

    def test_broadcast_functionality():
        """Parameter extension: Broadcast functionality verification.
    
        Test that allow_broadcast=True enables scalar and length-1 vector
        broadcasting to the specified shape.
        """
        # Test 1: Scalar broadcasting to [1, 1] shape
        scalar_value = 5
        proto = tensor_util.make_tensor_proto(
            values=scalar_value,
            dtype=dtypes.int32,
            shape=[1, 1],
            verify_shape=False,
            allow_broadcast=True
        )
    
        # Check shape
        actual_shape = [dim.size for dim in proto.tensor_shape.dim]
        assert actual_shape == [1, 1], f"Expected shape [1, 1], got {actual_shape}"
    
        # Check value - should be broadcasted
        actual_array = tensor_util.MakeNdarray(proto)
        expected_array = np.array([[5]], dtype=np.int32)
        np.testing.assert_array_equal(actual_array, expected_array)
    
        # Test 2: Length-1 vector broadcasting to [2, 2] shape
        vector_value = [7]
        proto2 = tensor_util.make_tensor_proto(
            values=vector_value,
            dtype=dtypes.int32,
            shape=[2, 2],
            verify_shape=False,
            allow_broadcast=True
        )
    
        # Check shape
        actual_shape2 = [dim.size for dim in proto2.tensor_shape.dim]
        assert actual_shape2 == [2, 2], f"Expected shape [2, 2], got {actual_shape2}"
    
        # Check value - should be broadcasted
        actual_array2 = tensor_util.MakeNdarray(proto2)
        expected_array2 = np.array([[7, 7], [7, 7]], dtype=np.int32)
        np.testing.assert_array_equal(actual_array2, expected_array2)
    
        # Test 3: Without allow_broadcast, scalar with shape [2,2] should work
        # but values will be replicated to fill the shape
        proto3 = tensor_util.make_tensor_proto(
            values=scalar_value,
            dtype=dtypes.int32,
            shape=[2, 2],
            verify_shape=False,
            allow_broadcast=False
        )
    
        # Check shape
        actual_shape3 = [dim.size for dim in proto3.tensor_shape.dim]
        assert actual_shape3 == [2, 2], f"Expected shape [2, 2], got {actual_shape3}"
    
        # Check value - scalar should be replicated to fill shape
        actual_array3 = tensor_util.MakeNdarray(proto3)
        expected_array3 = np.array([[5, 5], [5, 5]], dtype=np.int32)
        np.testing.assert_array_equal(actual_array3, expected_array3)
    
        # Test 4: Without allow_broadcast, length-1 vector with shape [2,2] should work
        # but values will be replicated to fill the shape
        proto4 = tensor_util.make_tensor_proto(
            values=vector_value,
            dtype=dtypes.int32,
            shape=[2, 2],
            verify_shape=False,
            allow_broadcast=False
        )
    
        # Check shape
        actual_shape4 = [dim.size for dim in proto4.tensor_shape.dim]
        assert actual_shape4 == [2, 2], f"Expected shape [2, 2], got {actual_shape4}"
    
        # Check value - vector should be replicated to fill shape
        actual_array4 = tensor_util.MakeNdarray(proto4)
        expected_array4 = np.array([[7, 7], [7, 7]], dtype=np.int32)
        np.testing.assert_array_equal(actual_array4, expected_array4)
    
        # Test 5: Test actual shape mismatch (not scalar or length-1)
        # This should raise an error even with allow_broadcast=False
        mismatched_values = [[1, 2, 3], [4, 5, 6]]  # shape [2, 3]
        with pytest.raises((ValueError, TypeError)) as exc_info:
            tensor_util.make_tensor_proto(
                values=mismatched_values,
                dtype=dtypes.int32,
                shape=[2, 2],  # Mismatched shape
                verify_shape=False,
                allow_broadcast=False
            )
    
        # Should raise error about shape mismatch
        error_msg = str(exc_info.value).lower()
>       assert "shape" in error_msg or "size" in error_msg or "expected" in error_msg
E       AssertionError: assert ('shape' in 'too many elements provided. takes at most 4, but got 6.' or 'size' in 'too many elements provided. takes at most 4, but got 6.' or 'expected' in 'too many elements provided. takes at most 4, but got 6.')

tests\test_tensorflow_python_framework_tensor_util.py:334: AssertionError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                                    Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------------------------------
test_behavior.py                                            0      0      0      0   100%
test_bfloat16.py                                           23     23      2      0     0%   1-36
tests\test_tensorflow_python_framework_tensor_util.py     148     30     34      4    74%   21-28, 33-44, 48-70, 126, 132, 424->433, 467-468
---------------------------------------------------------------------------------------------------
TOTAL                                                     171     53     36      4    65%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_framework_tensor_util.py::test_broadcast_functionality
1 failed, 11 passed in 1.60s

Error: exit 1