# tensorflow.python.debug.lib.dumping_callback 测试计划

## 1. 测试策略
- 单元测试框架：pytest
- 隔离策略：使用mock/patch隔离文件系统操作和全局回调注册
- 随机性处理：固定随机种子，使用可控的测试张量
- 测试分组：将模块功能拆分为3个逻辑组（G1-G3）

## 2. 生成规格摘要（来自 test_plan.json）
- **SMOKE_SET**: CASE_01（基本启用禁用）、CASE_02（无效参数）、CASE_05（SHAPE模式）、CASE_09（操作过滤）
- **DEFERRED_SET**: CASE_03、CASE_04、CASE_06、CASE_07、CASE_08、CASE_10、CASE_11
- **Group列表**:
  - G1: 核心启用/禁用功能（2个SMOKE，2个DEFERRED）
  - G2: 张量调试模式功能（1个SMOKE，3个DEFERRED）
  - G3: 过滤与缓冲区功能（1个SMOKE，2个DEFERRED）
- **断言分级策略**: 首轮仅使用weak断言，最终轮启用strong断言
- **预算策略**: 
  - Size S: 50-70行，5个参数
  - Size M: 70-80行，5个参数
  - 所有用例都支持参数化扩展

## 3. 数据与边界
- **正常数据集**: 标准浮点张量（float32/64），简单操作图（MatMul, Add）
- **边界值**: 空dump_root、无效tensor_debug_mode、circular_buffer_size=0/-1
- **极端形状**: 大张量（1000x1000）、零维张量、不规则形状
- **特殊值**: 包含inf/NaN的浮点张量、混合数据类型
- **负例场景**: 不可写目录、无效正则表达式、不支持的数据类型

## 4. 覆盖映射
| TC ID | 对应需求 | 关键约束 |
|-------|----------|----------|
| TC-01 | 基本启用/禁用流程 | 目录创建、回调注册、返回writer |
| TC-02 | 异常参数处理 | 空路径、无效模式、错误类型 |
| TC-05 | SHAPE模式功能 | 形状信息提取、dtype正确性 |
| TC-09 | 操作正则过滤 | 匹配逻辑、排除非匹配操作 |
| TC-03 | 幂等性要求 | 多次调用相同dump_root |
| TC-06-08 | 健康检查模式 | inf/NaN检测、统计准确性 |
| TC-10 | 张量类型过滤 | dtype列表/可调用对象 |
| TC-11 | 环形缓冲区 | 缓冲区大小、循环行为 |

## 5. 尚未覆盖的风险点
- 并发调用和线程安全性
- TPU环境特殊配置要求
- 大文件写入的磁盘空间处理
- 长时间运行的内存泄漏
- 跨平台文件系统兼容性

## 6. 迭代策略
- **首轮**: 仅生成SMOKE_SET（4个用例），使用weak断言
- **后续轮**: 修复失败用例，逐步提升DEFERRED用例
- **最终轮**: 启用strong断言，可选覆盖率检查