=== Run Tests ===
FFFF                                                                     [100%]
================================== FAILURES ===================================
_______________ TestRejectionResample.test_basic_functionality ________________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000002281515D0D0>
mock_dataset = <Mock spec='DatasetV2' id='2371175620464'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='2371175699648'>

    def test_basic_functionality(self, mock_dataset, mock_rejection_resample):
        """TC-01: 基本功能验证 - 验证函数返回转换函数并正确调用底层方法"""
        # Arrange
        num_classes = 3
        dataset_size = 100
        seed = 42
    
        # Create a simple class function
        def class_func(element):
            return tf.cast(element % num_classes, tf.int32)
    
        # Create target distribution (uniform)
        target_dist = tf.constant([1.0/num_classes] * num_classes, dtype=tf.float32)
    
        # Mock the rejection_resample method to return the dataset itself
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Act
        transform_fn = rejection_resample(
            class_func=class_func,
            target_dist=target_dist,
            initial_dist=None,
            seed=seed
        )
    
        # Apply the transformation to mock dataset
        result = transform_fn(mock_dataset)
    
        # Assert - weak assertions
        # 1. Returns function
        assert callable(transform_fn), "rejection_resample should return a callable function"
    
        # 2. Deprecation warning (check via mock)
        # The deprecation decorator is applied to the function
    
        # 3. Dataset type
>       assert result is transformed_dataset, "Transformed dataset should be returned"
E       AssertionError: Transformed dataset should be returned
E       assert <Mock name='mock.rejection_resample()' id='2371193492960'> is <Mock name='rejection_resample()' spec='DatasetV2' id='2371175620560'>

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:79: AssertionError
---------------------------- Captured stderr call -----------------------------
2026-01-18 22:12:56.204847: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX AVX2
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
------------------------------ Captured log call ------------------------------
WARNING  tensorflow:deprecation.py:337 From D:\Project\TestAgent-CLI-main\exam\tensorflow\python.data.experimental.ops.resampling\tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:61: rejection_resample (from tensorflow.python.data.experimental.ops.resampling) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.rejection_resample(...)`.
_______________ TestRejectionResample.test_deprecation_warning ________________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000002281515D220>
mock_dataset = <Mock spec='DatasetV2' id='2371194951232'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='2371194951040'>

    def test_deprecation_warning(self, mock_dataset, mock_rejection_resample):
        """TC-02: 弃用警告验证 - 验证函数触发弃用警告"""
        # Arrange
        num_classes = 2
        dataset_size = 50
    
        # Create a simple class function
        def class_func(element):
            return tf.cast(element % num_classes, tf.int32)
    
        # Create target distribution (uniform)
        target_dist = tf.constant([0.5, 0.5], dtype=tf.float32)
    
        # Create initial distribution (provided)
        initial_dist = tf.constant([0.6, 0.4], dtype=tf.float32)
    
        # Mock the rejection_resample method
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Capture warnings
        with warnings.catch_warnings(record=True) as w:
            warnings.simplefilter("always")
    
            # Act
            transform_fn = rejection_resample(
                class_func=class_func,
                target_dist=target_dist,
                initial_dist=initial_dist,
                seed=None
            )
    
            # Apply transformation
            result = transform_fn(mock_dataset)
    
            # Assert - weak assertions
            # 1. Deprecation warning triggered
>           assert len(w) > 0, "Deprecation warning should be triggered"
E           AssertionError: Deprecation warning should be triggered
E           assert 0 > 0
E            +  where 0 = len([])

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:137: AssertionError
_____________ TestRejectionResample.test_distribution_adjustment ______________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000002281515D3D0>
mock_dataset = <Mock spec='DatasetV2' id='2371195089920'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='2371195089776'>

    def test_distribution_adjustment(self, mock_dataset, mock_rejection_resample):
        """TC-03: 分布调整验证 - 验证函数正确传递分布参数"""
        # Arrange
        num_classes = 4
        dataset_size = 200
        seed = 123
    
        # Create a simple class function
        def class_func(element):
            return tf.cast(element % num_classes, tf.int32)
    
        # Create uniform target distribution
        target_dist = tf.constant([0.25, 0.25, 0.25, 0.25], dtype=tf.float32)
    
        # Mock the rejection_resample method
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Act
        transform_fn = rejection_resample(
            class_func=class_func,
            target_dist=target_dist,
            initial_dist=None,
            seed=seed
        )
    
        # Apply transformation
        result = transform_fn(mock_dataset)
    
        # Assert - weak assertions
        # 1. Output distribution close (verify parameters passed correctly)
>       mock_rejection_resample.assert_called_once_with(
            class_func=class_func,
            target_dist=target_dist,
            initial_dist=None,
            seed=seed
        )

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:197: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <MagicMock name='rejection_resample' id='2371195089776'>, args = ()
kwargs = {'class_func': <function TestRejectionResample.test_distribution_adjustment.<locals>.class_func at 0x0000022815152CA0>...eed': 123, 'target_dist': <tf.Tensor: shape=(4,), dtype=float32, numpy=array([0.25, 0.25, 0.25, 0.25], dtype=float32)>}
msg = "Expected 'rejection_resample' to be called once. Called 0 times."

    def assert_called_once_with(self, /, *args, **kwargs):
        """assert that the mock was called exactly once and that that call was
        with the specified arguments."""
        if not self.call_count == 1:
            msg = ("Expected '%s' to be called once. Called %s times.%s"
                   % (self._mock_name or 'mock',
                      self.call_count,
                      self._calls_repr()))
>           raise AssertionError(msg)
E           AssertionError: Expected 'rejection_resample' to be called once. Called 0 times.

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:918: AssertionError
______________ TestRejectionResample.test_optional_initial_dist _______________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000002281515D580>
mock_dataset = <Mock spec='DatasetV2' id='2371194976384'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='2371194976624'>

    def test_optional_initial_dist(self, mock_dataset, mock_rejection_resample):
        """TC-04: 可选参数initial_dist - 验证initial_dist参数正确传递和使用"""
        # Arrange
        num_classes = 3
        dataset_size = 150
        seed = 42
    
        # Create a simple class function
        def class_func(element):
            return tf.cast(element % num_classes, tf.int32)
    
        # Create target distribution (uniform)
        target_dist = tf.constant([1.0/num_classes] * num_classes, dtype=tf.float32)
    
        # Create initial distribution (provided) - different from target
        initial_dist = tf.constant([0.5, 0.3, 0.2], dtype=tf.float32)
    
        # Mock the rejection_resample method
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Act
        transform_fn = rejection_resample(
            class_func=class_func,
            target_dist=target_dist,
            initial_dist=initial_dist,
            seed=seed
        )
    
        # Apply transformation
        result = transform_fn(mock_dataset)
    
        # Assert - weak assertions
        # 1. Function works (no exceptions)
        assert callable(transform_fn), "rejection_resample should return a callable function"
    
        # 2. No exceptions (implicitly passed if we reach here)
    
        # 3. Dataset transformed
>       assert result is transformed_dataset, "Should return transformed dataset"
E       AssertionError: Should return transformed dataset
E       assert <Mock name='mock.rejection_resample()' id='2371195040000'> is <Mock name='rejection_resample()' spec='DatasetV2' id='2371194976480'>

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:271: AssertionError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                                                  Stmts   Miss Branch BrPart  Cover   Missing
-----------------------------------------------------------------------------------------------------------------
tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py     119     48     10      1    56%   30-33, 38, 51, 82-96, 108, 140-161, 175, 205-228, 241, 274-310, 320
-----------------------------------------------------------------------------------------------------------------
TOTAL                                                                   119     48     10      1    56%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_basic_functionality
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_deprecation_warning
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_distribution_adjustment
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_optional_initial_dist
4 failed in 1.60s

Error: exit 1