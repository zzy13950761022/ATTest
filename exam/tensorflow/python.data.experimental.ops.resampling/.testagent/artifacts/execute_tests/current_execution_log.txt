=== Run Tests ===
FFFFFFF                                                                  [100%]
================================== FAILURES ===================================
__________ TestRejectionResample.test_basic_functionality[3-100-42] ___________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000001BFCFDDE490>
mock_dataset = <Mock spec='DatasetV2' id='1923337807472'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='1923337806272'>
num_classes = 3, dataset_size = 100, seed = 42

    @pytest.mark.parametrize("num_classes,dataset_size,seed", [
        (3, 100, 42),  # Original test case
        (5, 1000, 42), # Extended test case: more classes and larger dataset
    ])
    def test_basic_functionality(self, mock_dataset, mock_rejection_resample, num_classes, dataset_size, seed):
        """TC-01: 基本功能验证 - 验证函数返回转换函数并正确调用底层方法"""
        # Arrange
        # Create a simple class function
        def class_func(element):
            return tf.cast(element % num_classes, tf.int32)
    
        # Create target distribution (uniform)
        target_dist = tf.constant([1.0/num_classes] * num_classes, dtype=tf.float32)
    
        # Mock the rejection_resample method to return the dataset itself
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Act
        transform_fn = rejection_resample(
            class_func=class_func,
            target_dist=target_dist,
            initial_dist=None,
            seed=seed
        )
    
        # Apply the transformation to mock dataset
        result = transform_fn(mock_dataset)
    
        # Assert - weak assertions
        # 1. Returns function
        assert callable(transform_fn), "rejection_resample should return a callable function"
    
        # 2. Deprecation warning (check via mock)
        # The deprecation decorator is applied to the function
    
        # 3. Dataset type - result should be the return value of mock_rejection_resample
        # which is transformed_dataset
>       assert result is transformed_dataset, f"Transformed dataset should be returned, got {result}"
E       AssertionError: Transformed dataset should be returned, got <Mock name='mock.rejection_resample()' id='1923338006192'>
E       assert <Mock name='mock.rejection_resample()' id='1923338006192'> is <Mock name='rejection_resample()' spec='DatasetV2' id='1923337956752'>

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:80: AssertionError
---------------------------- Captured stderr call -----------------------------
2026-01-18 22:22:25.789757: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX AVX2
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
------------------------------ Captured log call ------------------------------
WARNING  tensorflow:deprecation.py:337 From D:\Project\TestAgent-CLI-main\exam\tensorflow\python.data.experimental.ops.resampling\tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:61: rejection_resample (from tensorflow.python.data.experimental.ops.resampling) is deprecated and will be removed in a future version.
Instructions for updating:
Use `tf.data.Dataset.rejection_resample(...)`.
__________ TestRejectionResample.test_basic_functionality[5-1000-42] __________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000001BFCFDDE4F0>
mock_dataset = <Mock spec='DatasetV2' id='1923357146752'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='1923357147088'>
num_classes = 5, dataset_size = 1000, seed = 42

    @pytest.mark.parametrize("num_classes,dataset_size,seed", [
        (3, 100, 42),  # Original test case
        (5, 1000, 42), # Extended test case: more classes and larger dataset
    ])
    def test_basic_functionality(self, mock_dataset, mock_rejection_resample, num_classes, dataset_size, seed):
        """TC-01: 基本功能验证 - 验证函数返回转换函数并正确调用底层方法"""
        # Arrange
        # Create a simple class function
        def class_func(element):
            return tf.cast(element % num_classes, tf.int32)
    
        # Create target distribution (uniform)
        target_dist = tf.constant([1.0/num_classes] * num_classes, dtype=tf.float32)
    
        # Mock the rejection_resample method to return the dataset itself
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Act
        transform_fn = rejection_resample(
            class_func=class_func,
            target_dist=target_dist,
            initial_dist=None,
            seed=seed
        )
    
        # Apply the transformation to mock dataset
        result = transform_fn(mock_dataset)
    
        # Assert - weak assertions
        # 1. Returns function
        assert callable(transform_fn), "rejection_resample should return a callable function"
    
        # 2. Deprecation warning (check via mock)
        # The deprecation decorator is applied to the function
    
        # 3. Dataset type - result should be the return value of mock_rejection_resample
        # which is transformed_dataset
>       assert result is transformed_dataset, f"Transformed dataset should be returned, got {result}"
E       AssertionError: Transformed dataset should be returned, got <Mock name='mock.rejection_resample()' id='1923357121072'>
E       assert <Mock name='mock.rejection_resample()' id='1923357121072'> is <Mock name='rejection_resample()' spec='DatasetV2' id='1923357128880'>

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:80: AssertionError
_______________ TestRejectionResample.test_deprecation_warning ________________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000001BFCFDDE730>
mock_dataset = <Mock spec='DatasetV2' id='1923337956992'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='1923337956896'>

    def test_deprecation_warning(self, mock_dataset, mock_rejection_resample):
        """TC-02: 弃用警告验证 - 验证函数触发弃用警告"""
        # Arrange
        num_classes = 2
        dataset_size = 50
    
        # Create a simple class function
        def class_func(element):
            return tf.cast(element % num_classes, tf.int32)
    
        # Create target distribution (uniform)
        target_dist = tf.constant([0.5, 0.5], dtype=tf.float32)
    
        # Create initial distribution (provided)
        initial_dist = tf.constant([0.6, 0.4], dtype=tf.float32)
    
        # Mock the rejection_resample method
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Reset warnings to ensure we capture the deprecation warning
        warnings.resetwarnings()
    
        # Capture warnings
        with warnings.catch_warnings(record=True) as w:
            # Set filter to always show warnings
            warnings.simplefilter("always")
    
            # Act
            transform_fn = rejection_resample(
                class_func=class_func,
                target_dist=target_dist,
                initial_dist=initial_dist,
                seed=None
            )
    
            # Apply transformation
            result = transform_fn(mock_dataset)
    
            # Assert - weak assertions
            # 1. Deprecation warning triggered
>           assert len(w) > 0, f"Deprecation warning should be triggered, got {len(w)} warnings"
E           AssertionError: Deprecation warning should be triggered, got 0 warnings
E           assert 0 > 0
E            +  where 0 = len([])

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:163: AssertionError
_____________ TestRejectionResample.test_distribution_adjustment ______________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000001BFCFDDE8E0>
mock_dataset = <Mock spec='DatasetV2' id='1923357506288'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='1923357506960'>

    def test_distribution_adjustment(self, mock_dataset, mock_rejection_resample):
        """TC-03: 分布调整验证 - 验证函数正确传递分布参数"""
        # Arrange
        num_classes = 4
        dataset_size = 200
        seed = 123
    
        # Create a simple class function
        def class_func(element):
            return tf.cast(element % num_classes, tf.int32)
    
        # Create uniform target distribution
        target_dist = tf.constant([0.25, 0.25, 0.25, 0.25], dtype=tf.float32)
    
        # Mock the rejection_resample method
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Act
        transform_fn = rejection_resample(
            class_func=class_func,
            target_dist=target_dist,
            initial_dist=None,
            seed=seed
        )
    
        # Apply transformation
        result = transform_fn(mock_dataset)
    
        # Assert - weak assertions
        # 1. Output distribution close (verify parameters passed correctly)
        # First check if mock was called at all
>       assert mock_rejection_resample.called, "rejection_resample method should be called on dataset"
E       AssertionError: rejection_resample method should be called on dataset
E       assert False
E        +  where False = <MagicMock name='rejection_resample' id='1923357506960'>.called

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:226: AssertionError
____________ TestRejectionResample.test_optional_initial_dist[42] _____________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000001BFCFDDEB20>
mock_dataset = <Mock spec='DatasetV2' id='1923357476224'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='1923357476608'>
seed = 42

    @pytest.mark.parametrize("seed", [42, None])
    def test_optional_initial_dist(self, mock_dataset, mock_rejection_resample, seed):
        """TC-04: 可选参数initial_dist - 验证initial_dist参数正确传递和使用"""
        # Arrange
        num_classes = 3
        dataset_size = 150
    
        # Create a simple class function
        def class_func(element):
            return tf.cast(element % num_classes, tf.int32)
    
        # Create target distribution (uniform)
        target_dist = tf.constant([1.0/num_classes] * num_classes, dtype=tf.float32)
    
        # Create initial distribution (provided) - different from target
        initial_dist = tf.constant([0.5, 0.3, 0.2], dtype=tf.float32)
    
        # Mock the rejection_resample method
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Act
        transform_fn = rejection_resample(
            class_func=class_func,
            target_dist=target_dist,
            initial_dist=initial_dist,
            seed=seed
        )
    
        # Apply transformation
        result = transform_fn(mock_dataset)
    
        # Assert - weak assertions
        # 1. Function works (no exceptions)
        assert callable(transform_fn), "rejection_resample should return a callable function"
    
        # 2. No exceptions (implicitly passed if we reach here)
    
        # 3. Dataset transformed
>       assert result is transformed_dataset, f"Should return transformed dataset, got {result}"
E       AssertionError: Should return transformed dataset, got <Mock name='mock.rejection_resample()' id='1923357422880'>
E       assert <Mock name='mock.rejection_resample()' id='1923357422880'> is <Mock name='rejection_resample()' spec='DatasetV2' id='1923357474976'>

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:309: AssertionError
___________ TestRejectionResample.test_optional_initial_dist[None] ____________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000001BFCFDDEBE0>
mock_dataset = <Mock spec='DatasetV2' id='1923357527488'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='1923357527776'>
seed = None

    @pytest.mark.parametrize("seed", [42, None])
    def test_optional_initial_dist(self, mock_dataset, mock_rejection_resample, seed):
        """TC-04: 可选参数initial_dist - 验证initial_dist参数正确传递和使用"""
        # Arrange
        num_classes = 3
        dataset_size = 150
    
        # Create a simple class function
        def class_func(element):
            return tf.cast(element % num_classes, tf.int32)
    
        # Create target distribution (uniform)
        target_dist = tf.constant([1.0/num_classes] * num_classes, dtype=tf.float32)
    
        # Create initial distribution (provided) - different from target
        initial_dist = tf.constant([0.5, 0.3, 0.2], dtype=tf.float32)
    
        # Mock the rejection_resample method
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Act
        transform_fn = rejection_resample(
            class_func=class_func,
            target_dist=target_dist,
            initial_dist=initial_dist,
            seed=seed
        )
    
        # Apply transformation
        result = transform_fn(mock_dataset)
    
        # Assert - weak assertions
        # 1. Function works (no exceptions)
        assert callable(transform_fn), "rejection_resample should return a callable function"
    
        # 2. No exceptions (implicitly passed if we reach here)
    
        # 3. Dataset transformed
>       assert result is transformed_dataset, f"Should return transformed dataset, got {result}"
E       AssertionError: Should return transformed dataset, got <Mock name='mock.rejection_resample()' id='1923357615440'>
E       assert <Mock name='mock.rejection_resample()' id='1923357615440'> is <Mock name='rejection_resample()' spec='DatasetV2' id='1923357527584'>

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:309: AssertionError
______________ TestRejectionResample.test_edge_case_single_class ______________

self = <test_tensorflow_python_data_experimental_ops_resampling_g1.TestRejectionResample object at 0x000001BFCFDDEE20>
mock_dataset = <Mock spec='DatasetV2' id='1923357455984'>
mock_rejection_resample = <MagicMock name='rejection_resample' id='1923357455840'>

    def test_edge_case_single_class(self, mock_dataset, mock_rejection_resample):
        """TC-05: 边界值测试 - 验证单类别和小数据集的边界情况"""
        # Arrange
        num_classes = 1
        dataset_size = 10
        seed = 0
    
        # Create a simple class function for single class
        def class_func(element):
            # Always return 0 for single class
            return tf.constant(0, dtype=tf.int32)
    
        # Create target distribution for single class (must be 1.0)
        target_dist = tf.constant([1.0], dtype=tf.float32)
    
        # Mock the rejection_resample method
        transformed_dataset = Mock(spec=tf.data.Dataset)
        mock_rejection_resample.return_value = transformed_dataset
    
        # Act
        transform_fn = rejection_resample(
            class_func=class_func,
            target_dist=target_dist,
            initial_dist=None,
            seed=seed
        )
    
        # Apply transformation
        result = transform_fn(mock_dataset)
    
        # Assert - weak assertions
        # 1. Function works (no exceptions)
        assert callable(transform_fn), "rejection_resample should return a callable function"
    
        # 2. No exceptions (implicitly passed if we reach here)
    
        # 3. Basic output
>       assert result is transformed_dataset, f"Should return transformed dataset, got {result}"
E       AssertionError: Should return transformed dataset, got <Mock name='mock.rejection_resample()' id='1923357622528'>
E       assert <Mock name='mock.rejection_resample()' id='1923357622528'> is <Mock name='rejection_resample()' spec='DatasetV2' id='1923357455936'>

tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py:403: AssertionError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                                                  Stmts   Miss Branch BrPart  Cover   Missing
-----------------------------------------------------------------------------------------------------------------
tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py     164     82     18      1    46%   30-33, 38, 51, 83-117, 130, 166-189, 203, 229-266, 279, 312-362, 376, 406-440, 445
-----------------------------------------------------------------------------------------------------------------
TOTAL                                                                   164     82     18      1    46%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_basic_functionality[3-100-42]
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_basic_functionality[5-1000-42]
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_deprecation_warning
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_distribution_adjustment
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_optional_initial_dist[42]
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_optional_initial_dist[None]
FAILED tests\test_tensorflow_python_data_experimental_ops_resampling_g1.py::TestRejectionResample::test_edge_case_single_class
7 failed in 1.64s

Error: exit 1