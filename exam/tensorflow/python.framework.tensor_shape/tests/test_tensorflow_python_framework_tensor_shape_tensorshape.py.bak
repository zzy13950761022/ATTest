"""
测试 tensorflow.python.framework.tensor_shape 模块中的 TensorShape 类
"""
import pytest
import tensorflow as tf
from tensorflow.python.framework import tensor_shape

# ==== BLOCK:HEADER START ====
# 测试 TensorShape 类的基本功能
# ==== BLOCK:HEADER END ====

# ==== BLOCK:CASE_03 START ====
@pytest.mark.parametrize(
    "dims,expected_rank,expected_dims",
    [
        ([2, 3], 2, [2, 3]),
        ([], 0, []),
        (None, None, None),
    ]
)
def test_tensorshape_construction(dims, expected_rank, expected_dims):
    """测试 TensorShape 基本构造"""
    # 创建 TensorShape 对象
    shape = tensor_shape.TensorShape(dims)
    
    # 验证 rank 属性
    assert shape.rank == expected_rank
    
    # 验证 dims 属性
    if expected_dims is None:
        assert shape.dims is None
    else:
        assert shape.dims is not None
        assert len(shape.dims) == len(expected_dims)
        
        # 验证每个维度的值
        for i, (actual_dim, expected_value) in enumerate(zip(shape.dims, expected_dims)):
            if expected_value is None:
                assert actual_dim.value is None
            else:
                assert actual_dim.value == expected_value
    
    # 验证 is_fully_defined 属性
    if dims is None:
        assert not shape.is_fully_defined
    elif any(d is None for d in dims):
        assert not shape.is_fully_defined
    else:
        assert shape.is_fully_defined
    
    # 验证与列表/元组的比较
    if dims is not None:
        # TensorShape 应该与原始列表相等
        assert shape == dims
        assert dims == shape
        
        # 也应该与元组相等
        assert shape == tuple(dims)
        assert tuple(dims) == shape
    
    # 验证空形状
    if dims == []:
        assert shape.rank == 0
        assert len(shape) == 0
        assert shape.is_fully_defined
    
    # 验证完全未知形状
    if dims is None:
        assert shape.rank is None
        assert shape.dims is None
        assert not shape.is_fully_defined
# ==== BLOCK:CASE_03 END ====

# ==== BLOCK:CASE_04 START ====
# 形状兼容性检查测试
# ==== BLOCK:CASE_04 END ====

# ==== BLOCK:CASE_08 START ====
# TensorShape 高级功能测试（deferred）
# ==== BLOCK:CASE_08 END ====

# ==== BLOCK:CASE_09 START ====
# TensorShape 边缘情况测试（deferred）
# ==== BLOCK:CASE_09 END ====

# ==== BLOCK:FOOTER START ====
# 测试结束
# ==== BLOCK:FOOTER END ====