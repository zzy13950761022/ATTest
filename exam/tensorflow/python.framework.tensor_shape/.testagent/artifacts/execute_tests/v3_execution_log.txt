=== Run Tests ===
FFF...........F                                                          [100%]
================================== FAILURES ===================================
____________ test_tensorshape_construction[dims0-2-expected_dims0] ____________

dims = [2, 3], expected_rank = 2, expected_dims = [2, 3]

    @pytest.mark.parametrize(
        "dims,expected_rank,expected_dims",
        [
            ([2, 3], 2, [2, 3]),
            ([], 0, []),
            (None, None, None),
        ]
    )
    def test_tensorshape_construction(dims, expected_rank, expected_dims):
        """测试 TensorShape 基本构造"""
        # 创建 TensorShape 对象
        shape = tensor_shape.TensorShape(dims)
    
        # 验证 rank 属性
        assert shape.rank == expected_rank
    
        # 验证 dims 属性
        if expected_dims is None:
            assert shape.dims is None
        else:
            assert shape.dims is not None
            assert len(shape.dims) == len(expected_dims)
    
            # 验证每个维度的值
            for i, (dim, expected) in enumerate(zip(shape.dims, expected_dims)):
                if expected is None:
                    assert dim.value is None
                else:
                    assert dim.value == expected
    
        # 验证 is_fully_defined 属性
        if expected_dims is None:
            # 对于 None 输入，is_fully_defined 应该为 False
            assert not shape.is_fully_defined
        else:
            # 检查是否所有维度都已知
            all_known = all(d is not None for d in expected_dims)
            # 根据 TensorFlow 实现，is_fully_defined 检查所有维度值是否不为 None
            # 对于空列表 []，所有维度都已知（因为没有维度）
            # 对于 [2, 3]，所有维度都已知
>           assert shape.is_fully_defined == all_known
E           assert is_fully_defined == True
E            +  where is_fully_defined = TensorShape([2, 3]).is_fully_defined

tests\test_tensorflow_python_framework_tensor_shape.py:76: AssertionError
____________ test_tensorshape_construction[dims1-0-expected_dims1] ____________

dims = [], expected_rank = 0, expected_dims = []

    @pytest.mark.parametrize(
        "dims,expected_rank,expected_dims",
        [
            ([2, 3], 2, [2, 3]),
            ([], 0, []),
            (None, None, None),
        ]
    )
    def test_tensorshape_construction(dims, expected_rank, expected_dims):
        """测试 TensorShape 基本构造"""
        # 创建 TensorShape 对象
        shape = tensor_shape.TensorShape(dims)
    
        # 验证 rank 属性
        assert shape.rank == expected_rank
    
        # 验证 dims 属性
        if expected_dims is None:
            assert shape.dims is None
        else:
            assert shape.dims is not None
            assert len(shape.dims) == len(expected_dims)
    
            # 验证每个维度的值
            for i, (dim, expected) in enumerate(zip(shape.dims, expected_dims)):
                if expected is None:
                    assert dim.value is None
                else:
                    assert dim.value == expected
    
        # 验证 is_fully_defined 属性
        if expected_dims is None:
            # 对于 None 输入，is_fully_defined 应该为 False
            assert not shape.is_fully_defined
        else:
            # 检查是否所有维度都已知
            all_known = all(d is not None for d in expected_dims)
            # 根据 TensorFlow 实现，is_fully_defined 检查所有维度值是否不为 None
            # 对于空列表 []，所有维度都已知（因为没有维度）
            # 对于 [2, 3]，所有维度都已知
>           assert shape.is_fully_defined == all_known
E           assert is_fully_defined == True
E            +  where is_fully_defined = TensorShape([]).is_fully_defined

tests\test_tensorflow_python_framework_tensor_shape.py:76: AssertionError
________________ test_tensorshape_construction[None-None-None] ________________

dims = None, expected_rank = None, expected_dims = None

    @pytest.mark.parametrize(
        "dims,expected_rank,expected_dims",
        [
            ([2, 3], 2, [2, 3]),
            ([], 0, []),
            (None, None, None),
        ]
    )
    def test_tensorshape_construction(dims, expected_rank, expected_dims):
        """测试 TensorShape 基本构造"""
        # 创建 TensorShape 对象
        shape = tensor_shape.TensorShape(dims)
    
        # 验证 rank 属性
        assert shape.rank == expected_rank
    
        # 验证 dims 属性
        if expected_dims is None:
            assert shape.dims is None
        else:
            assert shape.dims is not None
            assert len(shape.dims) == len(expected_dims)
    
            # 验证每个维度的值
            for i, (dim, expected) in enumerate(zip(shape.dims, expected_dims)):
                if expected is None:
                    assert dim.value is None
                else:
                    assert dim.value == expected
    
        # 验证 is_fully_defined 属性
        if expected_dims is None:
            # 对于 None 输入，is_fully_defined 应该为 False
>           assert not shape.is_fully_defined
E           assert not is_fully_defined
E            +  where is_fully_defined = TensorShape(None).is_fully_defined

tests\test_tensorflow_python_framework_tensor_shape.py:69: AssertionError
______________________ test_dimension_advanced_features _______________________

    def test_dimension_advanced_features():
        """测试 Dimension 高级功能"""
        # 测试 assert_is_compatible_with 方法
        dim5 = tensor_shape.Dimension(5)
        dim5_2 = tensor_shape.Dimension(5)
        dim_unknown = tensor_shape.Dimension(None)
        dim3 = tensor_shape.Dimension(3)
    
        # 相同维度应该兼容
        dim5.assert_is_compatible_with(dim5_2)
        dim5.assert_is_compatible_with(5)
    
        # 未知维度应该与任何维度兼容
        dim_unknown.assert_is_compatible_with(dim5)
        dim_unknown.assert_is_compatible_with(dim3)
        dim_unknown.assert_is_compatible_with(None)
    
        # 不同已知维度应该不兼容
        with pytest.raises(ValueError):
            dim5.assert_is_compatible_with(dim3)
        with pytest.raises(ValueError):
            dim5.assert_is_compatible_with(3)
    
        # 测试 merge_with 方法
        # 相同维度合并
        merged_same = dim5.merge_with(dim5_2)
        assert merged_same.value == 5
    
        # 已知维度与未知维度合并
        merged_with_unknown = dim5.merge_with(dim_unknown)
        assert merged_with_unknown.value == 5
    
        merged_unknown_with_known = dim_unknown.merge_with(dim5)
        assert merged_unknown_with_known.value == 5
    
        # 不同已知维度合并应该失败
        with pytest.raises(ValueError):
            dim5.merge_with(dim3)
    
        # 注意：Dimension 类没有实现 __hash__ 方法
        # 因此不能测试 hash 功能
    
        # 测试 __lt__, __le__, __gt__, __ge__ 方法
        # 比较操作
        assert dim3 < dim5
        assert dim3 <= dim5
        assert dim5 > dim3
        assert dim5 >= dim3
        assert dim5 >= dim5_2
        assert dim5 <= dim5_2
    
        # 未知维度的比较
        # 未知维度与已知维度的比较应该返回 NotImplemented
        # 或者根据实现可能引发错误
        try:
            result = dim_unknown < dim5
            # 如果执行到这里，检查结果
            if result is not NotImplemented:
                # 记录结果但不断言，因为行为可能变化
                pass
        except (TypeError, ValueError):
            # 这是可接受的行为
            pass
    
        # 测试 __floordiv__ 和 __mod__ 方法
        dim10 = tensor_shape.Dimension(10)
        dim3 = tensor_shape.Dimension(3)
    
        # 整数除法
        div_result = dim10 // dim3
        assert isinstance(div_result, tensor_shape.Dimension)
        assert div_result.value == 3  # 10 // 3 = 3
    
        # 取模运算
        mod_result = dim10 % dim3
        assert isinstance(mod_result, tensor_shape.Dimension)
        assert mod_result.value == 1  # 10 % 3 = 1
    
        # 与整数的运算
        assert dim10 // 3 == 3
        assert dim10 % 3 == 1
        assert 10 // dim3 == 3
        assert 10 % dim3 == 1
    
        # 测试 __bool__ 方法
        dim0 = tensor_shape.Dimension(0)
        dim1 = tensor_shape.Dimension(1)
    
        # 非零维度应该为 True
        assert bool(dim1) is True
        # 零维度应该为 False
        assert bool(dim0) is False
        # 未知维度应该为 True（因为可能非零）
>       assert bool(dim_unknown) is True
E       assert False is True
E        +  where False = bool(Dimension(None))

tests\test_tensorflow_python_framework_tensor_shape.py:346: AssertionError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                                     Stmts   Miss Branch BrPart  Cover   Missing
----------------------------------------------------------------------------------------------------
tests\test_tensorflow_python_framework_tensor_shape.py     161     23     34      5    82%   62, 79-97, 137-143, 148-150, 202->exit, 310->318, 313-315
----------------------------------------------------------------------------------------------------
TOTAL                                                      161     23     34      5    82%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_framework_tensor_shape.py::test_tensorshape_construction[dims0-2-expected_dims0]
FAILED tests\test_tensorflow_python_framework_tensor_shape.py::test_tensorshape_construction[dims1-0-expected_dims1]
FAILED tests\test_tensorflow_python_framework_tensor_shape.py::test_tensorshape_construction[None-None-None]
FAILED tests\test_tensorflow_python_framework_tensor_shape.py::test_dimension_advanced_features
4 failed, 11 passed in 1.61s

Error: exit 1