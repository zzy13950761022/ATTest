=== Run Tests ===
.F.F.F.....                                                              [100%]
================================== FAILURES ===================================
_ test_basic_integer_bincount[dense-int64-shape1-edge_values-None-None-False] _

arr_type = 'dense', dtype = 'int64', shape = [20], values = 'edge_values'
weights = None, axis = None, binary_output = False

    @pytest.mark.parametrize("arr_type,dtype,shape,values,weights,axis,binary_output", [
        ("dense", "int32", [10], "random_int", None, None, False),
        ("dense", "int64", [20], "edge_values", None, None, False),  # 大整数类型验证
    ])
    def test_basic_integer_bincount(arr_type, dtype, shape, values, weights, axis, binary_output):
        """Test basic integer array frequency counting."""
        # Arrange
        # Generate test data based on parameters
        np.random.seed(42)
        if values == "random_int":
            arr_data = np.random.randint(0, 10, size=tuple(shape), dtype=np.int32)
        elif values == "edge_values":
            # Edge values test case: include 0 and max value
            arr_data = np.zeros(shape, dtype=np.int64)
            # Fill with some edge values
            for i in range(min(shape[0], 5)):
                arr_data[i] = i  # 0, 1, 2, 3, 4
            # Add some larger values
            if shape[0] > 5:
                arr_data[5] = 100
            if shape[0] > 6:
                arr_data[6] = 1000
        else:
            # Default to random if not specified
            arr_data = np.random.randint(0, 10, size=tuple(shape), dtype=np.int32)
    
        # Convert to appropriate dtype
        if dtype == "int32":
            arr = tf.constant(arr_data, dtype=tf.int32)
        elif dtype == "int64":
            arr = tf.constant(arr_data, dtype=tf.int64)
        else:
            arr = tf.constant(arr_data, dtype=tf.int32)
    
        # Act
>       result = bincount(arr)

tests\test_tensorflow_python_ops_bincount_ops.py:85: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\bincount_ops.py:121: in bincount
    arr = ops.convert_to_tensor(arr, name="arr", dtype=dtypes.int32)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\profiler\trace.py:183: in wrapped
    return func(*args, **kwargs)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

value = <tf.Tensor: shape=(20,), dtype=int64, numpy=
array([   0,    1,    2,    3,    4,  100, 1000,    0,    0,    0,    0,
          0,    0,    0,    0,    0,    0,    0,    0,    0], dtype=int64)>
dtype = tf.int32, name = 'arr', as_ref = False, preferred_dtype = None
dtype_hint = None
ctx = <tensorflow.python.eager.context.Context object at 0x00000259407719D0>
accepted_result_types = (<class 'tensorflow.python.framework.ops.Tensor'>,)

    @profiler_trace.trace_wrapper("convert_to_tensor")
    def convert_to_tensor(value,
                          dtype=None,
                          name=None,
                          as_ref=False,
                          preferred_dtype=None,
                          dtype_hint=None,
                          ctx=None,
                          accepted_result_types=(Tensor,)):
      """Implementation of the public convert_to_tensor."""
      # TODO(b/142518781): Fix all call-sites and remove redundant arg
      preferred_dtype = preferred_dtype or dtype_hint
      if isinstance(value, EagerTensor):
        if ctx is None:
          ctx = context.context()
        if not ctx.executing_eagerly():
          graph = get_default_graph()
          if not graph.building_function:
            raise RuntimeError("Attempting to capture an EagerTensor without "
                               "building a function.")
          return graph.capture(value, name=name)
    
      if dtype is not None:
        dtype = dtypes.as_dtype(dtype)
      if isinstance(value, Tensor):
        if dtype is not None and not dtype.is_compatible_with(value.dtype):
>         raise ValueError(
              "Tensor conversion requested dtype %s for Tensor with dtype %s: %r" %
              (dtype.name, value.dtype.name, value))
E         ValueError: Tensor conversion requested dtype int32 for Tensor with dtype int64: <tf.Tensor: shape=(20,), dtype=int64, numpy=
E         array([   0,    1,    2,    3,    4,  100, 1000,    0,    0,    0,    0,
E                   0,    0,    0,    0,    0,    0,    0,    0,    0], dtype=int64)>

D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\framework\ops.py:1662: ValueError
_ test_weighted_bincount_float_weights[dense-int32-shape1-fixed_pattern-int64-None-False] _

arr_type = 'dense', dtype = 'int32', shape = [8], values = 'fixed_pattern'
weights = 'int64', axis = None, binary_output = False

    @pytest.mark.parametrize("arr_type,dtype,shape,values,weights,axis,binary_output", [
        ("dense", "int32", [8], "fixed_pattern", "float32", None, False),
        ("dense", "int32", [8], "fixed_pattern", "int64", None, False),  # 整数权重累加
    ])
    def test_weighted_bincount_float_weights(arr_type, dtype, shape, values, weights, axis, binary_output):
        """Test weighted bincount with float weights."""
        # Arrange
        # Generate test data based on parameters
        np.random.seed(42)
        if values == "fixed_pattern":
            arr_data = np.array([1, 2, 1, 3, 2, 4, 1, 2], dtype=np.int32)
        else:
            # Default pattern
            arr_data = np.array([1, 2, 1, 3, 2, 4, 1, 2], dtype=np.int32)
    
        if weights == "float32":
            weights_data = np.random.randn(8).astype(np.float32)
        elif weights == "int64":
            weights_data = np.random.randint(1, 5, size=8, dtype=np.int64)
        else:
            # Default weights
            weights_data = np.random.randn(8).astype(np.float32)
    
        arr = tf.constant(arr_data)
        weights_tensor = tf.constant(weights_data)
    
        # Act
        result = bincount(arr, weights=weights_tensor)
    
        # Assert (weak assertions)
        # 1. Check shape
        max_val = np.max(arr_data)
        expected_length = max_val + 1 if max_val >= 0 else 0
        assert result.shape == (expected_length,)
    
        # 2. Check dtype - should match weights dtype (float32)
>       assert result.dtype == tf.float32
E       assert tf.int64 == tf.float32
E        +  where tf.int64 = <tf.Tensor: shape=(5,), dtype=int64, numpy=array([0, 5, 8, 3, 4], dtype=int64)>.dtype
E        +  and   tf.float32 = tf.float32

tests\test_tensorflow_python_ops_bincount_ops.py:149: AssertionError
______ test_2d_axis_bincount[dense-int32-shape1-random_int-None-0-False] ______

arr_type = 'dense', dtype = 'int32', shape = [4, 6], values = 'random_int'
weights = None, axis = 0, binary_output = False

    @pytest.mark.parametrize("arr_type,dtype,shape,values,weights,axis,binary_output", [
        ("dense", "int32", [3, 5], "random_int", None, -1, False),
        ("dense", "int32", [4, 6], "random_int", None, 0, False),  # 轴0切片验证
    ])
    def test_2d_axis_bincount(arr_type, dtype, shape, values, weights, axis, binary_output):
        """Test 2D array bincount along axis."""
        # Arrange
        # Generate test data based on parameters
        np.random.seed(42)
        if values == "random_int":
            arr_data = np.random.randint(0, 5, size=tuple(shape), dtype=np.int32)
        else:
            # Default random data
            arr_data = np.random.randint(0, 5, size=tuple(shape), dtype=np.int32)
    
        arr = tf.constant(arr_data)
    
        # Act
        result = bincount(arr, axis=axis)
    
        # Assert (weak assertions)
        # 1. Check shape based on axis
        max_val = np.max(arr_data)
        expected_length = max_val + 1 if max_val >= 0 else 0
    
        if axis == -1:
            # axis=-1: shape should be (batch_size, max_val+1)
            batch_size = arr_data.shape[0]
            assert result.shape == (batch_size, expected_length)
        elif axis == 0:
            # axis=0: shape should be (max_val+1, cols)
            cols = arr_data.shape[1]
>           assert result.shape == (expected_length, cols)
E           assert TensorShape([5]) == (5, 6)
E             
E             Use -v to get more diff

tests\test_tensorflow_python_ops_bincount_ops.py:204: AssertionError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                               Stmts   Miss Branch BrPart  Cover   Missing
----------------------------------------------------------------------------------------------
tests\test_tensorflow_python_ops_bincount_ops.py     163     24     66     16    78%   24, 29, 34, 39, 44, 68->70, 70->77, 74, 82, 106->105, 126, 134, 160->159, 185, 201->207, 222->221, 224-237, 255, 278->277, 284, 340
----------------------------------------------------------------------------------------------
TOTAL                                                163     24     66     16    78%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_ops_bincount_ops.py::test_basic_integer_bincount[dense-int64-shape1-edge_values-None-None-False]
FAILED tests\test_tensorflow_python_ops_bincount_ops.py::test_weighted_bincount_float_weights[dense-int32-shape1-fixed_pattern-int64-None-False]
FAILED tests\test_tensorflow_python_ops_bincount_ops.py::test_2d_axis_bincount[dense-int32-shape1-random_int-None-0-False]
3 failed, 8 passed in 2.09s

Error: exit 1