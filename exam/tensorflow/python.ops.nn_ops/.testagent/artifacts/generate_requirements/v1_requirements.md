# tensorflow.python.ops.nn_ops 测试需求

## 1. 目标与范围
- 验证神经网络核心操作（卷积、池化、激活函数）的正确性
- 测试填充机制（VALID、SAME、显式填充）在各种输入下的行为
- 确保输出形状计算符合文档公式
- 不在范围内的内容：高级网络层、训练循环、优化器、自定义操作

## 2. 输入与约束
- 参数模式：输入张量（float32/64）、滤波器/窗口大小（int/list）、步长（int/list）、填充方式（str/list）
- 有效取值范围：输入张量维度≥2，滤波器大小正整数，步长正整数≥1
- 设备要求：CPU/GPU兼容性，无特定设备绑定
- 必需组合：输入张量和滤波器大小必须提供，步长默认1，填充默认'VALID'
- 随机性要求：无内部随机状态，确定性操作

## 3. 输出与判定
- 返回结构：输出张量，保持输入数据类型
- 容差：浮点误差≤1e-6（单精度），≤1e-12（双精度）
- 形状验证：必须符合文档中的计算公式
- 副作用检查：无全局状态修改，无文件/网络操作

## 4. 错误与异常场景
- 非法输入：非数值张量、负维度、零滤波器大小
- 维度不匹配：输入通道≠滤波器输入通道
- 边界值：空张量、None输入、零步长、极端大形状
- 填充异常：无效填充字符串、显式填充列表长度错误
- 类型错误：字符串输入到数值参数、错误数据类型

## 5. 依赖与环境
- 外部依赖：TensorFlow核心库、CUDA（GPU测试）
- 需要mock：无外部API调用
- 需要monkeypatch：无
- 环境要求：Python 3.7+，TensorFlow 2.x

## 6. 覆盖与优先级
- 必测路径（高优先级）：
  1. 卷积操作三种填充方式（VALID、SAME、显式）
  2. 池化操作最大/平均池化边界条件
  3. 激活函数数值稳定性（梯度消失/爆炸）
  4. 批量归一化训练/推理模式切换
  5. 梯度计算与数值梯度一致性验证

- 可选路径（中/低优先级）：
  - 不同数据类型的兼容性（int8、int16、bfloat16）
  - 极端形状（1x1卷积、大窗口池化）
  - 膨胀卷积（dilation rate > 1）
  - 分组卷积和深度可分离卷积
  - 不同设备（CPU/GPU）结果一致性

- 已知风险/缺失信息：
  - 某些函数缺少类型注解
  - 边界条件文档不完整
  - 设备特定行为未明确
  - 100+函数中选择性测试覆盖
  - 性能基准未定义