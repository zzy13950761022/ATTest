=== Run Tests ===
..F.                                                                     [100%]
================================== FAILURES ===================================
_______ TestDefFunctionG1.test_variable_creation_and_state_preservation _______

self = <test_tensorflow_python_eager_def_function_g1.TestDefFunctionG1 object at 0x000001E9856BB370>

    def test_variable_creation_and_state_preservation(self):
        """CASE_03: 变量创建与状态保持 - 测试变量创建和状态保持"""
        import unittest.mock as mock
    
        # Test stateful counter function
        @def_function.function
        def stateful_counter():
            # Variable should be created only on first call
            if not hasattr(stateful_counter, 'counter'):
                stateful_counter.counter = tf.Variable(0, dtype=tf.int32)
            stateful_counter.counter.assign_add(1)
            return stateful_counter.counter.read_value()
    
        # Weak assertions
        # 1. variable_created_once: Variable should be created on first call
        # Mock Variable creation to verify it happens only once
        with mock.patch('tensorflow.Variable') as mock_var:
            # First call - should create variable
>           result1 = stateful_counter()

tests\test_tensorflow_python_eager_def_function_g1.py:154: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\util\traceback_utils.py:153: in error_handler
    raise e.with_traceback(filtered_tb) from None
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

x = <MagicMock name='Variable().read_value()' id='2102496509328'>

    def convert(x):
      """Converts a function output to a Tensor."""
      if x is None:
        return None
      if op_return_value is not None and isinstance(x, ops.Operation):
        # TODO(b/79881896): we currently can't capture external control deps, so
        # this won't work if x needs to be captured (i.e. if python_func returns
        # captured Operations).
        with ops.control_dependencies([x]):
          x = array_ops.identity(op_return_value)
      elif not isinstance(x, tensor_array_ops.TensorArray):
        try:
          x = ops.convert_to_tensor_or_composite(x)
        except (ValueError, TypeError):
>         raise TypeError(
              "To be compatible with tf.function, Python functions "
              "must return zero or more Tensors or ExtensionTypes or None "
              f"values; in compilation of {str(python_func)}, found return "
              f"value of type {type(x).__name__}, which is not a Tensor or "
              "ExtensionType.")
E         TypeError: To be compatible with tf.function, Python functions must return zero or more Tensors or ExtensionTypes or None values; in compilation of <function TestDefFunctionG1.test_variable_creation_and_state_preservation.<locals>.stateful_counter at 0x000001E9DFC8BDC0>, found return value of type MagicMock, which is not a Tensor or ExtensionType.

D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\framework\func_graph.py:1117: TypeError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                                    Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------------------------------
tests\test_tensorflow_python_eager_def_function_g1.py     146     50     20      1    58%   35, 78, 144-147, 155-161, 166-211, 221-224, 248-251, 263-269, 319
---------------------------------------------------------------------------------------------------
TOTAL                                                     146     50     20      1    58%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_eager_def_function_g1.py::TestDefFunctionG1::test_variable_creation_and_state_preservation
1 failed, 3 passed in 1.85s

Error: exit 1