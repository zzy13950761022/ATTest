=== Run Tests ===
FFEEEEEs                                                                 [100%]
=================================== ERRORS ====================================
_ ERROR at setup of TestBatchOps.test_parameter_validation[2-4-5000-allowed_batch_sizes0-5-False-False-input_shape0-float64] _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1226: AttributeError

During handling of the above exception, another exception occurred:

    @pytest.fixture
    def mock_validate_allowed_batch_sizes():
        """Mock for tensorflow.python.ops.batch_ops._validate_allowed_batch_sizes"""
        # Import the module first, then patch the function
        # Use patch with create=True since the function might not be exported
        import tensorflow.python.ops.batch_ops as batch_ops_module
>       with patch('tensorflow.python.ops.batch_ops._validate_allowed_batch_sizes', create=True) as mock:

tests\test_tensorflow_python_ops_batch_ops.py:86: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1388: in __enter__
    self.target = self.getter()
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1563: in <lambda>
    getter = lambda: _importer(target)
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1239: in _importer
    thing = _dot_lookup(thing, comp, import_path)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
            return getattr(thing, comp)
        except AttributeError:
            __import__(import_path)
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1229: AttributeError
_ ERROR at setup of TestBatchOps.test_parameter_validation[1-1-100-allowed_batch_sizes1-1-True-True-input_shape1-float32] _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1226: AttributeError

During handling of the above exception, another exception occurred:

    @pytest.fixture
    def mock_validate_allowed_batch_sizes():
        """Mock for tensorflow.python.ops.batch_ops._validate_allowed_batch_sizes"""
        # Import the module first, then patch the function
        # Use patch with create=True since the function might not be exported
        import tensorflow.python.ops.batch_ops as batch_ops_module
>       with patch('tensorflow.python.ops.batch_ops._validate_allowed_batch_sizes', create=True) as mock:

tests\test_tensorflow_python_ops_batch_ops.py:86: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1388: in __enter__
    self.target = self.getter()
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1563: in <lambda>
    getter = lambda: _importer(target)
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1239: in _importer
    thing = _dot_lookup(thing, comp, import_path)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
            return getattr(thing, comp)
        except AttributeError:
            __import__(import_path)
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1229: AttributeError
_ ERROR at setup of TestBatchOps.test_error_handling[1-2-1000-allowed_batch_sizes0-10-True-True-input_shape0-float32-True] _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1226: AttributeError

During handling of the above exception, another exception occurred:

    @pytest.fixture
    def mock_validate_allowed_batch_sizes():
        """Mock for tensorflow.python.ops.batch_ops._validate_allowed_batch_sizes"""
        # Import the module first, then patch the function
        # Use patch with create=True since the function might not be exported
        import tensorflow.python.ops.batch_ops as batch_ops_module
>       with patch('tensorflow.python.ops.batch_ops._validate_allowed_batch_sizes', create=True) as mock:

tests\test_tensorflow_python_ops_batch_ops.py:86: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1388: in __enter__
    self.target = self.getter()
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1563: in <lambda>
    getter = lambda: _importer(target)
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1239: in _importer
    thing = _dot_lookup(thing, comp, import_path)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
            return getattr(thing, comp)
        except AttributeError:
            __import__(import_path)
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1229: AttributeError
_ ERROR at setup of TestBatchOps.test_concurrent_batch_processing[2-4-10000-None-20-True-True-input_shape0-float32-3] _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1226: AttributeError

During handling of the above exception, another exception occurred:

    @pytest.fixture
    def mock_BatchFunction():
        """Mock for tensorflow.python.ops.batch_ops._BatchFunction"""
        # Import the module first, then patch the class
        # Use patch with create=True since the class might not be exported
        import tensorflow.python.ops.batch_ops as batch_ops_module
>       with patch('tensorflow.python.ops.batch_ops._BatchFunction', create=True) as mock:

tests\test_tensorflow_python_ops_batch_ops.py:107: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1388: in __enter__
    self.target = self.getter()
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1563: in <lambda>
    getter = lambda: _importer(target)
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1239: in _importer
    thing = _dot_lookup(thing, comp, import_path)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
            return getattr(thing, comp)
        except AttributeError:
            __import__(import_path)
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1229: AttributeError
_ ERROR at setup of TestBatchOps.test_concurrent_batch_processing[1-10-5000-None-5-True-True-input_shape1-float32-5] _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1226: AttributeError

During handling of the above exception, another exception occurred:

    @pytest.fixture
    def mock_BatchFunction():
        """Mock for tensorflow.python.ops.batch_ops._BatchFunction"""
        # Import the module first, then patch the class
        # Use patch with create=True since the class might not be exported
        import tensorflow.python.ops.batch_ops as batch_ops_module
>       with patch('tensorflow.python.ops.batch_ops._BatchFunction', create=True) as mock:

tests\test_tensorflow_python_ops_batch_ops.py:107: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1388: in __enter__
    self.target = self.getter()
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1563: in <lambda>
    getter = lambda: _importer(target)
D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1239: in _importer
    thing = _dot_lookup(thing, comp, import_path)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

thing = <module 'tensorflow' from 'D:\\Coding\\Anaconda\\envs\\testagent-experiment\\lib\\site-packages\\tensorflow\\__init__.py'>
comp = 'python', import_path = 'tensorflow.python'

    def _dot_lookup(thing, comp, import_path):
        try:
            return getattr(thing, comp)
        except AttributeError:
            __import__(import_path)
>           return getattr(thing, comp)
E           AttributeError: module 'tensorflow' has no attribute 'python'

D:\Coding\Anaconda\envs\testagent-experiment\lib\unittest\mock.py:1229: AttributeError
================================== FAILURES ===================================
_ TestBatchOps.test_basic_decorator_functionality[1-2-1000-None-10-True-True-input_shape0-float32] _

self = <test_tensorflow_python_ops_batch_ops.TestBatchOps object at 0x0000023C3B026A30>
num_batch_threads = 1, max_batch_size = 2, batch_timeout_micros = 1000
allowed_batch_sizes = None, max_enqueued_batches = 10, autograph = True
enable_large_batch_splitting = True, input_shape = [2, 3], dtype = 'float32'
mock_batch_function = <MagicMock name='batch_function' id='2457711416896'>
mock_defun = <MagicMock name='defun' id='2457711498288'>
mock_tensor_spec = <MagicMock name='TensorSpec' id='2457711530960'>
mock_pack_sequence_as = <MagicMock name='pack_sequence_as' id='2457711551440'>
sample_input_tensor = <tf.Tensor: shape=(2, 3), dtype=float32, numpy=
array([[ 0.49671414, -0.1382643 ,  0.64768857],
       [ 1.5230298 , -0.23415338, -0.23413695]], dtype=float32)>
sample_function = <function sample_function.<locals>.func at 0x0000023C3B04A4C0>

    @pytest.mark.parametrize("num_batch_threads,max_batch_size,batch_timeout_micros,allowed_batch_sizes,max_enqueued_batches,autograph,enable_large_batch_splitting,input_shape,dtype", [
        (1, 2, 1000, None, 10, True, True, [2, 3], "float32"),
        (4, 8, 10000, [2, 4, 8], 20, False, False, [4, 5], "float64"),
    ])
    def test_basic_decorator_functionality(
        self,
        num_batch_threads,
        max_batch_size,
        batch_timeout_micros,
        allowed_batch_sizes,
        max_enqueued_batches,
        autograph,
        enable_large_batch_splitting,
        input_shape,
        dtype,
        mock_batch_function,
        mock_defun,
        mock_tensor_spec,
        mock_pack_sequence_as,
        sample_input_tensor,
        sample_function
    ):
        """
        TC-01: 基本装饰器功能
        测试基本装饰器创建和调用功能
        """
        # Arrange
        # Create input tensor with specified shape and dtype
        if dtype == "float32":
            tf_dtype = tf.float32
            np_dtype = np.float32
        else:
            tf_dtype = tf.float64
            np_dtype = np.float64
    
        input_data = np.random.randn(*input_shape).astype(np_dtype)
        input_tensor = tf.constant(input_data, dtype=tf_dtype)
    
        # Act
        # Create the batch decorator
        batch_decorator = batch_ops.batch_function(
            num_batch_threads=num_batch_threads,
            max_batch_size=max_batch_size,
            batch_timeout_micros=batch_timeout_micros,
            allowed_batch_sizes=allowed_batch_sizes,
            max_enqueued_batches=max_enqueued_batches,
            autograph=autograph,
            enable_large_batch_splitting=enable_large_batch_splitting
        )
    
        # Apply decorator to sample function
        decorated_func = batch_decorator(sample_function)
    
        # Call decorated function
>       result = decorated_func(input_tensor)

tests\test_tensorflow_python_ops_batch_ops.py:174: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

args = (<tf.Tensor: shape=(2, 3), dtype=float32, numpy=
array([[ 1.5792128 ,  0.7674347 , -0.46947438],
       [ 0.54256004, -0.46341768, -0.46572974]], dtype=float32)>,)
computation = <function batch_function.<locals>.decorator.<locals>.decorated.<locals>.computation at 0x0000023C3B04A670>

    def decorated(*args):  # pylint: disable=missing-docstring
    
      @function.defun(autograph=autograph)
      def computation(*computation_args):
        return fn(*computation_args)
    
>     computation = computation.get_concrete_function(
          *[tensor_spec.TensorSpec(dtype=x.dtype, shape=x.shape, name=str(i))
            for i, x in enumerate(args)])
E     AttributeError: 'function' object has no attribute 'get_concrete_function'

D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\batch_ops.py:94: AttributeError
---------------------------- Captured stderr setup ----------------------------
2026-01-21 13:07:45.983021: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX AVX2
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
_ TestBatchOps.test_basic_decorator_functionality[4-8-10000-allowed_batch_sizes1-20-False-False-input_shape1-float64] _

self = <test_tensorflow_python_ops_batch_ops.TestBatchOps object at 0x0000023C3B026A90>
num_batch_threads = 4, max_batch_size = 8, batch_timeout_micros = 10000
allowed_batch_sizes = [2, 4, 8], max_enqueued_batches = 20, autograph = False
enable_large_batch_splitting = False, input_shape = [4, 5], dtype = 'float64'
mock_batch_function = <MagicMock name='batch_function' id='2457711416656'>
mock_defun = <MagicMock name='defun' id='2457730650064'>
mock_tensor_spec = <MagicMock name='TensorSpec' id='2457730620960'>
mock_pack_sequence_as = <MagicMock name='pack_sequence_as' id='2457730657632'>
sample_input_tensor = <tf.Tensor: shape=(2, 3), dtype=float32, numpy=
array([[ 0.24196227, -1.9132802 , -1.7249179 ],
       [-0.5622875 , -1.0128311 ,  0.31424734]], dtype=float32)>
sample_function = <function sample_function.<locals>.func at 0x0000023C3C285430>

    @pytest.mark.parametrize("num_batch_threads,max_batch_size,batch_timeout_micros,allowed_batch_sizes,max_enqueued_batches,autograph,enable_large_batch_splitting,input_shape,dtype", [
        (1, 2, 1000, None, 10, True, True, [2, 3], "float32"),
        (4, 8, 10000, [2, 4, 8], 20, False, False, [4, 5], "float64"),
    ])
    def test_basic_decorator_functionality(
        self,
        num_batch_threads,
        max_batch_size,
        batch_timeout_micros,
        allowed_batch_sizes,
        max_enqueued_batches,
        autograph,
        enable_large_batch_splitting,
        input_shape,
        dtype,
        mock_batch_function,
        mock_defun,
        mock_tensor_spec,
        mock_pack_sequence_as,
        sample_input_tensor,
        sample_function
    ):
        """
        TC-01: 基本装饰器功能
        测试基本装饰器创建和调用功能
        """
        # Arrange
        # Create input tensor with specified shape and dtype
        if dtype == "float32":
            tf_dtype = tf.float32
            np_dtype = np.float32
        else:
            tf_dtype = tf.float64
            np_dtype = np.float64
    
        input_data = np.random.randn(*input_shape).astype(np_dtype)
        input_tensor = tf.constant(input_data, dtype=tf_dtype)
    
        # Act
        # Create the batch decorator
        batch_decorator = batch_ops.batch_function(
            num_batch_threads=num_batch_threads,
            max_batch_size=max_batch_size,
            batch_timeout_micros=batch_timeout_micros,
            allowed_batch_sizes=allowed_batch_sizes,
            max_enqueued_batches=max_enqueued_batches,
            autograph=autograph,
            enable_large_batch_splitting=enable_large_batch_splitting
        )
    
        # Apply decorator to sample function
        decorated_func = batch_decorator(sample_function)
    
        # Call decorated function
>       result = decorated_func(input_tensor)

tests\test_tensorflow_python_ops_batch_ops.py:174: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

args = (<tf.Tensor: shape=(4, 5), dtype=float64, numpy=
array([[-0.90802408, -1.4123037 ,  1.46564877, -0.2257763 ,  0.067528..., -0.60170661,  1.85227818, -0.01349722],
       [-1.05771093,  0.82254491, -1.22084365,  0.2088636 , -1.95967012]])>,)
computation = <function batch_function.<locals>.decorator.<locals>.decorated.<locals>.computation at 0x0000023C3C2855E0>

    def decorated(*args):  # pylint: disable=missing-docstring
    
      @function.defun(autograph=autograph)
      def computation(*computation_args):
        return fn(*computation_args)
    
>     computation = computation.get_concrete_function(
          *[tensor_spec.TensorSpec(dtype=x.dtype, shape=x.shape, name=str(i))
            for i, x in enumerate(args)])
E     AttributeError: 'function' object has no attribute 'get_concrete_function'

D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\batch_ops.py:94: AttributeError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                            Stmts   Miss Branch BrPart  Cover   Missing
-------------------------------------------------------------------------------------------
tests\test_tensorflow_python_ops_batch_ops.py     178    102     28      2    39%   16-18, 54, 87, 98, 109-112, 178-210, 243-300, 333-405, 439-518, 525, 530
-------------------------------------------------------------------------------------------
TOTAL                                             178    102     28      2    39%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_ops_batch_ops.py::TestBatchOps::test_basic_decorator_functionality[1-2-1000-None-10-True-True-input_shape0-float32]
FAILED tests\test_tensorflow_python_ops_batch_ops.py::TestBatchOps::test_basic_decorator_functionality[4-8-10000-allowed_batch_sizes1-20-False-False-input_shape1-float64]
ERROR tests\test_tensorflow_python_ops_batch_ops.py::TestBatchOps::test_parameter_validation[2-4-5000-allowed_batch_sizes0-5-False-False-input_shape0-float64]
ERROR tests\test_tensorflow_python_ops_batch_ops.py::TestBatchOps::test_parameter_validation[1-1-100-allowed_batch_sizes1-1-True-True-input_shape1-float32]
ERROR tests\test_tensorflow_python_ops_batch_ops.py::TestBatchOps::test_error_handling[1-2-1000-allowed_batch_sizes0-10-True-True-input_shape0-float32-True]
ERROR tests\test_tensorflow_python_ops_batch_ops.py::TestBatchOps::test_concurrent_batch_processing[2-4-10000-None-20-True-True-input_shape0-float32-3]
ERROR tests\test_tensorflow_python_ops_batch_ops.py::TestBatchOps::test_concurrent_batch_processing[1-10-5000-None-5-True-True-input_shape1-float32-5]
2 failed, 1 skipped, 5 errors in 2.49s

Error: exit 1