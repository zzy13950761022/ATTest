# tensorflow.python.ops.string_ops 测试计划

## 1. 测试策略
- 单元测试框架：pytest
- 隔离策略：mock/monkeypatch/fixtures 用于底层 gen_string_ops 操作
- 随机性处理：固定随机种子，使用确定性测试数据
- 设备策略：默认 CPU 测试，不涉及 GPU 设备

## 2. 生成规格摘要（来自 test_plan.json）
- SMOKE_SET: CASE_01, CASE_02, CASE_03（核心功能验证）
- DEFERRED_SET: CASE_04, CASE_05（正则替换和分割）
- 测试文件路径：tests/test_tensorflow_python_ops_string_ops.py（单文件）
- 断言分级策略：首轮使用 weak 断言（形状、类型、基础相等性）
- 预算策略：S/M 规模，每用例 70-85 行，最多 6 个参数

## 3. 数据与边界
- 正常数据集：ASCII 字符串、Unicode 表情、混合字符
- 随机生成策略：固定种子生成可重复测试数据
- 边界值：空字符串、空张量、特殊控制字符
- 极端形状：零维标量、一维数组、二维矩阵
- 空输入：空字符串、空数组、None 值处理
- 负例场景：无效 UTF-8、无效正则语法、类型错误

## 4. 覆盖映射
| TC ID | 对应需求 | 覆盖约束 |
|-------|----------|----------|
| TC-01 | 正则匹配函数对 re2 语法的正确解析 | 基础正则匹配、形状保持 |
| TC-02 | 字符串长度计算在 BYTE 和 UTF8_CHAR 单位的差异 | 单位转换、Unicode 处理 |
| TC-03 | 字符串连接保持形状一致性 | 数组连接、分隔符处理 |
| TC-04 | 正则替换功能验证 | 全局/非全局替换模式 |
| TC-05 | 字符串分割对空值和分隔符的处理 | 稀疏张量、分割行为 |

## 5. 尚未覆盖的风险点
- re2 与 Python re 语法差异的具体表现
- UTF8_CHAR 对无效 UTF-8 字符串的具体异常行为
- 多字节字符在长度计算中的边界情况
- 正则表达式性能差异（static vs 动态模式）
- 超大字符串的内存使用和性能影响
- 多设备（CPU/GPU）一致性验证

## 6. 迭代策略
- 首轮：仅生成 SMOKE_SET（3个用例），使用 weak 断言
- 后续轮次：修复失败用例，逐步启用 deferred 用例
- 最终轮次：启用 strong 断言，可选覆盖率检查