=== Run Tests ===
..F                                                                      [100%]
================================== FAILURES ===================================
_______________ TestXLACompileSpecial.test_none_output_handling _______________

self = <test_tensorflow_python_compiler_xla_xla_special.TestXLACompileSpecial object at 0x000002155B300DC0>

    def test_none_output_handling(self):
        """测试None输出处理"""
    
        # 定义返回None的函数
        def none_output_computation(x):
            # 执行操作但不返回张量
            _ = tf.reduce_sum(x)  # 操作会被执行
            return None
    
        # 创建测试输入
        x = create_test_tensor((3, 4), np.float32)
    
        # 直接调用计算函数
        # 注意：直接调用返回None
        direct_result = none_output_computation(x)
        assert direct_result is None, "直接调用应该返回None"
    
        # 使用 xla.compile 编译计算 - 预期会失败
        # 根据文档，None输出应该返回一个NoOp操作
        # 但实际上由于tf.function的限制会抛出TypeError
        with pytest.raises(TypeError) as exc_info:
            xla.compile(none_output_computation, inputs=[x])
    
        # 验证错误消息
        error_msg = str(exc_info.value)
        assert "must return zero or more Tensors" in error_msg or \
               "not a Tensor" in error_msg, f"错误消息不符合预期: {error_msg}"
    
        # 验证操作可以执行（不会抛出异常）
        # 在TensorFlow中，操作需要在会话中执行，但在eager模式下会自动执行
        # 这里我们只验证操作存在且类型正确
    
        # 测试带有操作和None混合输出的函数
        def mixed_output_computation(x):
            # 返回一个张量和一个None
            return tf.reduce_sum(x), None
    
        # 直接调用
        direct_mixed = mixed_output_computation(x)
        assert isinstance(direct_mixed, tuple), "直接调用应该返回元组"
        assert len(direct_mixed) == 2, "应该有两个输出"
        assert isinstance(direct_mixed[0], tf.Tensor), "第一个输出应该是张量"
        assert direct_mixed[1] is None, "第二个输出应该是None"
    
        # 使用 xla.compile - 预期会失败，因为包含None输出
        with pytest.raises(TypeError) as exc_info:
>           xla.compile(mixed_output_computation, inputs=[x])

tests\test_tensorflow_python_compiler_xla_xla_special.py:156: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\util\deprecation.py:344: in new_func
    return func(*args, **kwargs)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\compiler\xla\xla.py:120: in compile
    return xla_compile_wrapper()
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\util\traceback_utils.py:153: in error_handler
    raise e.with_traceback(filtered_tb) from None
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

args = (), kwargs = {}

    def autograph_handler(*args, **kwargs):
      """Calls a converted version of original_func."""
      # TODO(mdan): Push this block higher in tf.function's call stack.
      try:
        return autograph.converted_call(
            original_func,
            args,
            kwargs,
            options=autograph.ConversionOptions(
                recursive=True,
                optional_features=autograph_options,
                user_requested=True,
            ))
      except Exception as e:  # pylint:disable=broad-except
        if hasattr(e, "ag_error_metadata"):
>         raise e.ag_error_metadata.to_exception(e)
E         ValueError: in user code:
E         
E         
E             ValueError: XLA computation function return values must all either be Operations or convertible to Tensors. Got error: "None values not supported."

D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\framework\func_graph.py:1147: ValueError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                                       Stmts   Miss Branch BrPart  Cover   Missing
------------------------------------------------------------------------------------------------------
test_actual_behavior.py                                        0      0      0      0   100%
test_fix_verification.py                                       7      7      0      0     0%   1-16
test_none_behavior.py                                         24     24      0      0     0%   1-33
tests\test_tensorflow_python_compiler_xla_xla_special.py      89     29     12      3    64%   27, 34-39, 159-201, 209
------------------------------------------------------------------------------------------------------
TOTAL                                                        120     60     12      3    49%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_compiler_xla_xla_special.py::TestXLACompileSpecial::test_none_output_handling
1 failed, 2 passed in 2.04s

Error: exit 1