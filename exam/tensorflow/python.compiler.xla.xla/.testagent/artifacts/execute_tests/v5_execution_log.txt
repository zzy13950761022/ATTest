=== Run Tests ===
.....F                                                                   [100%]
================================== FAILURES ===================================
_______ TestXLACompileCore.test_none_and_empty_inputs[none-multi_input] _______

self = <test_tensorflow_python_compiler_xla_xla_core.TestXLACompileCore object at 0x0000022DAFDD91C0>
inputs_type = 'none', computation_type = 'multi_input'

    @pytest.mark.parametrize("inputs_type,computation_type", [
        ("none", "identity"),  # inputs=None
        ("empty_list", "identity"),  # inputs=[]
        ("none", "multi_input"),  # 多输入函数的None输入处理
    ])
    def test_none_and_empty_inputs(self, inputs_type, computation_type):
        """测试None与空输入处理"""
    
        if computation_type == "identity":
            # 定义恒等函数
            def identity(x):
                return x
    
            # 根据输入类型准备输入
            if inputs_type == "none":
                # inputs=None 等价于空列表，函数应该接受0个参数
                def identity_no_args():
                    return tf.constant(1.0, dtype=np.float32)
    
                # 直接调用计算函数作为基准
                direct_result = identity_no_args()
                # 使用 xla.compile 编译计算
                compiled_result = xla.compile(identity_no_args, inputs=None)
            elif inputs_type == "empty_list":
                # inputs=[]，函数应该接受0个参数
                def identity_no_args():
                    return tf.constant(1.0, dtype=np.float32)
    
                # 直接调用计算函数作为基准
                direct_result = identity_no_args()
                # 使用 xla.compile 编译计算
                compiled_result = xla.compile(identity_no_args, inputs=[])
            else:
                raise ValueError(f"Unknown inputs_type: {inputs_type}")
    
        elif computation_type == "multi_input":
            # 定义多输入函数
            def multi_input(x, y):
                return x + y, x * y
    
            # inputs=None 的情况
            if inputs_type == "none":
                # 对于多输入函数，inputs=None 意味着没有输入
                # 但函数需要2个参数，所以我们需要创建一个包装函数
                def multi_input_wrapper():
                    # 在函数内部创建测试张量
                    x = create_test_tensor((2, 2), np.float32)
                    y = create_test_tensor((2, 2), np.float32)
                    return multi_input(x, y)
    
                # 直接调用计算函数作为基准
                direct_result = multi_input_wrapper()
                # 使用 xla.compile 编译计算
                compiled_result = xla.compile(multi_input_wrapper, inputs=None)
            else:
                raise ValueError(f"multi_input only supports inputs_type='none'")
    
        else:
            raise ValueError(f"Unknown computation_type: {computation_type}")
    
        # 验证无错误发生
        assert compiled_result is not None, "编译结果不应为None"
    
        # 验证输出一致性
        # 注意：xla.compile 返回列表，而直接调用可能返回元组或张量
        if isinstance(direct_result, tuple):
            # 直接调用返回元组，xla.compile 返回列表
            assert isinstance(compiled_result, list), "xla.compile 应该返回列表"
            assert len(direct_result) == len(compiled_result), "输出数量应该一致"
            for d_out, c_out in zip(direct_result, compiled_result):
                assert d_out.shape == c_out.shape, "输出形状应该一致"
                assert d_out.dtype == c_out.dtype, "输出数据类型应该一致"
                # 数值相等性检查
>               np.testing.assert_allclose(
                    c_out.numpy(),
                    d_out.numpy(),
                    rtol=RTOL,
                    atol=ATOL
E                   AssertionError: 
E                   Not equal to tolerance rtol=1e-06, atol=1e-08
E                   
E                   Mismatched elements: 4 / 4 (100%)
E                   Max absolute difference: 2.0686207
E                   Max relative difference: 2.96679
E                    x: array([[ 0.459765, -0.973759],
E                          [ 1.362224, -0.589984]], dtype=float32)
E                    y: array([[-1.608856, -2.454529],
E                          [-0.692613, -1.117043]], dtype=float32)

tests\test_tensorflow_python_compiler_xla_xla_core.py:171: AssertionError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                                    Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------------------------------
test_actual_behavior.py                                     0      0      0      0   100%
test_fix_verification.py                                    7      7      0      0     0%   1-16
test_none_behavior.py                                      24     24      0      0     0%   1-33
tests\test_tensorflow_python_compiler_xla_xla_core.py      97     15     34      8    76%   24-27, 32-39, 109, 131, 153-156, 167->193, 177->193, 193->exit, 227
---------------------------------------------------------------------------------------------------
TOTAL                                                     128     46     34      8    62%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_compiler_xla_xla_core.py::TestXLACompileCore::test_none_and_empty_inputs[none-multi_input]
1 failed, 5 passed in 2.23s

Error: exit 1