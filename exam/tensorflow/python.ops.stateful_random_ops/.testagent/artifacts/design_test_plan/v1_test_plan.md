# tensorflow.python.ops.stateful_random_ops 测试计划

## 1. 测试策略
- 单元测试框架：pytest
- 隔离策略：mock/monkeypatch/fixtures
- 随机性处理：固定随机种子/控制 RNG
- 设备支持：CPU 优先，GPU 可选
- 分布式环境：模拟测试，避免真实集群依赖

## 2. 生成规格摘要（来自 test_plan.json）
- **SMOKE_SET**: CASE_01, CASE_02, CASE_03
- **DEFERRED_SET**: CASE_04, CASE_05
- **测试文件路径**: tests/test_tensorflow_python_ops_stateful_random_ops.py
- **断言分级策略**: 首轮使用 weak 断言，最终启用 strong 断言
- **预算策略**: 
  - 每个用例最大 80-90 行代码
  - 最多 5-7 个参数
  - 所有用例均为参数化测试
  - 首轮只生成 3 个核心用例

## 3. 数据与边界
- **正常数据集**: 标准种子值（1234, 5678, 9999），常见形状（2x3, 3x2, 4）
- **边界值**: 
  - 种子：0，极大整数，负整数
  - 形状：空张量，0维度，高维形状
  - 算法：无效标识，字符串参数
- **极端情况**:
  - 状态张量为 None 或空
  - 不支持的 dtype
  - 分布式策略模拟
- **负例场景**:
  - 无效算法参数
  - 错误形状参数
  - 类型不匹配
  - 状态验证失败

## 4. 覆盖映射
| TC ID | 对应需求 | 覆盖功能点 | 优先级 |
|-------|----------|------------|--------|
| TC-01 | 必测路径1 | Generator.from_seed 创建 | High |
| TC-02 | 必测路径2 | 种子序列一致性 | High |
| TC-03 | 必测路径3 | 状态更新机制 | High |
| TC-04 | 必测路径4 | 双算法支持 | High |
| TC-05 | 必测路径5 | 错误处理 | High |

### 尚未覆盖的风险点
1. 分布式环境下的状态同步
2. 全局生成器访问和重置
3. 非确定性状态生成
4. key_counter 方式创建生成器
5. 各种分布方法（normal, uniform, poisson等）
6. GPU设备一致性
7. 种子自动填充机制
8. 状态复制和独立操作

### 迭代策略
- **首轮**: 生成 SMOKE_SET（3个用例），使用 weak 断言
- **后续**: 修复失败用例，逐步添加 DEFERRED_SET
- **最终**: 启用 strong 断言，可选覆盖率提升

### Mock 策略
- 首轮无需 mock，直接测试功能
- 后续可能需要 mock 底层 C++ 操作
- 分布式环境使用策略模拟
- 设备相关测试使用条件跳过