=== Run Tests ===
FFF                                                                      [100%]
================================== FAILURES ===================================
_ TestDenseToSparseBatch.test_dense_to_sparse_batch_basic[2-row_shape0-compatible-data_type0] _

self = <test_tensorflow_python_data_experimental_ops_batching_g2.TestDenseToSparseBatch object at 0x000002797ADDEE20>
batch_size = 2, row_shape = [4], input_shape = 'compatible'
data_type = tf.float64

    @pytest.mark.parametrize("batch_size,row_shape,input_shape,data_type", [
        (2, [4], "compatible", tf.float64),
        (3, [2, 2, 2], "multi_dimension", tf.float32),  # param extension
    ])
    def test_dense_to_sparse_batch_basic(self, batch_size, row_shape,
                                        input_shape, data_type):
        """Test basic functionality of dense_to_sparse_batch (CASE_03)."""
        # Create test data with compatible shapes
        if input_shape == "compatible":
            # Create tensors with shape compatible with row_shape=[4]
            # Each tensor is 1D with length <= 4
            tensors = [
                tf.constant([1.0, 2.0], dtype=data_type),           # length 2
                tf.constant([3.0, 4.0, 5.0], dtype=data_type),      # length 3
                tf.constant([6.0], dtype=data_type),                # length 1
                tf.constant([7.0, 8.0, 9.0, 10.0], dtype=data_type), # length 4
                tf.constant([11.0, 12.0], dtype=data_type),         # length 2
                tf.constant([13.0, 14.0, 15.0], dtype=data_type),   # length 3
            ]
        elif input_shape == "multi_dimension":
            # Create 3D tensors compatible with row_shape=[2, 2, 2]
            # Each tensor is 3D with shape <= [2, 2, 2]
            tensors = [
                tf.constant([[[1.0, 2.0]]], dtype=data_type),  # shape [1, 1, 2]
                tf.constant([[[3.0], [4.0]]], dtype=data_type), # shape [1, 2, 1]
                tf.constant([[[5.0, 6.0], [7.0, 8.0]]], dtype=data_type), # shape [1, 2, 2]
                tf.constant([[[9.0]]], dtype=data_type),       # shape [1, 1, 1]
                tf.constant([[[10.0, 11.0]]], dtype=data_type), # shape [1, 1, 2]
                tf.constant([[[12.0], [13.0]]], dtype=data_type), # shape [1, 2, 1]
            ]
        else:
            # Default case
            tensors = [
                tf.constant([1.0, 2.0], dtype=data_type),
                tf.constant([3.0, 4.0, 5.0], dtype=data_type),
            ]
    
>       dataset = tf.data.Dataset.from_tensor_slices(tensors)

tests\test_tensorflow_python_data_experimental_ops_batching_g2.py:66: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\ops\dataset_ops.py:793: in from_tensor_slices
    return TensorSliceDataset(tensors, name=name)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\ops\dataset_ops.py:4477: in __init__
    element = structure.normalize_element(element)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\util\structure.py:125: in normalize_element
    ops.convert_to_tensor(t, name="component_%d" % i, dtype=dtype))
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\profiler\trace.py:183: in wrapped
    return func(*args, **kwargs)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\framework\ops.py:1695: in convert_to_tensor
    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\array_ops.py:1547: in _autopacking_conversion_function
    return _autopacking_helper(v, dtype, name or "packed")
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\array_ops.py:1454: in _autopacking_helper
    return gen_array_ops.pack(list_or_tuple, name=name)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\gen_array_ops.py:6547: in pack
    _ops.raise_from_not_ok_status(e, name)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

e = _NotOkStatusException(), name = 'component_0'

    def raise_from_not_ok_status(e, name):
      e.message += (" name: " + name if name is not None else "")
>     raise core._status_to_exception(e) from None  # pylint: disable=protected-access
E     tensorflow.python.framework.errors_impl.InvalidArgumentError: Shapes of all inputs must match: values[0].shape = [2] != values[1].shape = [3] [Op:Pack] name: component_0

D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\framework\ops.py:7186: InvalidArgumentError
---------------------------- Captured stderr call -----------------------------
2026-01-18 16:01:56.442516: I tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX AVX2
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
_ TestDenseToSparseBatch.test_dense_to_sparse_batch_basic[3-row_shape1-multi_dimension-data_type1] _

self = <test_tensorflow_python_data_experimental_ops_batching_g2.TestDenseToSparseBatch object at 0x000002797ADDEE80>
batch_size = 3, row_shape = [2, 2, 2], input_shape = 'multi_dimension'
data_type = tf.float32

    @pytest.mark.parametrize("batch_size,row_shape,input_shape,data_type", [
        (2, [4], "compatible", tf.float64),
        (3, [2, 2, 2], "multi_dimension", tf.float32),  # param extension
    ])
    def test_dense_to_sparse_batch_basic(self, batch_size, row_shape,
                                        input_shape, data_type):
        """Test basic functionality of dense_to_sparse_batch (CASE_03)."""
        # Create test data with compatible shapes
        if input_shape == "compatible":
            # Create tensors with shape compatible with row_shape=[4]
            # Each tensor is 1D with length <= 4
            tensors = [
                tf.constant([1.0, 2.0], dtype=data_type),           # length 2
                tf.constant([3.0, 4.0, 5.0], dtype=data_type),      # length 3
                tf.constant([6.0], dtype=data_type),                # length 1
                tf.constant([7.0, 8.0, 9.0, 10.0], dtype=data_type), # length 4
                tf.constant([11.0, 12.0], dtype=data_type),         # length 2
                tf.constant([13.0, 14.0, 15.0], dtype=data_type),   # length 3
            ]
        elif input_shape == "multi_dimension":
            # Create 3D tensors compatible with row_shape=[2, 2, 2]
            # Each tensor is 3D with shape <= [2, 2, 2]
            tensors = [
                tf.constant([[[1.0, 2.0]]], dtype=data_type),  # shape [1, 1, 2]
                tf.constant([[[3.0], [4.0]]], dtype=data_type), # shape [1, 2, 1]
                tf.constant([[[5.0, 6.0], [7.0, 8.0]]], dtype=data_type), # shape [1, 2, 2]
                tf.constant([[[9.0]]], dtype=data_type),       # shape [1, 1, 1]
                tf.constant([[[10.0, 11.0]]], dtype=data_type), # shape [1, 1, 2]
                tf.constant([[[12.0], [13.0]]], dtype=data_type), # shape [1, 2, 1]
            ]
        else:
            # Default case
            tensors = [
                tf.constant([1.0, 2.0], dtype=data_type),
                tf.constant([3.0, 4.0, 5.0], dtype=data_type),
            ]
    
>       dataset = tf.data.Dataset.from_tensor_slices(tensors)

tests\test_tensorflow_python_data_experimental_ops_batching_g2.py:66: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\ops\dataset_ops.py:793: in from_tensor_slices
    return TensorSliceDataset(tensors, name=name)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\ops\dataset_ops.py:4477: in __init__
    element = structure.normalize_element(element)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\util\structure.py:125: in normalize_element
    ops.convert_to_tensor(t, name="component_%d" % i, dtype=dtype))
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\profiler\trace.py:183: in wrapped
    return func(*args, **kwargs)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\framework\ops.py:1695: in convert_to_tensor
    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\array_ops.py:1547: in _autopacking_conversion_function
    return _autopacking_helper(v, dtype, name or "packed")
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\array_ops.py:1454: in _autopacking_helper
    return gen_array_ops.pack(list_or_tuple, name=name)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\gen_array_ops.py:6547: in pack
    _ops.raise_from_not_ok_status(e, name)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

e = _NotOkStatusException(), name = 'component_0'

    def raise_from_not_ok_status(e, name):
      e.message += (" name: " + name if name is not None else "")
>     raise core._status_to_exception(e) from None  # pylint: disable=protected-access
E     tensorflow.python.framework.errors_impl.InvalidArgumentError: Shapes of all inputs must match: values[0].shape = [1,1,2] != values[1].shape = [1,2,1] [Op:Pack] name: component_0

D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\framework\ops.py:7186: InvalidArgumentError
___ TestDenseToSparseBatch.test_dense_to_sparse_batch_row_shape_constraints ___

self = <test_tensorflow_python_data_experimental_ops_batching_g2.TestDenseToSparseBatch object at 0x000002797ADFD100>

    def test_dense_to_sparse_batch_row_shape_constraints(self):
        """Test row_shape constraints validation (CASE_04)."""
        # Test parameters from test_plan
        batch_size = 2
        row_shape = [3, 3]  # 2D row shape
        input_shape = "smaller_than_row_shape"
        data_type = tf.int64
    
        # Create test data with shapes smaller than row_shape
        # Each tensor is 2D with shape <= [3, 3]
        tensors = [
            tf.constant([[1, 2], [3, 4]], dtype=data_type),           # shape [2, 2]
            tf.constant([[5, 6, 7]], dtype=data_type),                # shape [1, 3]
            tf.constant([[8], [9], [10]], dtype=data_type),           # shape [3, 1]
            tf.constant([[11, 12, 13], [14, 15, 16]], dtype=data_type), # shape [2, 3]
            tf.constant([[17, 18], [19, 20], [21, 22]], dtype=data_type), # shape [3, 2]
            tf.constant([[23, 24, 25], [26, 27, 28], [29, 30, 31]], dtype=data_type), # shape [3, 3]
        ]
    
>       dataset = tf.data.Dataset.from_tensor_slices(tensors)

tests\test_tensorflow_python_data_experimental_ops_batching_g2.py:165: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\ops\dataset_ops.py:793: in from_tensor_slices
    return TensorSliceDataset(tensors, name=name)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\ops\dataset_ops.py:4477: in __init__
    element = structure.normalize_element(element)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\data\util\structure.py:125: in normalize_element
    ops.convert_to_tensor(t, name="component_%d" % i, dtype=dtype))
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\profiler\trace.py:183: in wrapped
    return func(*args, **kwargs)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\framework\ops.py:1695: in convert_to_tensor
    ret = conversion_func(value, dtype=dtype, name=name, as_ref=as_ref)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\array_ops.py:1547: in _autopacking_conversion_function
    return _autopacking_helper(v, dtype, name or "packed")
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\array_ops.py:1454: in _autopacking_helper
    return gen_array_ops.pack(list_or_tuple, name=name)
D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\ops\gen_array_ops.py:6547: in pack
    _ops.raise_from_not_ok_status(e, name)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

e = _NotOkStatusException(), name = 'component_0'

    def raise_from_not_ok_status(e, name):
      e.message += (" name: " + name if name is not None else "")
>     raise core._status_to_exception(e) from None  # pylint: disable=protected-access
E     tensorflow.python.framework.errors_impl.InvalidArgumentError: Shapes of all inputs must match: values[0].shape = [2,2] != values[1].shape = [1,3] [Op:Pack] name: component_0

D:\Coding\Anaconda\envs\testagent-experiment\lib\site-packages\tensorflow\python\framework\ops.py:7186: InvalidArgumentError

---------- coverage: platform win32, python 3.9.25-final-0 -----------
Name                                                                Stmts   Miss Branch BrPart  Cover   Missing
---------------------------------------------------------------------------------------------------------------
test_import.py                                                         27     27      8      0     0%   4-43
tests\test_tensorflow_python_data_experimental_ops_batching_g2.py     120     92     46      1    19%   61, 69-141, 168-252, 265-303, 308-314
---------------------------------------------------------------------------------------------------------------
TOTAL                                                                 147    119     54      1    15%
Coverage XML written to file coverage.xml

=========================== short test summary info ===========================
FAILED tests\test_tensorflow_python_data_experimental_ops_batching_g2.py::TestDenseToSparseBatch::test_dense_to_sparse_batch_basic[2-row_shape0-compatible-data_type0]
FAILED tests\test_tensorflow_python_data_experimental_ops_batching_g2.py::TestDenseToSparseBatch::test_dense_to_sparse_batch_basic[3-row_shape1-multi_dimension-data_type1]
FAILED tests\test_tensorflow_python_data_experimental_ops_batching_g2.py::TestDenseToSparseBatch::test_dense_to_sparse_batch_row_shape_constraints
3 failed in 3.17s

Error: exit 1