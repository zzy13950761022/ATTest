# tensorflow.python.ops.manip_ops 测试需求

## 1. 目标与范围
- 主要功能与期望行为
  - 测试 `roll` 函数沿指定轴滚动张量元素
  - 验证元素按偏移量正向/负向移动的正确性
  - 确认超出边界元素循环到另一端
  - 支持多轴同时滚动和同轴多次滚动
- 不在范围内的内容
  - 不测试其他 manip_ops 函数（仅 `roll`）
  - 不验证底层 C++ 实现 (`gen_manip_ops`)
  - 不涉及性能基准测试

## 2. 输入与约束
- 参数列表（名称、类型/shape、默认值）
  - `input`: Tensor，任意类型和形状，无默认值
  - `shift`: Tensor[int32/int64]，0-D 或 1-D，无默认值
  - `axis`: Tensor[int32/int64]，0-D 或 1-D，无默认值
  - `name`: str/None，可选，默认 None
- 有效取值范围/维度/设备要求
  - `shift` 和 `axis` 必须是 int32/int64 类型
  - `shift` 和 `axis` 形状必须匹配（同为 0-D 或 1-D 且长度相等）
  - `axis` 值必须在输入张量维度范围内 [-rank, rank)
  - 支持任意形状和类型的输入张量
- 必需与可选组合
  - `input`, `shift`, `axis` 为必需参数
  - `name` 为可选参数
- 随机性/全局状态要求
  - 无随机性
  - 无全局状态修改

## 3. 输出与判定
- 期望返回结构及关键字段
  - 返回 Tensor，类型与输入张量相同
  - 输出形状与输入形状完全一致
  - 元素位置按指定偏移重新排列
- 容差/误差界（如浮点）
  - 无浮点容差要求（元素位置精确匹配）
  - 整数类型要求精确相等
  - 浮点类型要求数值相等（无近似）
- 状态变化或副作用检查点
  - 无副作用
  - 不修改输入张量
  - 不改变全局状态

## 4. 错误与异常场景
- 非法输入/维度/类型触发的异常或警告
  - `shift` 或 `axis` 非 int32/int64 类型
  - `shift` 和 `axis` 形状不匹配
  - `axis` 值超出输入张量维度范围
  - 输入张量为 None 或无效对象
- 边界值（空、None、0 长度、极端形状/数值）
  - 空张量（形状包含 0 维度）
  - 0-D 标量张量
  - 极大偏移量（超过维度长度）
  - 负轴索引（Python 风格负索引）
  - 同轴多次指定时的偏移量累加

## 5. 依赖与环境
- 外部资源/设备/网络/文件依赖
  - TensorFlow 运行时环境
  - 无网络/文件依赖
  - 支持 CPU/GPU/TPU 设备
- 需要 mock/monkeypatch 的部分
  - `tensorflow.python.ops.gen_manip_ops.roll`（底层 C++ 实现）
  - 无需 mock 其他外部依赖

## 6. 覆盖与优先级
- 必测路径（高优先级，最多 5 条，短句）
  1. 一维张量正向/负向滚动
  2. 多轴同时滚动（2D/3D 张量）
  3. 同轴多次指定时的偏移量累加
  4. 边界条件：空张量、标量、极端偏移
  5. 类型验证：int32/int64 shift/axis 参数
- 可选路径（中/低优先级合并为一组列表）
  - 高维张量（4D+）滚动
  - 不同数据类型组合测试
  - 大张量性能验证（非功能测试）
  - 不同设备（CPU/GPU）一致性
  - 负轴索引的 Python 风格处理
- 已知风险/缺失信息（仅列条目，不展开）
  - 缺少对复杂形状（如不规则形状）的文档说明
  - 未明确超大偏移量的性能影响
  - 缺少设备特定行为的文档
  - 未说明稀疏张量的支持情况