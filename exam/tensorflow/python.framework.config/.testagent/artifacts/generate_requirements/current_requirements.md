# tensorflow.python.framework.config 测试需求

## 1. 目标与范围
- 主要功能与期望行为：验证 TensorFlow 运行时配置模块的硬件、线程、内存、设备管理功能，确保配置设置与查询正确性
- 不在范围内的内容：底层硬件驱动实现、TensorFlow 核心计算图执行、第三方设备插件

## 2. 输入与约束
- 参数列表（名称、类型/shape、默认值）：
  - 设备类型：字符串（'CPU'/'GPU'/'TPU'），无默认值
  - 线程数：整数，默认值依赖系统
  - 布尔标志：enable/disable 函数参数
  - 设备索引：字符串（'GPU:0'）或整数
- 有效取值范围/维度/设备要求：
  - 线程数：正整数，不超过系统核心数
  - 设备类型：仅支持 'CPU'/'GPU'/'TPU'
  - 内存增长：仅 GPU/TPU 设备
- 必需与可选组合：
  - 设备查询函数：必需设备类型参数
  - 配置设置函数：必需配置值参数
- 随机性/全局状态要求：
  - 配置修改影响全局运行时状态
  - 部分配置需在运行时初始化前设置

## 3. 输出与判定
- 期望返回结构及关键字段：
  - 设备列表：列表[PhysicalDevice]，含 name/device_type 字段
  - 内存信息：字典，含 current/peak 内存使用量
  - 布尔状态：True/False 表示功能启用状态
  - 线程数：整数表示当前配置
- 容差/误差界（如浮点）：
  - 内存统计：允许 ±1MB 误差
  - 线程数：精确匹配设置值
- 状态变化或副作用检查点：
  - 设置后查询应返回新值
  - 设备可见性修改影响后续操作
  - 内存策略变更影响分配行为

## 4. 错误与异常场景
- 非法输入/维度/类型触发的异常或警告：
  - 无效设备类型：ValueError
  - 不存在的设备索引：ValueError
  - 负线程数：ValueError
  - 不支持的功能调用：RuntimeError（如 CPU 内存统计）
- 边界值（空、None、0 长度、极端形状/数值）：
  - 线程数=0：应拒绝或使用默认值
  - 空设备列表：返回空列表
  - 超大线程数：受系统限制
  - 无效设备字符串格式

## 5. 依赖与环境
- 外部资源/设备/网络/文件依赖：
  - GPU/TPU 硬件：TensorFloat-32、内存统计功能
  - 系统线程资源：线程配置函数
  - 运行时上下文：全局状态管理
- 需要 mock/monkeypatch 的部分：
  - 硬件检测函数（list_physical_devices）
  - 内存统计底层接口
  - 设备可见性控制
  - 实验性功能标志

## 6. 覆盖与优先级
- 必测路径（高优先级，最多 5 条，短句）：
  1. 基本设备查询（CPU/GPU）返回正确设备列表
  2. 线程配置设置后查询一致
  3. 内存增长设置对 GPU 设备生效
  4. TensorFloat-32 开关状态正确切换
  5. 无效参数触发预期异常
- 可选路径（中/低优先级合并为一组列表）：
  - 多设备环境下的设备管理
  - 内存统计精度验证
  - 操作确定性性能影响
  - 优化器配置选项组合
  - 运行时初始化前后配置限制
  - 实验性功能回退行为
- 已知风险/缺失信息（仅列条目，不展开）：
  - 硬件依赖测试环境限制
  - 实验性 API 可能变更
  - 部分异常类型未文档化
  - 多线程并发配置竞争
  - 内存统计仅支持特定硬件