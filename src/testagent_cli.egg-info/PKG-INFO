Metadata-Version: 2.4
Name: testagent-cli
Version: 0.1.0
Summary: A controllable CLI agent for C operator test generation
Author: ATTest Authors
Requires-Python: <3.11,>=3.10
Description-Content-Type: text/markdown
Requires-Dist: typer<0.13,>=0.9.0
Requires-Dist: click<8.1,>=8.0.0
Requires-Dist: openai<2,>=1.0.0
Requires-Dist: requests<3,>=2.31.0
Requires-Dist: rich<14,>=13.7.0

# ATTest-CLI

ä¸€ä¸ªå¯æ§çš„ CLI Agentï¼Œç”¨äºåœ¨å›ºå®šçš„ã€äººå·¥æ‰¹å‡†çš„å·¥ä½œæµä¸‹ä¸º Python ç®—å­/APIï¼ˆPyTorchã€TensorFlow ç­‰ï¼‰ç”Ÿæˆå’Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### åŒæ¨¡å¼æ“ä½œ
- **ğŸ”§ Tool Mode (Chat)**: ä¸´æ—¶æŸ¥è¯¢å’Œæ–‡ä»¶æ“ä½œ
- **ğŸ”„ Workflow Mode**: 7é˜¶æ®µæ™ºèƒ½æµ‹è¯•ç”Ÿæˆæµç¨‹

### Workflow äº®ç‚¹
- **7 é˜¶æ®µæµç¨‹**: ç®—å­ç†è§£ â†’ éœ€æ±‚ç”Ÿæˆ â†’ æµ‹è¯•è®¡åˆ’ â†’ ä»£ç ç”Ÿæˆ â†’ æ‰§è¡Œæµ‹è¯• â†’ ç»“æœåˆ†æ â†’ æŠ¥å‘Šç”Ÿæˆ
- **æ™ºèƒ½åé¦ˆ**: æ”¯æŒè‡ªç„¶è¯­è¨€åé¦ˆå’Œç‰¹æ®Šå‘½ä»¤ï¼ˆ`/regenerate`, `/goto`, `/retry`ï¼‰
- **çŠ¶æ€æŒä¹…åŒ–**: æ”¯æŒä¸­æ–­æ¢å¤ï¼Œæ‰€æœ‰äº§ç‰©ç‰ˆæœ¬åŒ–ç®¡ç†
- **è‡ªå®šä¹‰æ‰§è¡Œ**: å¯é…ç½® pytest å‘½ä»¤ã€ç¯å¢ƒå˜é‡ä¸ä¾èµ–å®‰è£…

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
cd ATTest-CLI
pip install -e .
```

### åŸºç¡€ä½¿ç”¨

#### Chat æ¨¡å¼ï¼ˆä¸´æ—¶ä»»åŠ¡ï¼‰

```bash
testagent chat --workspace ~/my-project
```

#### Workflow æ¨¡å¼ï¼ˆå®Œæ•´æµ‹è¯•ç”Ÿæˆï¼‰

```bash
# äº¤äº’å¼æ¨¡å¼ï¼ˆæ¨èï¼‰
testagent run -f torch.nn.functional.relu --workspace ~/my-project

# å…¨è‡ªåŠ¨æ¨¡å¼
testagent run -f torch.add --mode full-auto

# å…¨è‡ªåŠ¨ + å¤šè½®è¿­ä»£ä¼˜åŒ–ï¼ˆ3 è½®ï¼‰
testagent run -f torch.add --mode full-auto --epoch 3

# æŒ‡å®šé¡¹ç›®æ ¹ç›®å½•ï¼ˆå½“ä¸ workspace ä¸åŒæ—¶ï¼‰
testagent run -f torch.add --workspace ~/my-project --project-root ~/my-project/src

# æ¢å¤ä¸­æ–­çš„å·¥ä½œæµ
testagent run -f torch.add --resume
```

---

## ğŸ“– æ–‡æ¡£

- **[WORKFLOW_GUIDE.md](./WORKFLOW_GUIDE.md)** - å®Œæ•´ä½¿ç”¨æŒ‡å—ï¼ˆæ¨èï¼‰
  - Workflow æ¨¡å¼è¯¦è§£
  - é…ç½®è‡ªå®šä¹‰æ„å»ºå‘½ä»¤
  - æµ‹è¯•ä¸è°ƒè¯•
  - æ‰©å±•ä¸å®šåˆ¶

- **[QUICK_REFERENCE.md](./QUICK_REFERENCE.md)** - å¿«é€Ÿå‚è€ƒå¡ç‰‡
  - å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥
  - Workflow äº¤äº’å‘½ä»¤
  - é…ç½®ç¤ºä¾‹

- **[USAGE.md](./USAGE.md)** - Chat æ¨¡å¼ä½¿ç”¨æŒ‡å—

---

## ğŸ¯  Workflow 7 é˜¶æ®µ

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ATTest Workflow - torch.add (python)        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ [â—] 1. Understand Function                       â•‘
â•‘ [â—] 2. Generate Requirements                     â•‘
â•‘ [â–¶] 3. Design Test Plan        â† Current Stage   â•‘
â•‘ [ ] 4. Generate Code                             â•‘
â•‘ [ ] 5. Execute Tests                             â•‘
â•‘ [ ] 6. Analyze Results                           â•‘
â•‘ [ ] 7. Generate Report                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

æ¯ä¸ªé˜¶æ®µå®Œæˆåå¯ä»¥ï¼š
- `Enter` - ç»§ç»­
- `/regenerate` - é‡æ–°ç”Ÿæˆ
- `/goto <stage>` - è·³è½¬
- `è‡ªç„¶è¯­è¨€åé¦ˆ` - æ™ºèƒ½ç†è§£

---

## ğŸ”§ é…ç½®è‡ªå®šä¹‰æ„å»ºå‘½ä»¤

éœ€è¦è°ƒæ•´ pytest å‘½ä»¤æˆ–ç¯å¢ƒå˜é‡æ—¶ï¼Œç¼–è¾‘ `~/.testagent_cli/config.json`ï¼š

```json
{
  "api": {
    "model": "deepseek-chat",
    "base_url": "https://api.deepseek.com/v1",
    "api_key": "your-api-key",
    "temperature": 0.2,
    "max_tokens": 4096
  },
  "preferences": {
    "auto_approve": false
  },
  "project": {
    "root": ".",
    "test_file_template": "tests/test_{target_slug}.py",
    "build_dir": "",
    "output_binary_template": ""
  },
  "commands": {
    "compile": "",
    "install": "",
    "run_test": "PYTHONPATH={project_root}:$PYTHONPATH pytest -q {test_file_path}"
  }
}
```

**å¯ç”¨å˜é‡**:
- `{target}` / `{target_slug}` - ç›®æ ‡å‡½æ•° FQN åŠå…¶ slug
- `{project_root}` - é¡¹ç›®æ ¹ç›®å½•
- `{test_file_path}` - ç”Ÿæˆçš„ pytest æ–‡ä»¶è·¯å¾„

è¯¦è§ [WORKFLOW_GUIDE.md - é…ç½®è‡ªå®šä¹‰æ„å»ºå‘½ä»¤](./WORKFLOW_GUIDE.md#é…ç½®è‡ªå®šä¹‰æ„å»ºå‘½ä»¤)

---

## ğŸ“‹ å‘½ä»¤å‚è€ƒ

### é…ç½®ç®¡ç†

```bash
testagent config list              # æŸ¥çœ‹æ‰€æœ‰é…ç½®
testagent config set KEY VALUE     # è®¾ç½®é…ç½®é¡¹
testagent config get KEY           # è·å–é…ç½®é¡¹
```

### ä¼šè¯ç®¡ç†

```bash
testagent sessions list            # åˆ—å‡ºæ‰€æœ‰ä¼šè¯
testagent sessions clear ID        # æ¸…é™¤æŒ‡å®šä¼šè¯
```

### Chat æ¨¡å¼

```bash
testagent chat [--workspace DIR] [--auto-approve]
```

### Workflow æ¨¡å¼

```bash
testagent run -f package.module:function \
  [--workspace DIR] \
  [--project-root DIR] \
  [--mode interactive|full-auto] \
  [--epoch N] \
  [--resume]
```

**å‚æ•°è¯´æ˜**ï¼š
- `-f, --func`: ç›®æ ‡å‡½æ•°å…¨é™å®šåï¼ˆå¿…éœ€ï¼‰
- `--workspace`: å·¥ä½œç›®å½•ï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•
- `--project-root`: é¡¹ç›®æ ¹ç›®å½•ï¼Œé»˜è®¤ä¸ workspace ç›¸åŒ
- `--mode`: è¿è¡Œæ¨¡å¼ï¼Œ`interactive` æˆ– `full-auto`ï¼Œé»˜è®¤ `interactive`
- `--epoch`: å…¨è‡ªåŠ¨æ¨¡å¼ä¸‹çš„è¿­ä»£è½®æ•°ï¼ˆåœ¨ analyze_results åå›åˆ° generate_code è¿­ä»£ï¼‰ï¼Œé»˜è®¤ 1
- `--resume`: æ¢å¤ä¸­æ–­çš„å·¥ä½œæµ

---

## ğŸ› ï¸ æ‰©å±•ä¸å®šåˆ¶

### æ·»åŠ æ–° Tool

1. åœ¨ `src/testagent_cli/tools/builtin.py` åˆ›å»º Tool ç±»
2. åœ¨ `src/testagent_cli/tools/runner.py` æ³¨å†Œ
3. åœ¨ Stage çš„ `tools` åˆ—è¡¨ä¸­ä½¿ç”¨

### ä¿®æ”¹ Stage Prompt

ç¼–è¾‘å¯¹åº”çš„ Stage æ–‡ä»¶ï¼ˆä¾‹å¦‚ `src/testagent_cli/workflow/stages/requirements.py`ï¼‰ï¼Œä¿®æ”¹ `_get_prompt_template()` æ–¹æ³•ã€‚

### æ·»åŠ æ–° Stage

1. åˆ›å»º `src/testagent_cli/workflow/stages/your_stage.py`
2. åœ¨ `stages/__init__.py` ä¸­æ³¨å†Œ
3. åœ¨ `workflow/engine.py` çš„ `STAGE_NAMES` ä¸­æ·»åŠ 

è¯¦è§ [WORKFLOW_GUIDE.md - æ‰©å±•ä¸å®šåˆ¶](./WORKFLOW_GUIDE.md#æ‰©å±•ä¸å®šåˆ¶)

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
ATTest-CLI/
â”œâ”€â”€ src/testagent_cli/
â”‚   â”œâ”€â”€ cli.py                    # CLI å…¥å£
â”‚   â”œâ”€â”€ config.py                 # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ llm.py                    # LLM å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ session.py                # ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ chat.py                   # Chat æ¨¡å¼
â”‚   â”œâ”€â”€ tools/                    # å·¥å…·ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ base.py
â”‚   â”‚   â”œâ”€â”€ builtin.py
â”‚   â”‚   â””â”€â”€ runner.py
â”‚   â””â”€â”€ workflow/                 # Workflow å¼•æ“ï¼ˆæ–°ï¼‰
â”‚       â”œâ”€â”€ engine.py             # ä¸»æ§åˆ¶å™¨
â”‚       â”œâ”€â”€ state.py              # çŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ stage.py              # Stage åŸºç±»
â”‚       â”œâ”€â”€ supervisor.py         # åé¦ˆç†è§£
â”‚       â”œâ”€â”€ display.py            # è¿›åº¦æ˜¾ç¤º
â”‚       â””â”€â”€ stages/               # å„ä¸ªé˜¶æ®µ
â”‚           â”œâ”€â”€ understand.py
â”‚           â”œâ”€â”€ requirements.py
â”‚           â”œâ”€â”€ planning.py
â”‚           â”œâ”€â”€ codegen.py
â”‚           â”œâ”€â”€ execution.py
â”‚           â”œâ”€â”€ analysis.py
â”‚           â””â”€â”€ report.py
â”œâ”€â”€ WORKFLOW_GUIDE.md             # å®Œæ•´ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ QUICK_REFERENCE.md            # å¿«é€Ÿå‚è€ƒ
â””â”€â”€ USAGE.md                      # Chatæ¨¡å¼æŒ‡å—
```

---

## ğŸ§ª æµ‹è¯•

```bash
# æµ‹è¯•æ ¸å¿ƒæ¡†æ¶
python test_milestone1.py

# æµ‹è¯•è‡ªå®šä¹‰å‘½ä»¤
python test_custom_commands.py
```

---

## ğŸ“ ç¤ºä¾‹

### PyTorch ç®—å­å…¨è‡ªåŠ¨å·¥ä½œæµ

```bash
testagent run -f torch.add --workspace ~/my-project --mode full-auto
```

è‡ªåŠ¨ç”Ÿæˆ pytest ç”¨ä¾‹ã€æ‰§è¡Œå¹¶è¾“å‡ºæµ‹è¯•æŠ¥å‘Šã€‚

### å¸¦è‡ªå®šä¹‰ pytest å‘½ä»¤çš„å·¥ä½œæµ

```bash
testagent config set commands.run_test "PYTHONPATH={project_root}:$PYTHONPATH pytest -q {test_file_path}"
testagent run -f torch.nn.functional.relu --workspace ~/my-project --mode interactive
```

ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤è¿è¡Œç”Ÿæˆçš„æµ‹è¯•ï¼ˆå¯åœ¨è™šæ‹Ÿç¯å¢ƒæˆ– CI ä¸­å¤ç”¨ï¼‰ã€‚

### Chat æ¨¡å¼å¿«é€Ÿæ£€æŸ¥

```bash
testagent chat --workspace ~/my-project --auto-approve
```

ä¸´æ—¶æŸ¥çœ‹/åˆ†ææ–‡ä»¶ï¼Œæˆ–ç”Ÿæˆå°ç‰‡æ®µæµ‹è¯•ä»£ç ã€‚

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼ä¸»è¦çš„æ‰©å±•ç‚¹ï¼š
- æ–°çš„ Toolï¼ˆæ–‡ä»¶æ“ä½œã€åˆ†æå·¥å…·ç­‰ï¼‰
- æ–°çš„ Workflow Stageï¼ˆæ€§èƒ½æµ‹è¯•ã€è¦†ç›–ç‡åˆ†æç­‰ï¼‰
- æ”¹è¿›çš„ Prompt æ¨¡æ¿
- æ›´å¥½çš„é”™è¯¯å¤„ç†

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ™ è‡´è°¢

çµæ„Ÿæ¥æºï¼š
- **CliAgent** - Flow-first è®¾è®¡
- **Cougar-CLI** - Config/Session ç®¡ç†
- **mini-kode** - æƒé™åŒ–å·¥å…·æ‰§è¡Œ

---

**å¿«é€Ÿå¼€å§‹**: æŸ¥çœ‹ [WORKFLOW_GUIDE.md](./WORKFLOW_GUIDE.md) äº†è§£è¯¦ç»†ç”¨æ³•ï¼
